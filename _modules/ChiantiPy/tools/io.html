

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ChiantiPy.tools.io &mdash; ChiantiPy v0.7.1a</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="ChiantiPy v0.7.1a" href="../../../index.html"/>
        <link rel="up" title="ChiantiPy" href="../../ChiantiPy.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> ChiantiPy
          

          
          </a>

          
            
            
              <div class="version">
                0.7.1a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started with ChiantiPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_ref/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes.html">Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../IDL_intro.html">Intro for CHIANTI IDL Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources.html">Resources for ChiantiPy Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bugs.html">Reporting Bugs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ChiantiPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ChiantiPy.html">ChiantiPy</a> &raquo;</li>
        
      <li>ChiantiPy.tools.io</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ChiantiPy.tools.io</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Reading and writing functions</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">date</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">configparser</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">ChiantiPy.tools.util</span> <span class="k">as</span> <span class="nn">util</span>
<span class="kn">import</span> <span class="nn">ChiantiPy.tools.constants</span> <span class="k">as</span> <span class="nn">const</span>
<span class="kn">import</span> <span class="nn">ChiantiPy.Gui</span> <span class="k">as</span> <span class="nn">chgui</span>
<span class="kn">from</span>  <span class="nn">ChiantiPy.fortranformat</span> <span class="k">import</span> <span class="n">FortranRecordReader</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<div class="viewcode-block" id="abundanceRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.abundanceRead.html#ChiantiPy.tools.io.abundanceRead">[docs]</a><span class="k">def</span> <span class="nf">abundanceRead</span><span class="p">(</span><span class="n">abundancename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read abundance file `abundancename` and return the abundance values relative to hydrogen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abundance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;XUVTOP&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">abundancename</span><span class="p">:</span>
        <span class="c1"># a specific abundance file name has been specified</span>
        <span class="n">abundancefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span><span class="s1">&#39;abundance&#39;</span><span class="p">,</span><span class="n">abundancename</span><span class="o">+</span><span class="s1">&#39;.abund&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># the user will select an abundance file</span>
        <span class="n">abundir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span><span class="s1">&#39;abundance&#39;</span><span class="p">)</span>
        <span class="n">abundlabel</span> <span class="o">=</span> <span class="s1">&#39;ChiantiPy - Select an abundance file&#39;</span>
        <span class="c1">#fname = chianti.gui.chpicker(abundir, filter=&#39;*.abund&#39;, label=abundlabel)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">chgui</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">chpicker</span><span class="p">(</span><span class="n">abundir</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;*.abund&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">abundlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; no abundance file selected&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abundancefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">abundir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
            <span class="n">abundancefilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">abundancename</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">abundancefilename</span><span class="p">)</span>
<span class="c1">#    else:</span>
<span class="c1">#        # the default abundance file will be used</span>
<span class="c1">#        abundancename=self.Defaults[&#39;abundfile&#39;]</span>
<span class="c1">#        fname=os.path.join(xuvtop,&#39;abundance&#39;,abundancename+&#39;.abund&#39;)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">abundancefile</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">nlines</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">minChar</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">nlines</span><span class="p">])])</span>
        <span class="n">aline</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nlines</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">minChar</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">aline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
        <span class="n">nlines</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nlines</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">):</span>
        <span class="n">z</span><span class="p">,</span><span class="n">ab</span><span class="p">,</span><span class="n">element</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">abundance</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ab</span><span class="p">)</span>
    <span class="n">gz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">abundance</span><span class="p">)</span>
    <span class="nb">abs</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="n">abundance</span><span class="p">[</span><span class="n">gz</span><span class="p">]</span><span class="o">-</span><span class="n">abundance</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">abundance</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">gz</span><span class="p">,</span><span class="nb">abs</span><span class="p">)</span>
    <span class="n">abundanceRef</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nlines</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;abundancename&#39;</span><span class="p">:</span><span class="n">abundancename</span><span class="p">,</span><span class="s1">&#39;abundance&#39;</span><span class="p">:</span><span class="n">abundance</span><span class="p">,</span><span class="s1">&#39;abundanceRef&#39;</span><span class="p">:</span><span class="n">abundanceRef</span><span class="p">}</span></div>


<div class="viewcode-block" id="zion2name"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.zion2name.html#ChiantiPy.tools.io.zion2name">[docs]</a><span class="k">def</span> <span class="nf">zion2name</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">ion</span><span class="p">,</span> <span class="n">dielectronic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert `Z` and `ion` to generic name, e.g. 26, 13 -&gt; fe_13</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    z : `int`</span>
<span class="sd">        the nuclear charge, for example 26 for Fe XIV</span>
<span class="sd">    ion : `int`</span>
<span class="sd">        the ion stage, for example, 14 for Fe XIV</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A duplicate of the routine in `ChiantiPy.tools.util` but needed by masterList Info</span>
<span class="sd">    TODO: Put in separate module to avoid multiple copies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ion</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">thisone</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">ion</span> <span class="o">==</span> <span class="n">z</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">thisone</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">El</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ion</span> <span class="o">&lt;=</span> <span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">thisone</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">El</span><span class="p">[</span><span class="n">z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ion</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dielectronic</span><span class="p">:</span>
            <span class="n">thisone</span> <span class="o">+=</span> <span class="s1">&#39;d&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this should not actually happen</span>
        <span class="n">thisone</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">thisone</span></div>


<div class="viewcode-block" id="convertName"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.convertName.html#ChiantiPy.tools.io.convertName">[docs]</a><span class="k">def</span> <span class="nf">convertName</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert ion name string to Z and Ion and other interesting info</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name :  `str`</span>
<span class="sd">        a generic name of an ion in the CHIANTI database,</span>
<span class="sd">        such as fe_14 for Fe XIV</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A duplicate of the routine in `ChiantiPy.tools.util` but needed by masterList Info</span>
<span class="sd">    TODO: Put in separate module to avoid multiple copies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">els</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">El</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">els</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">ions</span> <span class="o">=</span> <span class="n">s2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">ions</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
        <span class="n">dielectronic</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ions</span> <span class="o">=</span> <span class="n">ions</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">dielectronic</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">zion2name</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">zion2name</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Z&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span><span class="s1">&#39;Ion&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">ions</span><span class="p">),</span><span class="s1">&#39;Dielectronic&#39;</span><span class="p">:</span><span class="n">dielectronic</span><span class="p">,</span> <span class="s1">&#39;Element&#39;</span><span class="p">:</span><span class="n">els</span><span class="p">,</span> <span class="s1">&#39;higher&#39;</span><span class="p">:</span><span class="n">higher</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span><span class="n">lower</span><span class="p">}</span></div>


<div class="viewcode-block" id="autoRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.autoRead.html#ChiantiPy.tools.io.autoRead">[docs]</a><span class="k">def</span> <span class="nf">autoRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read CHIANTI autoionization rates from a .auto file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    elvlcname : `str`</span>
<span class="sd">        If specified, the lsj term labels are returned in the &#39;pretty1&#39; and &#39;pretty2&#39;</span>
<span class="sd">        keys of &#39;Wgfa&#39; dict</span>
<span class="sd">    total : `bool`</span>
<span class="sd">        Return the summed level 2 autoionization rates in &#39;Auto&#39;</span>
<span class="sd">    verbose : `bool`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Auto : `dict`</span>
<span class="sd">        Information read from the .wgfa file. The dictionary structure is</span>
<span class="sd">        {&quot;lvl1&quot;, &quot;lvl2&quot;, &quot;avalue&quot;, &quot;pretty1&quot;, &quot;pretty2&quot;, &quot;ref&quot;,&quot;ionS&quot;, &quot;filename&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">autoname</span> <span class="o">=</span> <span class="n">filename</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">autoname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.auto&#39;</span>
    <span class="c1">#</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">autoname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">nwvl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ndata</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nwvl</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">s1a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">nwvl</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nwvl</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; nwvl = </span><span class="si">%10i</span><span class="s1"> ndata = </span><span class="si">%4i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">nwvl</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)))</span>
    <span class="n">lvl1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">avalue</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">pretty1</span>  <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">pretty2</span>  <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; nwvl  =  </span><span class="si">%10i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">nwvl</span><span class="p">)))</span>
    <span class="c1">#</span>
    <span class="n">wgfaFormat</span> <span class="o">=</span> <span class="s1">&#39;(2i7,e12.2,a30,3x,a30)&#39;</span>
    <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="n">wgfaFormat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ivl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwvl</span><span class="p">):</span>
<span class="c1">#        inpt=FortranLine(s1[ivl],wgfaFormat)</span>
        <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">ivl</span><span class="p">])</span>
        <span class="n">lvl1</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lvl2</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">avalue</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">pretty1</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">pretty2</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwvl</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)):</span>
        <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">Auto</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lvl1&quot;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span> <span class="s2">&quot;lvl2&quot;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span> <span class="s2">&quot;avalue&quot;</span><span class="p">:</span><span class="n">avalue</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;ionS&#39;</span><span class="p">:</span><span class="n">ions</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">autoname</span><span class="p">,</span> <span class="s1">&#39;pretty1&#39;</span><span class="p">:</span><span class="n">pretty1</span><span class="p">,</span> <span class="s1">&#39;pretty2&#39;</span><span class="p">:</span><span class="n">pretty2</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">total</span><span class="p">:</span>
        <span class="n">avalueLvl</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iwvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwvl</span><span class="p">):</span>
            <span class="n">avalueLvl</span><span class="p">[</span><span class="n">lvl2</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">avalue</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span>
        <span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">avalueLvl</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">pstring1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5s</span><span class="s1"> </span><span class="si">%5s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%20s</span><span class="s1"> - </span><span class="si">%20s</span><span class="s1">&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pstring1</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;lvl1&#39;</span><span class="p">,</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">,</span> <span class="s1">&#39;auto value&#39;</span><span class="p">,</span> <span class="s1">&#39;branch ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;pretty1&#39;</span><span class="p">,</span> <span class="s1">&#39;pretty2&#39;</span><span class="p">))</span>
        <span class="n">pstring</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%12.2e</span><span class="s1"> </span><span class="si">%12.2e</span><span class="s1"> </span><span class="si">%20s</span><span class="s1"> - </span><span class="si">%20s</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">ivl</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">avalue</span><span class="p">):</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">avalue</span><span class="o">/</span><span class="n">avalueLvl</span><span class="p">[</span><span class="n">l2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pstring</span><span class="o">%</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">avalue</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">ivl</span><span class="p">],</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">ivl</span><span class="p">]))</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">Auto</span></div>


<div class="viewcode-block" id="autoWrite"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.autoWrite.html#ChiantiPy.tools.io.autoWrite">[docs]</a><span class="k">def</span> <span class="nf">autoWrite</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minBranch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write data to a CHIANTI .wgfa file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    info : `dict`</span>
<span class="sd">        Should contain the following:</span>
<span class="sd">        ionS, the Chianti style name of the ion such as c_4 for C IV,</span>
<span class="sd">        lvl1, the lower level, the ground level is 1,</span>
<span class="sd">        lvl2, the upper level, wvl, the wavelength (in Angstroms),</span>
<span class="sd">        avalue, the autoionization rate,</span>
<span class="sd">        pretty1, descriptive text of the lower level (optional),</span>
<span class="sd">        pretty2, descriptive text of the upper level (optiona),</span>
<span class="sd">        ref, reference text, a list of strings</span>
<span class="sd">    outfile : `str`</span>
<span class="sd">    minBranch : `~numpy.float64`</span>
<span class="sd">        The transition must have a branching ratio greater than the specified to be written to the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
<span class="c1">#    gname = info[&#39;ionS&#39;]</span>
    <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">autoname</span> <span class="o">=</span> <span class="n">outfile</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; output filename not specified, no file will be created&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; auto file name = &#39;</span><span class="p">,</span> <span class="n">autoname</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">minBranch</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minBranch</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; minimum branching ratio = </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">minBranch</span><span class="p">))</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">autoname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1">#ntrans = len(info[&#39;lvl1&#39;])</span>
    <span class="n">nlvl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">])</span>
    <span class="n">totalAvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlvl</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;pretty1&#39;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">pformat</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7i%7i%12.2e%30s</span><span class="s1"> - </span><span class="si">%30s</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pformat</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%</span><span class="s1">7i</span><span class="si">%7i%12.2e</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">itrans</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]):</span>
        <span class="c1"># for autoionization transitions, lvl1 can be less than zero???</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">totalAvalue</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">avalue</span>

    <span class="k">for</span> <span class="n">itrans</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">avalue</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="n">avalue</span><span class="o">/</span><span class="n">totalAvalue</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">branch</span> <span class="o">&gt;</span> <span class="n">minBranch</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;pretty1&#39;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                <span class="n">lbl2</span> <span class="o">=</span>  <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="n">pstring</span> <span class="o">=</span> <span class="n">pformat</span><span class="o">%</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">avalue</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pretty1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">lbl2</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pstring</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pstring</span> <span class="o">=</span> <span class="n">pformat</span><span class="o">%</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">avalue</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pstring</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; -1 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">ilename:  &#39;</span> <span class="o">+</span> <span class="n">autoname</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="cireclvlRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.cireclvlRead.html#ChiantiPy.tools.io.cireclvlRead">[docs]</a><span class="k">def</span> <span class="nf">cireclvlRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;cilvl&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read Chianti cilvl, reclvl, or rrlvl files and return data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`, optional</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    filetype : `str`</span>
<span class="sd">        {&#39;cilvl&#39;, &#39;reclvl&#39;, &#39;rrlvl&#39;} Type of the file to read</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>

    <span class="n">paramname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">filetype</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">paramname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">iline</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">aline</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">aline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
        <span class="n">iline</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ndata</span> <span class="o">=</span> <span class="n">iline</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">ntrans</span> <span class="o">=</span> <span class="n">ndata</span><span class="o">//</span><span class="mi">2</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># need to find the maximum number of temperatures, not all lines are the same</span>
    <span class="c1">#</span>
    <span class="n">ntemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntrans</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">)</span>
    <span class="n">iline</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">jline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ndata</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">jline</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">ntemp</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dummy</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
        <span class="n">iline</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">maxNtemp</span> <span class="o">=</span> <span class="n">ntemp</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="c1">#   print &#39; maxNtemp = &#39;, maxNtemp</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntrans</span><span class="p">,</span><span class="n">maxNtemp</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">iline</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">jline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ndata</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">recdat</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">jline</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">shortT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">recdat</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1"># the result of the next statement is to continue to replicate t</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">shortT</span><span class="p">,</span> <span class="n">maxNtemp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;rrlvl&#39;</span><span class="p">:</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="n">t</span>
        <span class="n">iline</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1">#</span>
    <span class="n">lvl1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntrans</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">)</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntrans</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">)</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntrans</span><span class="p">,</span> <span class="n">maxNtemp</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">idat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">jline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndata</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">cidat</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">jline</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">shortCi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cidat</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">lvl1</span><span class="p">[</span><span class="n">idat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cidat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">lvl2</span><span class="p">[</span><span class="n">idat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cidat</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ci</span><span class="p">[</span><span class="n">idat</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">shortCi</span><span class="p">,</span> <span class="n">maxNtemp</span><span class="p">)</span>
        <span class="n">idat</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temp</span><span class="p">,</span> <span class="s1">&#39;ntemp&#39;</span><span class="p">:</span><span class="n">ntemp</span><span class="p">,</span><span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">ci</span><span class="p">,</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">lines</span><span class="p">[</span><span class="n">ndata</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="s1">&#39;ionS&#39;</span><span class="p">:</span><span class="n">ions</span><span class="p">}</span></div>


<div class="viewcode-block" id="defaultsRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.defaultsRead.html#ChiantiPy.tools.io.defaultsRead">[docs]</a><span class="k">def</span> <span class="nf">defaultsRead</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in configuration from .chiantirc file or set defaults if one is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">initDefaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;abundfile&#39;</span><span class="p">:</span> <span class="s1">&#39;sun_photospheric_1998_grevesse&#39;</span><span class="p">,</span><span class="s1">&#39;ioneqfile&#39;</span><span class="p">:</span> <span class="s1">&#39;chianti&#39;</span><span class="p">,</span> <span class="s1">&#39;wavelength&#39;</span><span class="p">:</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span><span class="s1">&#39;gui&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
    <span class="n">rcfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;.chianti/chiantirc&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rcfile</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; reading chiantirc file&#39;</span><span class="p">))</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">RawConfigParser</span><span class="p">(</span><span class="n">initDefaults</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">rcfile</span><span class="p">)</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">anitem</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s1">&#39;chianti&#39;</span><span class="p">):</span>
            <span class="n">defaults</span><span class="p">[</span><span class="n">anitem</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">anitem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">initDefaults</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; chiantirc file (/HOME/.chianti/chiantirc) does not exist&#39;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; using the following defaults&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">akey</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">defaults</span><span class="p">[</span><span class="n">akey</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">defaults</span></div>


<div class="viewcode-block" id="diRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.diRead.html#ChiantiPy.tools.io.diRead">[docs]</a><span class="k">def</span> <span class="nf">diRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read chianti direct ionization .params files and return data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`, optional</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">paramname</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zion</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zion</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">zion</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; this is a bare nucleus that has no ionization rate&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39;diParams do not exist for this ion&#39;</span><span class="p">}</span>
        <span class="c1">#</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">paramname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.diparams&#39;</span>
    <span class="c1">#</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">paramname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1">#  need to read first line and see how many elements</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">line1</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">iz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nspl</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">nfac</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">neaev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">nspl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
<span class="c1">#    format=FortranFormat(str(nspl+1)+&#39;E10.2&#39;)</span>
    <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nspl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;E10.2&#39;</span><span class="p">)</span>
<span class="c1">#    inpt =header_line.read(s1[i][0:115])</span>

    <span class="c1">#</span>
    <span class="n">ev1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nfac</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="n">btf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nfac</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="n">xsplom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nfac</span><span class="p">,</span> <span class="n">nspl</span><span class="p">],</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="n">ysplom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nfac</span><span class="p">,</span> <span class="n">nspl</span><span class="p">],</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">ifac</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfac</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="c1">#        paramdat=FortranLine(line,format)</span>
        <span class="n">paramdat</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">btf</span><span class="p">[</span><span class="n">ifac</span><span class="p">]</span> <span class="o">=</span> <span class="n">paramdat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xsplom</span><span class="p">[</span><span class="n">ifac</span><span class="p">]</span> <span class="o">=</span> <span class="n">paramdat</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="c1">#        paramdat=FortranLine(line,format)</span>
        <span class="n">paramdat</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">ev1</span><span class="p">[</span><span class="n">ifac</span><span class="p">]</span> <span class="o">=</span> <span class="n">paramdat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ysplom</span><span class="p">[</span><span class="n">ifac</span><span class="p">]</span> <span class="o">=</span> <span class="n">paramdat</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">neaev</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">eacoef</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">eaev</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">avalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="n">eacoef</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eaev</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">hdr</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;iz&quot;</span><span class="p">:</span><span class="n">iz</span><span class="p">,</span><span class="s2">&quot;ion&quot;</span><span class="p">:</span><span class="n">ion</span><span class="p">,</span><span class="s2">&quot;nspl&quot;</span><span class="p">:</span><span class="n">nspl</span><span class="p">,</span><span class="s2">&quot;neaev&quot;</span><span class="p">:</span><span class="n">neaev</span><span class="p">,</span> <span class="s1">&#39;nfac&#39;</span><span class="p">:</span><span class="n">nfac</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">neaev</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;eaev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eaev</span>
    <span class="n">DiParams</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;info&quot;</span><span class="p">:</span><span class="n">info</span><span class="p">,</span><span class="s2">&quot;btf&quot;</span><span class="p">:</span><span class="n">btf</span><span class="p">,</span><span class="s2">&quot;ev1&quot;</span><span class="p">:</span><span class="n">ev1</span><span class="p">,</span><span class="s2">&quot;xsplom&quot;</span><span class="p">:</span><span class="n">xsplom</span><span class="p">,</span><span class="s2">&quot;ysplom&quot;</span><span class="p">:</span><span class="n">ysplom</span><span class="p">,</span> <span class="s1">&#39;eaev&#39;</span><span class="p">:</span><span class="n">eaev</span><span class="p">,</span><span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">hdr</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">DiParams</span></div>


<div class="viewcode-block" id="drRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.drRead.html#ChiantiPy.tools.io.drRead">[docs]</a><span class="k">def</span> <span class="nf">drRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read CHIANTI dielectronic recombination .drparams files</span>
<span class="sd">    if filename is set, then reads that file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">paramname</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">paramname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.drparams&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">paramname</span><span class="p">):</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">paramname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1">#  need to read first line and see how many elements</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">drtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">drtype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># a Badnell type</span>
            <span class="n">nparams</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">nparams</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">header_line</span> <span class="o">=</span>  <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;2i5,8e12.4&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">nparams</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">header_line</span> <span class="o">=</span>  <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;2i5,9e12.4&#39;</span><span class="p">)</span>
            <span class="n">inpt1</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">inpt2</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">eparams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inpt1</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">cparams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inpt2</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">DrParams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;drtype&#39;</span><span class="p">:</span><span class="n">drtype</span><span class="p">,</span> <span class="s1">&#39;eparams&#39;</span><span class="p">:</span><span class="n">eparams</span><span class="p">,</span><span class="s1">&#39;cparams&#39;</span><span class="p">:</span><span class="n">cparams</span><span class="p">,</span>  <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">drtype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># shull type</span>
<span class="c1">#            fmt=FortranFormat(&#39;2i5,4e12.4&#39;)</span>
            <span class="n">header_line</span> <span class="o">=</span>  <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;2i5,4e12.4&#39;</span><span class="p">)</span>
            <span class="n">inpt1</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#            params=np.asarray(FortranLine(lines[1],fmt)[2:], &#39;float64&#39;)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inpt1</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">DrParams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;drtype&#39;</span><span class="p">:</span><span class="n">drtype</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">params</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DrParams</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; for ion </span><span class="si">%5s</span><span class="s1"> unknown DR type = </span><span class="si">%5i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">drtype</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">DrParams</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">DrParams</span></div>


<div class="viewcode-block" id="eaRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.eaRead.html#ChiantiPy.tools.io.eaRead">[docs]</a><span class="k">def</span> <span class="nf">eaRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a CHIANTI excitation-autoionization file and calculate the EA ionization rate data</span>
<span class="sd">    derived from splupsRead.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`, optional</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">splupsname</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zion</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zion</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">zion</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; this is a bare nucleus that has no ionization rate&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">splupsname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.easplups&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">splupsname</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; could not find file:  &#39;</span><span class="p">,</span> <span class="n">splupsname</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;lvl1&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
    <span class="c1"># there is splups/psplups data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">splupsname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">nsplups</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">while</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nsplups</span><span class="p">][:]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">s1a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
            <span class="n">nsplups</span> <span class="o">=</span> <span class="n">nsplups</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">nsplups</span> <span class="o">=</span> <span class="n">nsplups</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">ttype</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">gf</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">de</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">cups</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">nspl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">splups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsplups</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
<span class="c1">#        splupsFormat1=&#39;(6x,3i3,8e10.0)&#39;</span>
<span class="c1">#        splupsFormat2=&#39;(6x,3i3,12e10.0)&#39;</span>
        <span class="c1">#</span>
        <span class="n">header_line1</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;6x,3i3,8e10.0&#39;</span><span class="p">)</span>
        <span class="n">header_line2</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;6x,3i3,12e10.0&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsplups</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line1</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1">#                inpt=FortranLine(s1[i],splupsFormat1)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line2</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1">#                inpt=FortranLine(s1[i],splupsFormat2)</span>
            <span class="n">lvl1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lvl2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ttype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">gf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">de</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">cups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span>  <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
                <span class="n">nspl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
                <span class="n">splups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)),</span><span class="n">inpt</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nspl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
                <span class="n">splups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span><span class="n">inpt</span><span class="p">[</span><span class="mi">6</span><span class="p">:])</span>
        <span class="c1">#</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsplups</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)):</span>
            <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;lvl1&quot;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span><span class="s2">&quot;lvl2&quot;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span><span class="s2">&quot;ttype&quot;</span><span class="p">:</span><span class="n">ttype</span><span class="p">,</span><span class="s2">&quot;gf&quot;</span><span class="p">:</span><span class="n">gf</span><span class="p">,</span><span class="s2">&quot;de&quot;</span><span class="p">:</span><span class="n">de</span><span class="p">,</span><span class="s2">&quot;cups&quot;</span><span class="p">:</span><span class="n">cups</span>
                <span class="p">,</span><span class="s2">&quot;nspl&quot;</span><span class="p">:</span><span class="n">nspl</span><span class="p">,</span><span class="s2">&quot;splups&quot;</span><span class="p">:</span><span class="n">splups</span><span class="p">,</span><span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span></div>


<div class="viewcode-block" id="elvlcRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.elvlcRead.html#ChiantiPy.tools.io.elvlcRead">[docs]</a><span class="k">def</span> <span class="nf">elvlcRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">getExtended</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">useTh</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the new format elvlc files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`, optional</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    getExtended : `bool`</span>
<span class="sd">    verbose : `bool`</span>
<span class="sd">    useTh : `bool`</span>
<span class="sd">        If True, the theoretical values (ecmth and erydth) are inserted when</span>
<span class="sd">        an energy value for ecm or eryd is zero(=unknown)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="s1">&#39;</span><span class="si">%7i%30s%5s%5i%5s%5.1f%15.3f%15.3f</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="c1">#</span>
    <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;i7,a30,a5,i5,a5,f5.1,2f15.3&#39;</span><span class="p">)</span>
<span class="c1">#    elvlcFormat  = FortranFormat(fstring)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">elvlname</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">bname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">ions</span> <span class="o">=</span> <span class="n">bname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">elvlname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.elvlc&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">elvlname</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; elvlc file does not exist:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">elvlname</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
    <span class="n">status</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">elvlname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">nlvls</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ndata</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nlvls</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">s1a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">nlvls</span> <span class="o">=</span> <span class="n">nlvls</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">nlvls</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; nlvls = </span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">nlvls</span><span class="p">)))</span>
    <span class="n">lvl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">conf</span>  <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">term</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">spin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">spd</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">ecm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">ecmth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="n">pretty</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="k">if</span> <span class="n">getExtended</span><span class="p">:</span>
        <span class="n">extended</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nlvls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">115</span><span class="p">]))</span>
<span class="c1">#        inpt = FortranLine(s1[i][0:115],elvlcFormat)</span>
        <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">115</span><span class="p">])</span>
        <span class="n">lvl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">term</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">spd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">Spd</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">spd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">mult</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">inpt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span>
        <span class="n">ecm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">ecmth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ecm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">useTh</span><span class="p">:</span>
                <span class="n">ecm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecmth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stuff</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%1i%1s%3.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span> <span class="n">spin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">spd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">pretty</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stuff</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">getExtended</span><span class="p">:</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">extended</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">eryd</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2ryd</span> <span class="k">if</span> <span class="n">ecm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvls</span><span class="p">)]</span>
    <span class="n">erydth</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecmth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2ryd</span> <span class="k">if</span> <span class="n">ecmth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvls</span><span class="p">)]</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># this should skip the last &#39;-1&#39; in the file</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvls</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)):</span>
        <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lvl&quot;</span><span class="p">:</span><span class="n">lvl</span><span class="p">,</span><span class="s2">&quot;conf&quot;</span><span class="p">:</span><span class="n">conf</span><span class="p">,</span> <span class="s2">&quot;term&quot;</span><span class="p">:</span><span class="n">term</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">label</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">:</span><span class="n">spin</span><span class="p">,</span> <span class="s2">&quot;spd&quot;</span><span class="p">:</span><span class="n">spd</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span><span class="n">l</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span><span class="p">:</span><span class="n">j</span><span class="p">,</span>
             <span class="s1">&#39;mult&#39;</span><span class="p">:</span><span class="n">mult</span><span class="p">,</span> <span class="s2">&quot;ecm&quot;</span><span class="p">:</span><span class="n">ecm</span><span class="p">,</span> <span class="s1">&#39;eryd&#39;</span><span class="p">:</span><span class="n">eryd</span><span class="p">,</span><span class="s1">&#39;erydth&#39;</span><span class="p">:</span><span class="n">erydth</span><span class="p">,</span> <span class="s2">&quot;ecmth&quot;</span><span class="p">:</span><span class="n">ecmth</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">ref</span><span class="p">,</span>
             <span class="s2">&quot;pretty&quot;</span><span class="p">:</span><span class="n">pretty</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">elvlname</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">getExtended</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;extended&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extended</span>
    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="elvlcWrite"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.elvlcWrite.html#ChiantiPy.tools.io.elvlcWrite">[docs]</a><span class="k">def</span> <span class="nf">elvlcWrite</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">addLvl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">includeRyd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">includeEv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Write Chianti data to .elvlc file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    info : `dict`</span>
<span class="sd">        Information about the Chianti data to write. Should contain</span>
<span class="sd">        the following keys: ionS, the Chianti style name of the ion such as c_4</span>
<span class="sd">        term, a string showing the configuration</span>
<span class="sd">        spin, an integer of the spin of the state in LS coupling</span>
<span class="sd">        l, an integer of the angular momentum quantum number</span>
<span class="sd">        spd, an string for the alphabetic symbol of the angular momemtum, S, P, D, etc</span>
<span class="sd">        j, a floating point number, the total angular momentum</span>
<span class="sd">        ecm, the observed energy in inverse cm, if unknown, the value is 0.</span>
<span class="sd">        eryd, the observed energy in Rydbergs, if unknown, the value is 0.</span>
<span class="sd">        ecmth, the calculated energy from the scattering calculation, in inverse cm</span>
<span class="sd">        erydth, the calculated energy from the scattering calculation in Rydbergs</span>
<span class="sd">        ref, the references in the literature to the data in the input info</span>
<span class="sd">    outfile : `str`</span>
<span class="sd">        Output filename. ionS+&#39;.elvlc&#39; (in current directory) if None</span>
<span class="sd">    round : `int`</span>
<span class="sd">        input to `np.round&#39; to round input values to maintain the correct number of significant figures</span>
<span class="sd">    addLvl : `int`</span>
<span class="sd">        Add a constant value to the index of all levels</span>
<span class="sd">    includeRyd : `bool`</span>
<span class="sd">        If True, write the Rydberg energies in the extended area, delimited by a comma</span>
<span class="sd">    includeEv : `bool`</span>
<span class="sd">        If True, write the energies in eV in the extended area, delimited by a comma</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For use with files created after elvlc format change in November 2012</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ChiantiPy.tools.archival.elvlcWrite : Write .elvlc file using the old format.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">elvlcName</span> <span class="o">=</span> <span class="n">outfile</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gname</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ionS&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;&#39;ionS&#39;&#39; not included in input dict&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">elvlcName</span> <span class="o">=</span> <span class="n">gname</span> <span class="o">+</span> <span class="s1">&#39;.elvlc&#39;</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; elvlc file name = &#39;</span><span class="p">,</span> <span class="n">elvlcName</span><span class="p">))</span>
    <span class="c1">#</span>
<span class="c1">#    if not info.has_key(&#39;ecmx&#39;):</span>
<span class="c1">#        info[&#39;ecmx&#39;] = np.zeros_like(info[&#39;ecm&#39;])</span>
<span class="c1">#    if not info.has_key(&#39;erydx&#39;):</span>
<span class="c1">#        info[&#39;erydx&#39;] = np.zeros_like(info[&#39;eryd&#39;])</span>
    <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">nlvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">])</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nlvl</span>
    <span class="k">if</span> <span class="s1">&#39;eryd&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;eryd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2ryd</span>  <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="k">else</span>  <span class="o">-</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="s1">&#39;erydth &#39;</span><span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;erydth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2ryd</span>  <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="k">else</span>  <span class="o">-</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ecmth&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="s1">&#39;eV&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2Ev</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="k">else</span>  <span class="o">-</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="s1">&#39;eVth &#39;</span><span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;eVth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2Ev</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="k">else</span>  <span class="o">-</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ecmth&#39;</span><span class="p">]]</span>
   <span class="c1">#</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">elvlcName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span>  <span class="n">aterm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">]):</span>
        <span class="n">thisTerm</span> <span class="o">=</span> <span class="n">aterm</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>
        <span class="n">thisLabel</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1">#        print, &#39; len of thisTerm = &#39;, len(thisTerm)</span>
        <span class="n">pstring</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%7i%30s%5s%5i%5s%5.1f%15.3f%15.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">addLvl</span><span class="p">,</span> <span class="n">thisTerm</span><span class="p">,</span> <span class="n">thisLabel</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spin&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;spd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;j&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>  <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">round</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ecmth&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">round</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">includeRyd</span><span class="p">:</span>
             <span class="n">pstring</span> <span class="o">+=</span> <span class="s1">&#39; , </span><span class="si">%15.8f</span><span class="s1"> , </span><span class="si">%15.8f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;eryd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;erydth&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">includeEv</span><span class="p">:</span>
             <span class="n">pstring</span> <span class="o">+=</span> <span class="s1">&#39; , </span><span class="si">%15.8f</span><span class="s1"> , </span><span class="si">%15.8f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;eVth&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">pstring</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pstring</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">ilename:  &#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">elvlcName</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">aref</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">aref</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="fblvlRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.fblvlRead.html#ChiantiPy.tools.io.fblvlRead">[docs]</a><span class="k">def</span> <span class="nf">fblvlRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a Chianti energy level file for calculating the</span>
<span class="sd">    free-bound continuum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fstring</span> <span class="o">=</span> <span class="s1">&#39;i5,a20,2i5,a3,i5,2f20.3&#39;</span>
    <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="n">fstring</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">fblvlName</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">bname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">ions</span> <span class="o">=</span> <span class="n">bname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="n">ions</span><span class="p">)[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span>
        <span class="n">fblvlName</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.fblvl&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fblvlName</span><span class="p">):</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fblvlName</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">nlvls</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">while</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nlvls</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">s1a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
            <span class="n">nlvls</span> <span class="o">=</span> <span class="n">nlvls</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">nlvls</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; nlvls = </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">nlvls</span><span class="p">)))</span>
        <span class="n">lvl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="n">pqn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="n">spd</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="n">ecm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="n">ecmth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nlvls</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nlvls</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="c1">#            inpt=FortranLine(s1[i],elvlcFormat)</span>
            <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">lvl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">conf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">pqn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">spd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">mult</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">ecm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ecm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">ecmth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvls</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;lvl&quot;</span><span class="p">:</span><span class="n">lvl</span><span class="p">,</span><span class="s2">&quot;conf&quot;</span><span class="p">:</span><span class="n">conf</span><span class="p">,</span><span class="s1">&#39;pqn&#39;</span><span class="p">:</span><span class="n">pqn</span><span class="p">,</span><span class="s2">&quot;l&quot;</span><span class="p">:</span><span class="n">l</span><span class="p">,</span><span class="s2">&quot;spd&quot;</span><span class="p">:</span><span class="n">spd</span><span class="p">,</span><span class="s2">&quot;mult&quot;</span><span class="p">:</span><span class="n">mult</span><span class="p">,</span>
            <span class="s2">&quot;ecm&quot;</span><span class="p">:</span><span class="n">ecm</span><span class="p">,</span><span class="s1">&#39;ecmth&#39;</span><span class="p">:</span><span class="n">ecmth</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">fblvlName</span><span class="p">,</span>  <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39; fblvl file does not exist </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fblvlName</span><span class="p">)}</span></div>


<div class="viewcode-block" id="gffRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.gffRead.html#ChiantiPy.tools.io.gffRead">[docs]</a><span class="k">def</span> <span class="nf">gffRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the free-free gaunt factors of [1]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Sutherland, R. S., 1998, MNRAS, `300, 321</span>
<span class="sd">        &lt;http://adsabs.harvard.edu/abs/1998MNRAS.300..321S&gt;`_</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function reads the file and reverses the values of g2 and u</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span><span class="s1">&#39;gffgu.dat&#39;</span> <span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="c1">#  the 1d stuff below is to make it easy to use interp2d</span>
    <span class="n">ngamma</span> <span class="o">=</span> <span class="mi">41</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="mi">81</span>
    <span class="n">nvalues</span> <span class="o">=</span> <span class="n">ngamma</span><span class="o">*</span><span class="n">nu</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngamma</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">g21d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nvalues</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">u1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nvalues</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">gff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngamma</span><span class="p">,</span> <span class="n">nu</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">gff1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nvalues</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">iline</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">ivalue</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ig2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngamma</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nu</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">u</span><span class="p">[</span><span class="n">iu</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">u1d</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">g2</span><span class="p">[</span><span class="n">ig2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">g21d</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gff</span><span class="p">[</span><span class="n">ig2</span><span class="p">,</span> <span class="n">iu</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">gff1d</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">iline</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ivalue</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;g2&#39;</span><span class="p">:</span><span class="n">g2</span><span class="p">,</span> <span class="s1">&#39;g21d&#39;</span><span class="p">:</span><span class="n">g21d</span><span class="p">,</span>  <span class="s1">&#39;u&#39;</span><span class="p">:</span><span class="n">u</span><span class="p">,</span> <span class="s1">&#39;u1d&#39;</span><span class="p">:</span><span class="n">u1d</span><span class="p">,</span>  <span class="s1">&#39;gff&#39;</span><span class="p">:</span><span class="n">gff</span><span class="p">,</span>  <span class="s1">&#39;gff1d&#39;</span><span class="p">:</span><span class="n">gff1d</span><span class="p">}</span></div>


<div class="viewcode-block" id="gffintRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.gffintRead.html#ChiantiPy.tools.io.gffintRead">[docs]</a><span class="k">def</span> <span class="nf">gffintRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the integrated free-free gaunt factors of [1]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Sutherland, R. S., 1998, MNRAS, `300, 321</span>
<span class="sd">        &lt;http://adsabs.harvard.edu/abs/1998MNRAS.300..321S&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span><span class="s1">&#39;gffint.dat&#39;</span> <span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="n">ngamma</span> <span class="o">=</span> <span class="mi">41</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngamma</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">gffint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngamma</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngamma</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngamma</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngamma</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ivalue</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">start</span><span class="o">+</span><span class="n">ngamma</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">g2</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">gffint</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">s1</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">s2</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">s3</span><span class="p">[</span><span class="n">ivalue</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">ivalue</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;g2&#39;</span><span class="p">:</span><span class="n">g2</span><span class="p">,</span> <span class="s1">&#39;gffint&#39;</span><span class="p">:</span><span class="n">gffint</span><span class="p">,</span> <span class="s1">&#39;s1&#39;</span><span class="p">:</span><span class="n">s1</span><span class="p">,</span> <span class="s1">&#39;s2&#39;</span><span class="p">:</span><span class="n">s2</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">:</span><span class="n">s3</span><span class="p">}</span></div>


<div class="viewcode-block" id="itohRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.itohRead.html#ChiantiPy.tools.io.itohRead">[docs]</a><span class="k">def</span> <span class="nf">itohRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in the free-free gaunt factors of [1]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Itoh, N. et al., 2000, ApJS, `128, 125</span>
<span class="sd">        &lt;http://adsabs.harvard.edu/abs/2000ApJS..128..125I&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">itohName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span> <span class="s1">&#39;itoh.dat&#39;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">itohName</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">gff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">121</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
        <span class="n">gff</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;itohCoef&#39;</span><span class="p">:</span><span class="n">gff</span><span class="p">}</span></div>


<div class="viewcode-block" id="klgfbRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.klgfbRead.html#ChiantiPy.tools.io.klgfbRead">[docs]</a><span class="k">def</span> <span class="nf">klgfbRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read CHIANTI files containing the free-bound gaunt factors for n=1-6 from [1]_.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;pe&#39;, &#39;klgfb&#39;} : `dict`</span>
<span class="sd">        Photon energy and the free-bound gaunt factors</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Karzas and Latter, 1961, ApJSS, `6, 167</span>
<span class="sd">        &lt;http://adsabs.harvard.edu/abs/1961ApJS....6..167K&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span> <span class="s1">&#39;klgfb.dat&#39;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="n">ngfb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">nume</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">gfb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ngfb</span><span class="p">,</span> <span class="n">ngfb</span><span class="p">,</span> <span class="n">nume</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">nlines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="c1">#        print &#39;nlines, nume, ngfb = &#39;, nlines,  nume, ngfb</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nlines</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">gfb</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pe&#39;</span><span class="p">:</span><span class="n">pe</span><span class="p">,</span> <span class="s1">&#39;klgfb&#39;</span><span class="p">:</span><span class="n">gfb</span><span class="p">}</span></div>


<div class="viewcode-block" id="ioneqRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.ioneqRead.html#ChiantiPy.tools.io.ioneqRead">[docs]</a><span class="k">def</span> <span class="nf">ioneqRead</span><span class="p">(</span><span class="n">ioneqname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">minIoneq</span><span class="o">=</span><span class="mf">1.e-20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads an ioneq file</span>
<span class="sd">    ionization equilibrium values less then minIoneq are returns as zeros</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;ioneqname&#39;,&#39;ioneqAll&#39;,&#39;ioneqTemperature&#39;,&#39;ioneqRef&#39;} : `dict`</span>
<span class="sd">        Ionization equilibrium values and the reference to the literature</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;XUVTOP&quot;</span><span class="p">]</span>
    <span class="n">ioneqdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s1">&#39;ioneq&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ioneqname</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="c1"># the user will select an ioneq file</span>
        <span class="n">fname1</span> <span class="o">=</span> <span class="n">chgui</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">chpicker</span><span class="p">(</span><span class="n">ioneqdir</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;*.ioneq&#39;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Select an Ionization Equilibrium file&#39;</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ioneqdir</span><span class="p">,</span> <span class="n">fname1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; no ioneq file selected&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ioneqfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">ioneqname</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">ioneqfilename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">listFiles</span><span class="p">(</span><span class="n">ioneqdir</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s1">&#39;ioneq&#39;</span><span class="p">,</span><span class="n">ioneqname</span><span class="o">+</span><span class="s1">&#39;.ioneq&#39;</span><span class="p">)</span>
        <span class="n">newlist</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="s1">&#39;*.ioneq&#39;</span><span class="p">)</span>
        <span class="n">baselist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">newlist</span><span class="p">:</span>
            <span class="n">baselist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">one</span><span class="p">))</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">baselist</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ioneqname</span><span class="o">+</span><span class="s1">&#39;.ioneq&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; ioneq file not found:  &#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; the following files do exist: &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">newlist</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">one</span><span class="p">)))</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">baselist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ioneqname</span><span class="o">+</span><span class="s1">&#39;.ioneq&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; file exists:  &#39;</span><span class="p">,</span> <span class="n">newlist</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">newlist</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; found more than one ioneq file&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>
            <span class="k">return</span>
    <span class="c1">#</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">ntemp</span><span class="p">,</span><span class="n">nele</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; ntemp, nele = </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ntemp</span><span class="p">,</span> <span class="n">nele</span><span class="p">)))</span>
    <span class="n">nTemperature</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
    <span class="n">nElement</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nele</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">header_linet</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nTemperature</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;f6.2&#39;</span><span class="p">)</span>
    <span class="n">ioneqTemperature</span> <span class="o">=</span> <span class="n">header_linet</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ioneqTemperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ioneqTemperature</span><span class="p">[:],</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="n">ioneqTemperature</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="n">ioneqTemperature</span>
    <span class="n">nlines</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">aline</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nlines</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">aline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
        <span class="n">nlines</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nlines</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
<span class="c1">#    ioneqformat=FortranFormat(&#39;2i3,&#39;+str(nTemperature)+&#39;e10.2&#39;)</span>
    <span class="n">header_lineq</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;2i3,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nTemperature</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;e10.2&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ioneqAll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nElement</span><span class="p">,</span><span class="n">nElement</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nTemperature</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nlines</span><span class="p">):</span>
<span class="c1">#        out=FortranLine(s1[iline],ioneqformat)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">header_lineq</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">iline</span><span class="p">])</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ion</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ioneqAll</span><span class="p">[</span><span class="n">iz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ion</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nTemperature</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span><span class="s1">&#39;Float64&#39;</span><span class="p">))</span>
    <span class="n">ioneqAll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ioneqAll</span> <span class="o">&gt;</span> <span class="n">minIoneq</span><span class="p">,</span> <span class="n">ioneqAll</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">ioneqRef</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">s1</span><span class="p">[</span><span class="n">nlines</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">ioneqRef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># gets rid of the \n</span>
    <span class="k">del</span> <span class="n">s1</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ioneqname&#39;</span><span class="p">:</span><span class="n">ioneqname</span><span class="p">,</span><span class="s1">&#39;ioneqAll&#39;</span><span class="p">:</span><span class="n">ioneqAll</span><span class="p">,</span><span class="s1">&#39;ioneqTemperature&#39;</span><span class="p">:</span><span class="n">ioneqTemperature</span><span class="p">,</span><span class="s1">&#39;ioneqRef&#39;</span><span class="p">:</span><span class="n">ioneqRef</span><span class="p">}</span></div>


<div class="viewcode-block" id="ipRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.ipRead.html#ChiantiPy.tools.io.ipRead">[docs]</a><span class="k">def</span> <span class="nf">ipRead</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the ionization potential file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ip : array-like</span>
<span class="sd">        Ionization potential (in eV)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">topdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;XUVTOP&quot;</span><span class="p">]</span>
    <span class="n">ipname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">topdir</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">,</span><span class="s1">&#39;chianti.ip&#39;</span><span class="p">)</span>
    <span class="n">ipfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ipname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ipfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">ipfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">nip</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ndata</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">maxz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">nip</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">nip</span> <span class="o">=</span> <span class="n">nip</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">maxz</span><span class="p">:</span>
            <span class="n">maxz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; maxz = </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">maxz</span><span class="p">)))</span>
    <span class="n">nip</span> <span class="o">=</span> <span class="n">nip</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxz</span><span class="p">,</span> <span class="n">maxz</span><span class="p">),</span> <span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nip</span><span class="p">]:</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ip</span><span class="p">[</span><span class="n">iz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ion</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">s2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ip</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2Ev</span></div>


<div class="viewcode-block" id="masterListRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.masterListRead.html#ChiantiPy.tools.io.masterListRead">[docs]</a><span class="k">def</span> <span class="nf">masterListRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a CHIANTI masterlist file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    masterlist : `list`</span>
<span class="sd">        All ions in Chianti database</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;XUVTOP&quot;</span><span class="p">]</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s1">&#39;masterlist&#39;</span><span class="p">,</span><span class="s1">&#39;masterlist.ions&#39;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">masterlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)):</span>
        <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">s1a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">masterlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">masterlist</span></div>


<div class="viewcode-block" id="masterListInfo"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.masterListInfo.html#ChiantiPy.tools.io.masterListInfo">[docs]</a><span class="k">def</span> <span class="nf">masterListInfo</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get information about ions in the CHIANTI masterlist.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    masterListInfo : `dict`</span>
<span class="sd">        {&#39;wmin&#39;, &#39;wmax&#39;, &#39;tmin&#39;, &#39;tmax&#39;} Minimum and maximum wavelengths in</span>
<span class="sd">        the wgfa file. Minimum and maximum temperatures for which the</span>
<span class="sd">        ionization balance is nonzero.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function speeds up multi-ion spectral calculations.</span>
<span class="sd">    The information is stored in a pickled file &#39;masterlist_ions.pkl&#39;</span>
<span class="sd">    If the file is not found, one will be created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;XUVTOP&quot;</span><span class="p">]</span>
    <span class="n">infoPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s1">&#39;masterlist&#39;</span><span class="p">)</span>
    <span class="n">infoName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s1">&#39;masterlist&#39;</span><span class="p">,</span><span class="s1">&#39;masterlist_ions.pkl&#39;</span><span class="p">)</span>
    <span class="c1">#masterName=os.path.join(dir,&#39;masterlist&#39;,&#39;masterlist.ions&#39;)</span>
    <span class="c1">#</span>
    <span class="n">makeNew</span> <span class="o">=</span> <span class="n">force</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">infoName</span><span class="p">)</span>
<span class="c1">#    if os.path.isfile(infoName):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">makeNew</span><span class="p">:</span>
<span class="c1">#       print &#39; file exists - &#39;,  infoName</span>
        <span class="n">pfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">infoName</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">masterListInfo</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pfile</span><span class="p">)</span>
        <span class="n">pfile</span><span class="o">.</span><span class="n">close</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">infoPath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
        <span class="c1"># the file does not exist but we have write access and will create it</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">defaultsRead</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; defaults = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">defaults</span><span class="p">))))</span>
        <span class="n">ioneqName</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;ioneqfile&#39;</span><span class="p">]</span>
        <span class="n">ioneq</span> <span class="o">=</span> <span class="n">ioneqRead</span><span class="p">(</span><span class="n">ioneqname</span> <span class="o">=</span> <span class="n">ioneqName</span><span class="p">)</span>
        <span class="n">masterList</span> <span class="o">=</span> <span class="n">masterListRead</span><span class="p">()</span>
        <span class="n">masterListInfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">haveZ</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">31</span>
        <span class="n">haveStage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">31</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="s1">&#39;Int32&#39;</span><span class="p">)</span>
        <span class="n">haveDielectronic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">31</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="s1">&#39;Int32&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">masterList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; ion = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">one</span><span class="p">)))</span>
            <span class="n">ionInfo</span> <span class="o">=</span> <span class="n">convertName</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">ionInfo</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="n">ionInfo</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]</span>
            <span class="n">haveZ</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">dielectronic</span> <span class="o">=</span> <span class="n">ionInfo</span><span class="p">[</span><span class="s1">&#39;Dielectronic&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dielectronic</span><span class="p">:</span>
                <span class="n">haveDielectronic</span><span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">haveStage</span><span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">thisIoneq</span> <span class="o">=</span> <span class="n">ioneq</span><span class="p">[</span><span class="s1">&#39;ioneqAll&#39;</span><span class="p">][</span><span class="n">z</span><span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stage</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">dielectronic</span><span class="p">]</span>
            <span class="n">good</span> <span class="o">=</span> <span class="n">thisIoneq</span> <span class="o">&gt;</span> <span class="mf">0.</span>
            <span class="n">goodTemp</span> <span class="o">=</span> <span class="n">ioneq</span><span class="p">[</span><span class="s1">&#39;ioneqTemperature&#39;</span><span class="p">][</span><span class="n">good</span><span class="p">]</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">goodTemp</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">goodTemp</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">vgood</span> <span class="o">=</span> <span class="n">thisIoneq</span> <span class="o">==</span> <span class="n">thisIoneq</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">vgoodTemp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ioneq</span><span class="p">[</span><span class="s1">&#39;ioneqTemperature&#39;</span><span class="p">][</span><span class="n">vgood</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">wgfa</span> <span class="o">=</span> <span class="n">wgfaRead</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
            <span class="n">nZeros</span> <span class="o">=</span> <span class="n">wgfa</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
            <span class="c1"># two-photon transitions are denoted by a wavelength of zero (0.)</span>
            <span class="k">while</span> <span class="n">nZeros</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">wgfa</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                <span class="n">nZeros</span> <span class="o">=</span> <span class="n">wgfa</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
            <span class="c1"># unobserved lines are denoted with a negative wavelength</span>
            <span class="n">wvl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wgfa</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">],</span> <span class="s1">&#39;float64&#39;</span><span class="p">))</span>
            <span class="n">wmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wvl</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="n">wmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wvl</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">masterListInfo</span><span class="p">[</span><span class="n">one</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wmin&#39;</span><span class="p">:</span><span class="n">wmin</span><span class="p">,</span> <span class="s1">&#39;wmax&#39;</span><span class="p">:</span><span class="n">wmax</span><span class="p">,</span> <span class="s1">&#39;tmin&#39;</span><span class="p">:</span><span class="n">tmin</span><span class="p">,</span> <span class="s1">&#39;tmax&#39;</span><span class="p">:</span><span class="n">tmax</span><span class="p">,</span> <span class="s1">&#39;tIoneqMax&#39;</span><span class="p">:</span><span class="n">vgoodTemp</span><span class="p">}</span>
        <span class="n">masterListInfo</span><span class="p">[</span><span class="s1">&#39;haveZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">haveZ</span>
        <span class="n">masterListInfo</span><span class="p">[</span><span class="s1">&#39;haveStage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">haveStage</span>
        <span class="n">masterListInfo</span><span class="p">[</span><span class="s1">&#39;haveDielectronic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">haveDielectronic</span>
        <span class="c1">#  now do the bare ions from H thru Zn</span>
        <span class="c1">#  these are only involved in the continuum</span>
        <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
            <span class="n">ions</span> <span class="o">=</span> <span class="n">zion2name</span><span class="p">(</span><span class="n">iz</span><span class="p">,</span> <span class="n">iz</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">thisIoneq</span> <span class="o">=</span> <span class="n">ioneq</span><span class="p">[</span><span class="s1">&#39;ioneqAll&#39;</span><span class="p">][</span><span class="n">iz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iz</span><span class="p">]</span>
            <span class="n">good</span> <span class="o">=</span> <span class="n">thisIoneq</span> <span class="o">&gt;</span> <span class="mf">0.</span>
            <span class="n">goodTemp</span> <span class="o">=</span> <span class="n">ioneq</span><span class="p">[</span><span class="s1">&#39;ioneqTemperature&#39;</span><span class="p">][</span><span class="n">good</span><span class="p">]</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">goodTemp</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">goodTemp</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">wmin</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">wmax</span> <span class="o">=</span> <span class="mf">1.e+30</span>
            <span class="n">masterListInfo</span><span class="p">[</span><span class="n">ions</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wmin&#39;</span><span class="p">:</span><span class="n">wmin</span><span class="p">,</span> <span class="s1">&#39;wmax&#39;</span><span class="p">:</span><span class="n">wmax</span><span class="p">,</span> <span class="s1">&#39;tmin&#39;</span><span class="p">:</span><span class="n">tmin</span><span class="p">,</span> <span class="s1">&#39;tmax&#39;</span><span class="p">:</span><span class="n">tmax</span><span class="p">}</span>
        <span class="n">pfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">infoName</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">masterListInfo</span><span class="p">,</span> <span class="n">pfile</span><span class="p">)</span>
        <span class="n">pfile</span><span class="o">.</span><span class="n">close</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># the file does not exist and we do NOT have write access to creat it</span>
        <span class="c1"># will just make an inefficient, useless version</span>
        <span class="n">masterListInfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">masterList</span><span class="p">:</span>
            <span class="n">ionInfo</span> <span class="o">=</span> <span class="n">convertName</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">ionInfo</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="n">ionInfo</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]</span>
            <span class="n">dielectronic</span> <span class="o">=</span> <span class="n">ionInfo</span><span class="p">[</span><span class="s1">&#39;Dielectronic&#39;</span><span class="p">]</span>
            <span class="n">wmin</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">wmax</span> <span class="o">=</span> <span class="mf">1.e+30</span>
            <span class="n">masterListInfo</span><span class="p">[</span><span class="n">one</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wmin&#39;</span><span class="p">:</span><span class="n">wmin</span><span class="p">,</span> <span class="s1">&#39;wmax&#39;</span><span class="p">:</span><span class="n">wmax</span><span class="p">,</span> <span class="s1">&#39;tmin&#39;</span><span class="p">:</span><span class="mf">1.e+4</span><span class="p">,</span> <span class="s1">&#39;tmax&#39;</span><span class="p">:</span><span class="mf">1.e+9</span><span class="p">}</span>
        <span class="c1">#  now do the bare ions from H thru Zn</span>
        <span class="c1">#  these are only involved in the continuum</span>
        <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
            <span class="n">ions</span> <span class="o">=</span> <span class="n">zion2name</span><span class="p">(</span><span class="n">iz</span><span class="p">,</span> <span class="n">iz</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">wmin</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">wmax</span> <span class="o">=</span> <span class="mf">1.e+30</span>
            <span class="n">masterListInfo</span><span class="p">[</span><span class="n">ions</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wmin&#39;</span><span class="p">:</span><span class="n">wmin</span><span class="p">,</span> <span class="s1">&#39;wmax&#39;</span><span class="p">:</span><span class="n">wmax</span><span class="p">,</span> <span class="s1">&#39;tmin&#39;</span><span class="p">:</span><span class="mf">1.e+4</span><span class="p">,</span> <span class="s1">&#39;tmax&#39;</span><span class="p">:</span><span class="mf">1.e+9</span><span class="p">}</span>
        <span class="n">pfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">infoName</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">masterListInfo</span><span class="p">,</span> <span class="n">pfile</span><span class="p">)</span>
        <span class="n">pfile</span><span class="o">.</span><span class="n">close</span>
        <span class="n">masterListInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;noInfo&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">masterListInfo</span></div>


<div class="viewcode-block" id="photoxRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.photoxRead.html#ChiantiPy.tools.io.photoxRead">[docs]</a><span class="k">def</span> <span class="nf">photoxRead</span><span class="p">(</span><span class="n">ions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read CHIANTI photoionization .photox files</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;lvl1&#39;, &#39;lvl2&#39;, &#39;energy&#39;, &#39;cross&#39;, &#39;ref&#39;} : `dict`</span>
<span class="sd">        Energy (in Rydbergs) and cross section (in :math:`\mathrm{cm}^{-2}`)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The photox files are not in any released version of the CHIANTI database.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">zion</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zion</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">zion</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; this is a bare nucleus that has no ionization rate&#39;</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="c1">#</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
    <span class="n">paramname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.photox&#39;</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">paramname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span>
    <span class="c1"># get number of energies</span>
<span class="c1">#    neng = int(lines[0][0:6])</span>
    <span class="n">dataEnd</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lvl1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cross</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">icounter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">dataEnd</span><span class="p">:</span>
        <span class="n">lvl11</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="p">][:</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">lvl21</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="p">][</span><span class="mi">8</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
        <span class="n">ener</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="p">][</span><span class="mi">15</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">energy1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ener</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">icounter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">irsl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="p">][:</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">ind0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="p">][</span><span class="mi">8</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">irsl</span> <span class="o">!=</span> <span class="n">lvl11</span> <span class="ow">or</span> <span class="n">ind0</span> <span class="o">!=</span> <span class="n">lvl21</span><span class="p">:</span>
            <span class="c1"># this only happens if the file was written incorrectly</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; lvl1, lvl2 = </span><span class="si">%7i</span><span class="s1"> </span><span class="si">%7i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">lvl11</span><span class="p">,</span> <span class="n">lvl21</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; irsl, indo = </span><span class="si">%7i</span><span class="s1"> </span><span class="si">%7i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">irsl</span><span class="p">,</span>  <span class="n">ind0</span><span class="p">)))</span>
            <span class="k">return</span>
        <span class="n">crs</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="p">][</span><span class="mi">15</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">cross1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">lvl1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lvl11</span><span class="p">)</span>
        <span class="n">lvl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lvl21</span><span class="p">)</span>
        <span class="n">energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy1</span><span class="p">)</span>
        <span class="n">cross</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross1</span><span class="p">)</span>
        <span class="n">icounter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">dataEnd</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">)</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">icounter</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cross</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">cross</span><span class="p">,</span>  <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span></div>


<div class="viewcode-block" id="rrRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.rrRead.html#ChiantiPy.tools.io.rrRead">[docs]</a><span class="k">def</span> <span class="nf">rrRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read CHIANTI radiative recombination .rrparams files</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;rrtype&#39;,&#39;params&#39;,&#39;ref&#39;} : `dict`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">paramname</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">paramname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.rrparams&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">paramname</span><span class="p">):</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">paramname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1">#  need to read first line and see how many elements</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">rrtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">rrtype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># a Badnell type</span>
<span class="c1">#            fmt=FortranFormat(&#39;3i5,e12.4,f10.5,2e12.4&#39;)</span>
            <span class="n">header_line</span> <span class="o">=</span>  <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;3i5,e12.4,f10.5,2e12.4&#39;</span><span class="p">)</span>
<span class="c1">#            params=FortranLine(lines[1],fmt)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">RrParams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rrtype&#39;</span><span class="p">:</span><span class="n">rrtype</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">params</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">rrtype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># a Badnell type</span>
<span class="c1">#            fmt=FortranFormat(&#39;3i5,e12.4,f10.5,2e11.4,f10.5,e12.4&#39;)</span>
            <span class="n">header_line</span> <span class="o">=</span>  <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;3i5,e12.4,f10.5,2e11.4,f10.5,e12.4&#39;</span><span class="p">)</span>
<span class="c1">#            params=FortranLine(lines[1],fmt)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">RrParams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rrtype&#39;</span><span class="p">:</span><span class="n">rrtype</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">params</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">rrtype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># a Shull type</span>
<span class="c1">#            fmt=FortranFormat(&#39;2i5,2e12.4&#39;)</span>
            <span class="n">header_line</span> <span class="o">=</span>  <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;2i5,2e12.4&#39;</span><span class="p">)</span>
<span class="c1">#            params=FortranLine(lines[1],fmt)</span>
            <span class="n">params</span>  <span class="o">=</span>  <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">RrParams</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rrtype&#39;</span><span class="p">:</span><span class="n">rrtype</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">params</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">RrParams</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; for ion </span><span class="si">%5s</span><span class="s1"> unknown RR type = </span><span class="si">%5i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">rrtype</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">RrParams</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rrtype&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span></div>

<div class="viewcode-block" id="rrLossRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.rrLossRead.html#ChiantiPy.tools.io.rrLossRead">[docs]</a><span class="k">def</span> <span class="nf">rrLossRead</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39; to read the Mao 2017 rr loss parameters</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Mao J., Kaastra J., Badnell N.R., `2017 Astron. Astrophys. 599, A10</span>
<span class="sd">        &lt;http://adsabs.harvard.edu/abs/2017A%26A...599A..10M&gt;`_</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">],</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span> <span class="s1">&#39;rrloss_mao_2017_pars.dat&#39;</span><span class="p">)</span>
    <span class="n">inpt</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">inpt</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">inpt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">iso</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mdp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">iso</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">a0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">b0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">c0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">a1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">b1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">a2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">]))</span>
        <span class="n">b2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">]))</span>
        <span class="n">mdp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">]))</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;iso&#39;</span><span class="p">:</span><span class="n">iso</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;a0&#39;</span><span class="p">:</span><span class="n">a0</span><span class="p">,</span> <span class="s1">&#39;b0&#39;</span><span class="p">:</span><span class="n">b0</span><span class="p">,</span> <span class="s1">&#39;c0&#39;</span><span class="p">:</span><span class="n">c0</span><span class="p">,</span> <span class="s1">&#39;a1&#39;</span><span class="p">:</span><span class="n">a1</span><span class="p">,</span> <span class="s1">&#39;b1&#39;</span><span class="p">:</span><span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;a2&#39;</span><span class="p">:</span><span class="n">a2</span><span class="p">,</span> <span class="s1">&#39;b2&#39;</span><span class="p">:</span><span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;mdp&#39;</span><span class="p">:</span><span class="n">mdp</span><span class="p">}</span></div>


<div class="viewcode-block" id="scupsRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.scupsRead.html#ChiantiPy.tools.io.scupsRead">[docs]</a><span class="k">def</span> <span class="nf">scupsRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read the new format v8 scups file containing the scaled temperature and upsilons from [1]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`, optional</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    verbose : `bool`</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Burgess, A. and Tully, J. A., 1992, A&amp;A, `254, 436 &lt;http://adsabs.harvard.edu/abs/1992A%26A...254..436B&gt;`_</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">scupsFileName</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">bname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">)</span>
        <span class="n">ions</span> <span class="o">=</span> <span class="n">bname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">scupsFileName</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.scups&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; elvlc file does not exist:  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
    <span class="c1">#status = 1</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; scupsFileName = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">))</span>
        <span class="n">inpt</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">inpt</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">inpt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;file does not exist: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39;file does not exist&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">scupsFileName</span><span class="p">)}</span>
        <span class="k">return</span>
    <span class="c1">#ll = lines[1].split()</span>
    <span class="c1">#temp = np.asarray(ll[3:], &#39;float64&#39;)</span>
    <span class="n">minusOne</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">minusOne</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;-1&#39;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="p">][:</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">minusOne</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ntrans</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
    <span class="c1">#print(&#39; counter %10i ntrans %10i&#39;%(counter, ntrans))</span>
    <span class="n">lvl1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">de</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lim</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ntemp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">btemp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bscups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#print(&#39; counter %10i ntrans %10i&#39;%(counter, ntrans))</span>
    <span class="c1"># the int seems to be needed for Python3</span>
    <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ntrans</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="o">+</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">ll1</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">lvl1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">lvl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">de</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">lim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">ntemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">ttype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">cups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ll1</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
        <span class="n">ll2</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">ll3</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="c1">#        print &#39; ll2 = &#39;, ll2</span>
<span class="c1">#        print &#39; gf = &#39;, ll2[2]</span>
        <span class="n">btemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ll2</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">))</span>
        <span class="n">bscups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ll3</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">))</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">3</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">counter</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aline</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ions&#39;</span><span class="p">:</span><span class="n">ions</span><span class="p">,</span> <span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">:</span><span class="n">de</span><span class="p">,</span> <span class="s1">&#39;gf&#39;</span><span class="p">:</span><span class="n">gf</span><span class="p">,</span> <span class="s1">&#39;lim&#39;</span><span class="p">:</span><span class="n">lim</span><span class="p">,</span> <span class="s1">&#39;ttype&#39;</span><span class="p">:</span><span class="n">ttype</span><span class="p">,</span><span class="s1">&#39;cups&#39;</span><span class="p">:</span><span class="n">cups</span><span class="p">,</span><span class="s1">&#39;ntemp&#39;</span><span class="p">:</span><span class="n">ntemp</span><span class="p">,</span> <span class="s1">&#39;btemp&#39;</span><span class="p">:</span><span class="n">btemp</span><span class="p">,</span> <span class="s1">&#39;bscups&#39;</span><span class="p">:</span><span class="n">bscups</span><span class="p">,</span> <span class="s1">&#39;ntrans&#39;</span><span class="p">:</span><span class="n">ntrans</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">ref</span><span class="p">}</span></div>


<div class="viewcode-block" id="splomRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.splomRead.html#ChiantiPy.tools.io.splomRead">[docs]</a><span class="k">def</span> <span class="nf">splomRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">ea</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read chianti .splom files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    ea : `bool`</span>
<span class="sd">        Read .easplom file</span>
<span class="sd">    filename : `str`, optional</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;lvl1&#39;, &#39;lvl2&#39;, &#39;ttype&#39;, &#39;gf&#39;, &#39;deryd&#39;, &#39;c&#39;, &#39;splom&#39;, &#39;ref&#39;} : `dict`</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Still needed for ionization cross sections</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ea</span><span class="p">:</span>
            <span class="n">splomname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.easplom&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">splomname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.splom&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">splomname</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">splomname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="c1">#  need to read first line and see how many elements</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="c1">#indices=line1[0:15]</span>
    <span class="n">remainder</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
    <span class="n">nom</span> <span class="o">=</span> <span class="n">remainder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="c1">#    format = FortranFormat(&#39;5i3,&#39;+str(len(nom))+&#39;E10.2&#39;)</span>
    <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;5i3,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nom</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;E10.2&#39;</span><span class="p">)</span>
    <span class="c1">#  go back to the beginning</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">iline</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lvl1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">de</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">splom</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#ntrans = 0</span>
    <span class="k">while</span> <span class="n">data</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="c1">#        splomdat = FortranLine(lines[iline],format)</span>
        <span class="n">splomdat</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">])</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">splomdat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="n">splomdat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">tt1</span> <span class="o">=</span> <span class="n">splomdat</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">gf1</span> <span class="o">=</span> <span class="n">splomdat</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">de1</span> <span class="o">=</span> <span class="n">splomdat</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">splomdat</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">splom1</span> <span class="o">=</span> <span class="n">splomdat</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
        <span class="n">lvl1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="p">))</span>
        <span class="n">lvl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">l2</span><span class="p">))</span>
        <span class="n">ttype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tt1</span><span class="p">))</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">gf1</span><span class="p">))</span>
        <span class="n">de</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">de1</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">f1</span><span class="p">))</span>
        <span class="n">splom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splom1</span><span class="p">)</span>
        <span class="n">iline</span> <span class="o">=</span> <span class="n">iline</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">hdr</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">de</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="n">splomout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">splom</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
    <span class="n">splomout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">splomout</span><span class="p">)</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># note:  de is in Rydbergs</span>
    <span class="n">splom</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lvl1&quot;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span><span class="s2">&quot;lvl2&quot;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span><span class="s2">&quot;ttype&quot;</span><span class="p">:</span><span class="n">ttype</span><span class="p">,</span><span class="s2">&quot;gf&quot;</span><span class="p">:</span><span class="n">gf</span><span class="p">,</span><span class="s2">&quot;deryd&quot;</span><span class="p">:</span><span class="n">de</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">:</span><span class="n">f</span>
        <span class="p">,</span><span class="s2">&quot;splom&quot;</span><span class="p">:</span><span class="n">splomout</span><span class="p">,</span><span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">hdr</span><span class="p">}</span>
    <span class="k">return</span>  <span class="n">splom</span></div>


<div class="viewcode-block" id="splupsRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.splupsRead.html#ChiantiPy.tools.io.splupsRead">[docs]</a><span class="k">def</span> <span class="nf">splupsRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;splups&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a CHIANTI .splups file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`, optional</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    filetype : `str`, optional</span>
<span class="sd">        {`psplups`,`cisplups`,`splups`} Type of file to read</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;lvl1&#39;, &#39;lvl2&#39;, &#39;ttype&#39;, &#39;gf&#39;, &#39;de&#39;, &#39;cups&#39;, &#39;bsplups&#39;, &#39;ref&#39;} : `dict`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">splupsname</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">splupsname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">filetype</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">splupsname</span><span class="p">):</span>
        <span class="c1">#TODO: raise exception here or just let the open() function do that for us</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;file not found&#39;</span><span class="p">:</span><span class="n">splupsname</span><span class="p">}</span>
    <span class="c1"># there is splups/psplups data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">splupsname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">nsplups</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">while</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nsplups</span><span class="p">][:]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">s1a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
            <span class="n">nsplups</span> <span class="o">=</span> <span class="n">nsplups</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">nsplups</span> <span class="o">=</span> <span class="n">nsplups</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">ttype</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="n">gf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsplups</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsplups</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">cups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsplups</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">nspl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
<span class="c1">#        splups=np.zeros((nsplups,9),&#39;Float64&#39;)</span>
        <span class="n">splups</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nsplups</span>
        <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;psplups&#39;</span><span class="p">:</span>
<span class="c1">#            splupsFormat1 = FortranFormat(&#39;3i3,8e10.3&#39;)</span>
<span class="c1">#            splupsFormat2 = FortranFormat(&#39;3i3,3e10.3&#39;)</span>
            <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;3i3,3e10.3&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
<span class="c1">#            splupsFormat1=&#39;(6x,3i3,8e10.3)&#39;</span>
<span class="c1">#            splupsFormat2 = FortranFormat(&#39;6x,3i3,3e10.3&#39;)</span>
            <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="s1">&#39;6x,3i3,3e10.3&#39;</span><span class="p">)</span>        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsplups</span><span class="p">):</span>
<span class="c1">#            inpt=FortranLine(s1[i],splupsFormat2)</span>
            <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">lvl1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lvl2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ttype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">gf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">de</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">cups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;psplups&#39;</span><span class="p">:</span>
                <span class="n">as1</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">39</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">as1</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">45</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">nspl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">as1</span><span class="p">)</span><span class="o">//</span><span class="mi">10</span>
<span class="c1">#            splupsFormat3 = FortranFormat(str(nspl[i])+&#39;E10.2&#39;)</span>
<span class="c1">#            splupsFormat3 = &#39;(&#39; + str(nspl[i]) + &#39;e10.3&#39; + &#39;)&#39;</span>
            <span class="n">header_line3</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nspl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;e10.3&#39;</span> <span class="p">)</span>
<span class="c1">#            inpt = FortranLine(as1, splupsFormat3)</span>
            <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line3</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">as1</span><span class="p">)</span>
            <span class="n">spl1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">inpt</span><span class="p">[:],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">splups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spl1</span>
        <span class="c1">#</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsplups</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)):</span>
            <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s1">&#39;psplups&#39;</span><span class="p">:</span>
<span class="c1">#            self.Npsplups=nsplups</span>
<span class="c1">#            self.Psplups={&quot;lvl1&quot;:lvl1,&quot;lvl2&quot;:lvl2,&quot;ttype&quot;:ttype,&quot;gf&quot;:gf,&quot;de&quot;:de,&quot;cups&quot;:cups</span>
<span class="c1">#                ,&quot;nspl&quot;:nspl,&quot;splups&quot;:splups,&quot;ref&quot;:ref}</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;lvl1&quot;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span><span class="s2">&quot;lvl2&quot;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span><span class="s2">&quot;ttype&quot;</span><span class="p">:</span><span class="n">ttype</span><span class="p">,</span><span class="s2">&quot;gf&quot;</span><span class="p">:</span><span class="n">gf</span><span class="p">,</span><span class="s2">&quot;de&quot;</span><span class="p">:</span><span class="n">de</span><span class="p">,</span><span class="s2">&quot;cups&quot;</span><span class="p">:</span><span class="n">cups</span>
                <span class="p">,</span><span class="s2">&quot;nspl&quot;</span><span class="p">:</span><span class="n">nspl</span><span class="p">,</span><span class="s2">&quot;splups&quot;</span><span class="p">:</span><span class="n">splups</span><span class="p">,</span><span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">splupsname</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
<span class="c1">#            self.Splups={&quot;lvl1&quot;:lvl1,&quot;lvl2&quot;:lvl2,&quot;ttype&quot;:ttype,&quot;gf&quot;:gf,&quot;de&quot;:de,&quot;cups&quot;:cups</span>
<span class="c1">#                ,&quot;nspl&quot;:nspl,&quot;splups&quot;:splups,&quot;ref&quot;:ref}</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;lvl1&quot;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span><span class="s2">&quot;lvl2&quot;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span><span class="s2">&quot;ttype&quot;</span><span class="p">:</span><span class="n">ttype</span><span class="p">,</span><span class="s2">&quot;gf&quot;</span><span class="p">:</span><span class="n">gf</span><span class="p">,</span><span class="s2">&quot;de&quot;</span><span class="p">:</span><span class="n">de</span><span class="p">,</span><span class="s2">&quot;cups&quot;</span><span class="p">:</span><span class="n">cups</span>
                <span class="p">,</span><span class="s2">&quot;nspl&quot;</span><span class="p">:</span><span class="n">nspl</span><span class="p">,</span><span class="s2">&quot;splups&quot;</span><span class="p">:</span><span class="n">splups</span><span class="p">,</span><span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">splupsname</span><span class="p">}</span></div>

<div class="viewcode-block" id="trRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.trRead.html#ChiantiPy.tools.io.trRead">[docs]</a><span class="k">def</span> <span class="nf">trRead</span><span class="p">(</span><span class="n">ionS</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; read the files containing total recombination rates .trparams</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">stuff</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="n">ionS</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span>
    <span class="n">trname</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.trparams&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">trname</span><span class="p">):</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">inpt</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">trname</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">inpt</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">inpt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">jline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndata</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">dummy</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">jline</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">temperature</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dummy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dummy</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">),</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;file does not exist&#39;</span></div>



<div class="viewcode-block" id="twophotonHRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.twophotonHRead.html#ChiantiPy.tools.io.twophotonHRead">[docs]</a><span class="k">def</span> <span class="nf">twophotonHRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the two-photon Einstein A values and distribution function for the H sequence.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;y0&#39;, &#39;z0&#39;, &#39;avalue&#39;, &#39;asum&#39;, &#39;psi0&#39;} : `dict`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">fName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span> <span class="s1">&#39;hseq_2photon.dat&#39;</span><span class="p">)</span>
    <span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">dFile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">dFile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">nz</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">avalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">asum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">dFile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">avalue</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">asum</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
        <span class="n">psi0</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi</span>
    <span class="n">dFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;y0&#39;</span><span class="p">:</span><span class="n">y0</span><span class="p">,</span> <span class="s1">&#39;z0&#39;</span><span class="p">:</span><span class="n">z0</span><span class="p">,</span> <span class="s1">&#39;avalue&#39;</span><span class="p">:</span><span class="n">avalue</span><span class="p">,</span> <span class="s1">&#39;asum&#39;</span><span class="p">:</span><span class="n">asum</span><span class="p">,</span> <span class="s1">&#39;psi0&#39;</span><span class="p">:</span><span class="n">psi0</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">17</span><span class="p">)}</span></div>


<div class="viewcode-block" id="twophotonHeRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.twophotonHeRead.html#ChiantiPy.tools.io.twophotonHeRead">[docs]</a><span class="k">def</span> <span class="nf">twophotonHeRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the two-photon Einstein A values and distribution function for the He sequence.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;y0&#39;, &#39;avalue&#39;, &#39;psi0&#39;} : `dict`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">fName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span> <span class="s1">&#39;heseq_2photon.dat&#39;</span><span class="p">)</span>
    <span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">dFile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">nz</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">avalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">psi0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span> <span class="mi">41</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nz</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">dFile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">avalue</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="n">psi0</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi</span>
    <span class="n">dFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;y0&#39;</span><span class="p">:</span><span class="n">y0</span><span class="p">,</span> <span class="s1">&#39;avalue&#39;</span><span class="p">:</span><span class="n">avalue</span><span class="p">,</span> <span class="s1">&#39;psi0&#39;</span><span class="p">:</span><span class="n">psi0</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">41</span><span class="p">)}</span></div>


<div class="viewcode-block" id="vernerRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.vernerRead.html#ChiantiPy.tools.io.vernerRead">[docs]</a><span class="k">def</span> <span class="nf">vernerRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the photoionization cross-section data from [1]_.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    {&#39;pqn&#39;,&#39;l&#39;,&#39;eth&#39;,&#39;e0&#39;,&#39;sig0&#39;,&#39;ya&#39;,&#39;p&#39;, yw&#39;} : `dict`</span>
<span class="sd">        `pqn` is the principal quantum number, `l` is the subshell orbital quantum number, `eth` (in eV) is the subshell ionization threshold energy; `sig0`, `ya`, `p`, and `yw` are all fit parameters used in calculating the total photoionization cross-section.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Verner &amp; Yakovlev, 1995, A&amp;AS, `109, 125 &lt;http://adsabs.harvard.edu/abs/1995A%26AS..109..125V&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;continuum&#39;</span><span class="p">,</span> <span class="s1">&#39;verner_short.txt&#39;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="n">nlines</span> <span class="o">=</span> <span class="mi">465</span>
    <span class="n">maxZ</span> <span class="o">=</span> <span class="mi">30</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">maxNel</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">+</span><span class="mi">1</span><span class="c1"># also equal max(stage)</span>
    <span class="c1">#</span>
    <span class="c1">#z = np.array(nlines,&#39;int32&#39;)</span>
    <span class="c1">#nel = np.array(nlines,&#39;int32&#39;)</span>
    <span class="n">pqn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
    <span class="n">eth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">e0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">sig0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">ya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">yw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">maxZ</span><span class="p">,</span><span class="n">maxNel</span><span class="p">),</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">fstring</span> <span class="o">=</span> <span class="s1">&#39;i2,i3,i2,i2,6f11.3&#39;</span>
    <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="n">fstring</span><span class="p">)</span>
<span class="c1">#    vernerFormat=FortranFormat(fstring)</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">):</span>
<span class="c1">#        out=FortranLine(lines[iline],vernerFormat)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">iline</span><span class="p">])</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nel</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">nel</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">pqn</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">l</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">eth</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">e0</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">sig0</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">ya</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">yw</span><span class="p">[</span><span class="n">z</span><span class="p">,</span><span class="n">stage</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;pqn&#39;</span><span class="p">:</span><span class="n">pqn</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="n">l</span><span class="p">,</span> <span class="s1">&#39;eth&#39;</span><span class="p">:</span><span class="n">eth</span><span class="p">,</span> <span class="s1">&#39;e0&#39;</span><span class="p">:</span><span class="n">e0</span><span class="p">,</span> <span class="s1">&#39;sig0&#39;</span><span class="p">:</span><span class="n">sig0</span><span class="p">,</span> <span class="s1">&#39;ya&#39;</span><span class="p">:</span><span class="n">ya</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;yw&#39;</span><span class="p">:</span><span class="n">yw</span><span class="p">}</span></div>


<div class="viewcode-block" id="versionRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.versionRead.html#ChiantiPy.tools.io.versionRead">[docs]</a><span class="k">def</span> <span class="nf">versionRead</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the version number of the CHIANTI database</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xuvtop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;XUVTOP&#39;</span><span class="p">]</span>
    <span class="n">vFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xuvtop</span><span class="p">,</span> <span class="s1">&#39;VERSION&#39;</span><span class="p">)</span>
    <span class="n">vFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">vFileName</span><span class="p">)</span>
    <span class="n">versionStr</span> <span class="o">=</span> <span class="n">vFile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">vFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">versionStr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>


<div class="viewcode-block" id="wgfaRead"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.wgfaRead.html#ChiantiPy.tools.io.wgfaRead">[docs]</a><span class="k">def</span> <span class="nf">wgfaRead</span><span class="p">(</span><span class="n">ions</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elvlcname</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read CHIANTI data from a .wgfa file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ions : `str`</span>
<span class="sd">        Ion, e.g. &#39;c_5&#39; for C V</span>
<span class="sd">    filename : `str`</span>
<span class="sd">        Custom filename, will override that specified by `ions`</span>
<span class="sd">    elvlcname : `str`</span>
<span class="sd">        If specified, the lsj term labels are returned in the &#39;pretty1&#39; and &#39;pretty2&#39;</span>
<span class="sd">        keys of &#39;Wgfa&#39; dict</span>
<span class="sd">    total : `bool`</span>
<span class="sd">        Return the summed level 2 avalue data in &#39;Wgfa&#39;</span>
<span class="sd">    verbose : `bool`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Wgfa : `dict`</span>
<span class="sd">        Information read from the .wgfa file. The dictionary structure is</span>
<span class="sd">        {&quot;lvl1&quot;,&quot;lvl2&quot;,&quot;wvl&quot;,&quot;gf&quot;,&quot;avalue&quot;,&quot;ref&quot;,&quot;ionS&quot;,&quot;filename&quot;}</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ChiantiPy.tools.archival.wgfaRead : Read .wgfa file with the old format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">wgfaname</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elvlcname</span><span class="p">:</span>
            <span class="n">elvlcname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">wgfaname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.elvlc&#39;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">elvlcname</span><span class="p">):</span>
                <span class="n">elvlc</span> <span class="o">=</span> <span class="n">elvlcRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">elvlcname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elvlc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elvlc</span> <span class="o">=</span> <span class="n">elvlcRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">elvlcname</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="n">ions</span><span class="p">)</span>
        <span class="n">wgfaname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.wgfa&#39;</span>
        <span class="n">elvlcname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.elvlc&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">elvlcname</span><span class="p">):</span>
            <span class="n">elvlc</span> <span class="o">=</span> <span class="n">elvlcRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">elvlcname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elvlc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elvlc</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; have elvlc data&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; do not have elvlc data&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">wgfaname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">nwvl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ndata</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">nwvl</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">s1a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">nwvl</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nwvl</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; nwvl = </span><span class="si">%10i</span><span class="s1"> ndata = </span><span class="si">%4i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">nwvl</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)))</span>
    <span class="n">lvl1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">wvl</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">gf</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="n">avalue</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="k">if</span> <span class="n">elvlc</span><span class="p">:</span>
        <span class="n">pretty1</span>  <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
        <span class="n">pretty2</span>  <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">nwvl</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; nwvl  =  </span><span class="si">%10i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">nwvl</span><span class="p">)))</span>
    <span class="c1">#</span>
    <span class="n">wgfaFormat</span> <span class="o">=</span> <span class="s1">&#39;(2i5,f15.3,2e15.3)&#39;</span>
    <span class="n">header_line</span> <span class="o">=</span> <span class="n">FortranRecordReader</span><span class="p">(</span><span class="n">wgfaFormat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ivl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwvl</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; index </span><span class="si">%5i</span><span class="s1">  </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ivl</span><span class="p">,</span> <span class="n">s1</span><span class="p">[</span><span class="n">ivl</span><span class="p">]))</span>
<span class="c1">#        inpt=FortranLine(s1[ivl],wgfaFormat)</span>
        <span class="n">inpt</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">ivl</span><span class="p">])</span>
        <span class="n">lvl1</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lvl2</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">wvl</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">gf</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">avalue</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">elvlc</span><span class="p">:</span>
            <span class="n">idx1</span> <span class="o">=</span> <span class="n">elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">idx2</span> <span class="o">=</span> <span class="n">elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pretty1</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">elvlc</span><span class="p">[</span><span class="s1">&#39;pretty&#39;</span><span class="p">][</span><span class="n">idx1</span><span class="p">]</span>
            <span class="n">pretty2</span><span class="p">[</span><span class="n">ivl</span><span class="p">]</span> <span class="o">=</span> <span class="n">elvlc</span><span class="p">[</span><span class="s1">&#39;pretty&#39;</span><span class="p">][</span><span class="n">idx2</span><span class="p">]</span>

    <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># should skip the last &#39;-1&#39; in the file</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwvl</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)):</span>
        <span class="n">s1a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">Wgfa</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lvl1&quot;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span><span class="s2">&quot;lvl2&quot;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span><span class="s2">&quot;wvl&quot;</span><span class="p">:</span><span class="n">wvl</span><span class="p">,</span><span class="s2">&quot;gf&quot;</span><span class="p">:</span><span class="n">gf</span><span class="p">,</span><span class="s2">&quot;avalue&quot;</span><span class="p">:</span><span class="n">avalue</span><span class="p">,</span><span class="s2">&quot;ref&quot;</span><span class="p">:</span><span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;ionS&#39;</span><span class="p">:</span><span class="n">ions</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">wgfaname</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">total</span><span class="p">:</span>
        <span class="n">avalueLvl</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iwvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwvl</span><span class="p">):</span>
            <span class="n">avalueLvl</span><span class="p">[</span><span class="n">lvl2</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">avalue</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span>
        <span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">avalueLvl</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">elvlc</span><span class="p">:</span>
        <span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;pretty1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pretty1</span>
        <span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pretty2</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">Wgfa</span></div>


<div class="viewcode-block" id="wgfaWrite"><a class="viewcode-back" href="../../../api/ChiantiPy.tools.io.wgfaWrite.html#ChiantiPy.tools.io.wgfaWrite">[docs]</a><span class="k">def</span> <span class="nf">wgfaWrite</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">outfile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">minBranch</span> <span class="o">=</span> <span class="mf">1.e-5</span><span class="p">,</span> <span class="n">rightDigits</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write data to a CHIANTI .wgfa file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    info : `dict`</span>
<span class="sd">        Should contain the following keys:</span>
<span class="sd">        ionS, the Chianti style name of the ion such as c_4 for C IV,</span>
<span class="sd">        lvl1, the lower level, the ground level is 1,</span>
<span class="sd">        lvl2, the upper level,</span>
<span class="sd">        wvl, the wavelength (in Angstroms),</span>
<span class="sd">        gf,the weighted oscillator strength,</span>
<span class="sd">        avalue, the A value,</span>
<span class="sd">        pretty1, descriptive text of the lower level (optional),</span>
<span class="sd">        pretty2, descriptive text of the upper level (optiona),</span>
<span class="sd">        ref, reference text, a list of strings</span>
<span class="sd">    outfile : `str`</span>
<span class="sd">    minBranch : `~numpy.float64`</span>
<span class="sd">        The transition must have a branching ratio greater than the specified minBranchto be written to the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
<span class="c1">#    gname = info[&#39;ionS&#39;]</span>
    <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">wgfaname</span> <span class="o">=</span> <span class="n">outfile</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; output filename not specified, no file will be created&#39;</span><span class="p">)</span>
        <span class="k">return</span>
<span class="c1">#        wgfaname = gname + &#39;.wgfa&#39;</span>
    <span class="nb">print</span><span class="p">((</span><span class="s1">&#39; wgfa file name = &#39;</span><span class="p">,</span> <span class="n">wgfaname</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">minBranch</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; minimum branching ratio = </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">minBranch</span><span class="p">))</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">wgfaname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1">#ntrans = len(info[&#39;lvl1&#39;])</span>
    <span class="n">nlvl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">])</span>
    <span class="n">totalAvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlvl</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;pretty1&#39;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
        <span class="n">pformat</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5i%5i</span><span class="s1">%15.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rightDigits</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f</span><span class="si">%15.3e%15.3e%30s</span><span class="s1"> - </span><span class="si">%30s</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pformat</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5i%5i</span><span class="s1">%15.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rightDigits</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f</span><span class="si">%15.3e%15.3e</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">itrans</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]):</span>
        <span class="c1"># for autoionization transitions, lvl1 can be less than zero</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">totalAvalue</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">avalue</span>

    <span class="k">for</span> <span class="n">itrans</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">elif</span> <span class="n">avalue</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="n">avalue</span><span class="o">/</span><span class="n">totalAvalue</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">branch</span> <span class="o">&gt;</span> <span class="n">minBranch</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;pretty1&#39;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                <span class="c1"># generally only useful with NIST data</span>
                <span class="k">if</span> <span class="s1">&#39;transType&#39;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;transType&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">lbl2</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;transType&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lbl2</span> <span class="o">=</span>  <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="n">pstring</span> <span class="o">=</span> <span class="n">pformat</span><span class="o">%</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;gf&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">avalue</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pretty1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">lbl2</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pstring</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pstring</span> <span class="o">=</span> <span class="n">pformat</span><span class="o">%</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;gf&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">],</span> <span class="n">avalue</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pstring</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; -1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">ilename:  &#39;</span> <span class="o">+</span> <span class="n">wgfaname</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y %B </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; -1 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Ken Dere.
      Last updated on 03 Oct 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.7.1a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>