

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ChiantiPy.core.Ion &mdash; ChiantiPy v0.7.1a</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="ChiantiPy v0.7.1a" href="../../../index.html"/>
        <link rel="up" title="ChiantiPy" href="../../ChiantiPy.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> ChiantiPy
          

          
          </a>

          
            
            
              <div class="version">
                0.7.1a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started with ChiantiPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_ref/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes.html">Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../IDL_intro.html">Intro for CHIANTI IDL Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources.html">Resources for ChiantiPy Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bugs.html">Reporting Bugs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ChiantiPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ChiantiPy.html">ChiantiPy</a> &raquo;</li>
        
      <li>ChiantiPy.core.Ion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ChiantiPy.core.Ion</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ion class</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">splev</span><span class="p">,</span> <span class="n">splrep</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">ChiantiPy.tools.filters</span> <span class="k">as</span> <span class="nn">chfilters</span>
<span class="kn">import</span> <span class="nn">ChiantiPy.tools.util</span> <span class="k">as</span> <span class="nn">util</span>
<span class="kn">import</span> <span class="nn">ChiantiPy.tools.io</span> <span class="k">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">ChiantiPy.tools.constants</span> <span class="k">as</span> <span class="nn">const</span>
<span class="kn">import</span> <span class="nn">ChiantiPy.tools.data</span> <span class="k">as</span> <span class="nn">chdata</span>
<span class="kn">import</span> <span class="nn">ChiantiPy.Gui</span> <span class="k">as</span> <span class="nn">chGui</span>
<span class="kn">from</span> <span class="nn">ChiantiPy.base</span> <span class="k">import</span> <span class="n">ionTrails</span>
<span class="kn">from</span> <span class="nn">ChiantiPy.base</span> <span class="k">import</span> <span class="n">specTrails</span>
<span class="kn">from</span> <span class="nn">ChiantiPy.base</span> <span class="k">import</span> <span class="n">ioneqOne</span>

<span class="n">heseqLvl2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>


<div class="viewcode-block" id="ion"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion">[docs]</a><span class="k">class</span> <span class="nc">ion</span><span class="p">(</span><span class="n">ioneqOne</span><span class="p">,</span> <span class="n">ionTrails</span><span class="p">,</span> <span class="n">specTrails</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The top level class for performing spectral calculations for an ion in the</span>
<span class="sd">    CHIANTI database.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ionStr : `str`</span>
<span class="sd">        CHIANTI notation for the given ion, e.g. &#39;fe_12&#39; that corresponds to the `Fe XII` ion.</span>
<span class="sd">    temperature : `float` or `~numpy.ndarray`, optional</span>
<span class="sd">        Temperature array (Kelvin)</span>
<span class="sd">    eDensity : `float` or `~numpy.ndarray`, optional</span>
<span class="sd">        Electron density array (:math:`\mathrm{cm^{-3}}` )</span>
<span class="sd">    pDensity : `float` or `~numpy.ndarray`, optional</span>
<span class="sd">        Proton density (:math:`\mathrm{cm}^{-3}` )</span>
<span class="sd">    radTemperature : `float` or `~numpy.ndarray`, optional</span>
<span class="sd">        Radiation black-body temperature (in Kelvin)</span>
<span class="sd">    rStar : `float` or `~numpy.ndarray`, optional</span>
<span class="sd">        Distance from the center of the star (in stellar radii)</span>
<span class="sd">    abundance : `float` or `str`, optional</span>
<span class="sd">        Elemental abundance relative to Hydrogen or name of CHIANTI abundance file</span>
<span class="sd">        to use, without the &#39;.abund&#39; suffix, e.g. &#39;sun_photospheric_1998_grevesse&#39;.</span>
<span class="sd">    setup : `bool` or `str`, optional</span>
<span class="sd">        If True, run ion setup function. Otherwise, provide a limited number of</span>
<span class="sd">        attributes of the selected ion</span>
<span class="sd">    em : `float` or `~numpy.ndarray`, optional</span>
<span class="sd">        Emission Measure, for the line-of-sight emission measure</span>
<span class="sd">        (:math:`\mathrm{\int \, n_e \, n_H \, dl}`)</span>
<span class="sd">        (:math:`\mathrm{cm}^{-5}`.), for the volumetric emission measure</span>
<span class="sd">        :math:`\mathrm{\int \, n_e \, n_H \, dV}` (:math:`\mathrm{cm^{-3}}`).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    IonStr : `str`</span>
<span class="sd">        Name of element plus ion, e.g. `fe_12` for Fe XII</span>
<span class="sd">    Z : `int`</span>
<span class="sd">        the nuclear charge, 26 for `fe_12`.</span>
<span class="sd">    Ion : `int`</span>
<span class="sd">        the ionization stage, 12 for `fe_12`.</span>
<span class="sd">    Dielectronic : `bool`</span>
<span class="sd">        true if the ion is a &#39;dielectronic&#39; ion where the levels are populated</span>
<span class="sd">        by dielectronic recombination.</span>
<span class="sd">    Spectroscopic : `str`</span>
<span class="sd">        the spectroscopic notation for the ion, such as `Fe XII` for `fe_12`.</span>
<span class="sd">    Filename : `str`</span>
<span class="sd">        the complete name of the file `generic` filename in the CHIANTI</span>
<span class="sd">        database, such as `$XUVTOP/fe/fe_12/fe_12`.</span>
<span class="sd">    Ip : `float`</span>
<span class="sd">        the ionization potential of the ion</span>
<span class="sd">    FIP : `float`</span>
<span class="sd">        the first ionization potential of the element</span>
<span class="sd">    Defaults : `dict`</span>
<span class="sd">        these are specified by the software unless a *chiantirc* file is found</span>
<span class="sd">        in &#39;$HOME/.chianti&#39;:</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The keyword arguments temperature, eDensity, radTemperature, rStar, em must all be either a float or have the same dimension as the rest if specified as lists, tuples or arrays.</span>

<span class="sd">    The `Defaults` dict should have the following keys:</span>

<span class="sd">    * *abundfile*, the elemental abundance file, unless specified in</span>
<span class="sd">      *chiantirc* this defaults to *sun_photospheric_1998_grevesse*.</span>
<span class="sd">    * *ioneqfile*, the ionization equilibrium file name.  Unless specified</span>
<span class="sd">      in &#39;chiantirc&#39; this is defaults to *chianti*.  Other choices are</span>
<span class="sd">      availble in $XUVTOP/ioneq</span>
<span class="sd">    * *wavelength*, the units of wavelength (Angstroms, nm, or kev), unless</span>
<span class="sd">      specified in the &#39;chiantirc&#39; this is defaults to &#39;angstrom&#39;.</span>
<span class="sd">    * *flux*, specified whether the line intensities are give in energy or</span>
<span class="sd">      photon fluxes, unless specified in the &#39;chiantirc&#39; this is defaults to</span>
<span class="sd">      *energy*.</span>
<span class="sd">    * *gui*, specifies whether to use gui selection widgets (True) or to</span>
<span class="sd">      make selections on the command line (False).  Unless specified in the</span>
<span class="sd">      &#39;chiantirc&#39; this is defaults to *False*.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ionStr</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eDensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">pDensity</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">radTemperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rStar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">abundance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">em</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span> <span class="o">=</span> <span class="n">ionStr</span>
        <span class="n">_tmp_convert_name</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="n">ionStr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">_tmp_convert_name</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span> <span class="o">=</span> <span class="n">_tmp_convert_name</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span> <span class="o">=</span> <span class="n">_tmp_convert_name</span><span class="p">[</span><span class="s1">&#39;Dielectronic&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Spectroscopic</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">zion2spectroscopic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FileName</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">zion2filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="p">,</span><span class="n">dielectronic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span> <span class="o">=</span> <span class="n">chdata</span><span class="o">.</span><span class="n">Defaults</span>

        <span class="k">if</span> <span class="n">abundance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">abundance</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">abundance</span> <span class="ow">in</span> <span class="n">chdata</span><span class="o">.</span><span class="n">AbundanceList</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">AbundanceName</span> <span class="o">=</span> <span class="n">abundance</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">abundChoices</span> <span class="o">=</span> <span class="n">chdata</span><span class="o">.</span><span class="n">AbundanceList</span>
                    <span class="n">abundChoice</span> <span class="o">=</span> <span class="n">chGui</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">selectorDialog</span><span class="p">(</span><span class="n">abundChoices</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Select Abundance name&#39;</span><span class="p">,</span> <span class="n">multiChoice</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">abundChoice_idx</span> <span class="o">=</span> <span class="n">abundChoice</span><span class="o">.</span><span class="n">selectedIndex</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">AbundanceName</span> <span class="o">=</span> <span class="n">abundChoices</span><span class="p">[</span><span class="n">abundChoice_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AbundanceName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;abundfile&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;AbundanceName&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span> <span class="o">=</span> <span class="n">chdata</span><span class="o">.</span><span class="n">Abundance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">AbundanceName</span><span class="p">][</span><span class="s1">&#39;abundance&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">IoneqName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;ioneqfile&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RadTemperature</span> <span class="o">=</span> <span class="n">radTemperature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RStar</span> <span class="o">=</span> <span class="n">rStar</span>

        <span class="c1">#  ip in eV, but don&#39;t read for bare ions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span> <span class="o">=</span> <span class="n">chdata</span><span class="o">.</span><span class="n">Ip</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FIP</span> <span class="o">=</span> <span class="n">chdata</span><span class="o">.</span><span class="n">Ip</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UpperIp</span> <span class="o">=</span> <span class="n">chdata</span><span class="o">.</span><span class="n">Ip</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IoneqAll</span> <span class="o">=</span> <span class="n">chdata</span><span class="o">.</span><span class="n">IoneqAll</span>
        <span class="c1">#  this needs to go after setting temperature and reading ionization</span>
        <span class="c1">#  equilibria</span>
        <span class="k">if</span> <span class="n">pDensity</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p2eRatio</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">eDensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eDensity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NTempDen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="c1">#  needs to know self.NTempDen first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ioneqOne</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;EDensity&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span> \
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Temperature and density must be the same size.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pDensity</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span> <span class="ow">and</span> <span class="n">eDensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProtonDensityRatio</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span> <span class="o">=</span> <span class="n">pDensity</span>

        <span class="k">if</span> <span class="n">setup</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span> <span class="ow">in</span> <span class="n">chdata</span><span class="o">.</span><span class="n">MasterList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setupIonrec</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">em</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">em</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">em</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">NTempDen</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Em</span> <span class="o">=</span> <span class="n">em</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;NTempDen&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NTempDen</span><span class="p">)</span>

<div class="viewcode-block" id="ion.setup"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alternate_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup various CHIANTI files for the ion including .wgfa, .elvlc, .scups,</span>
<span class="sd">        .psplups, .reclvl, .cilvl, and others.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        alternate_dir : `str`</span>
<span class="sd">            directory cotaining the necessary files for a ChiantiPy ion; use to</span>
<span class="sd">            setup an ion with files not in the current CHIANTI directory</span>
<span class="sd">        verbose : `bool`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If ion is initiated with `setup=False`, call this method to do the</span>
<span class="sd">        setup at a later point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alternate_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alternate_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="n">elvlcFileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">+</span><span class="s1">&#39;.elvlc&#39;</span>
            <span class="n">wgfaFileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">+</span><span class="s1">&#39;.wgfa&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="n">elvlcFileName</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">wgfaFileName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">alternate_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">elvlcRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">elvlcFileName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">wgfaRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">wgfaFileName</span><span class="p">,</span> <span class="n">elvlcname</span> <span class="o">=</span> <span class="n">elvlcFileName</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">elvlcRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">wgfaRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nlvls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nwgfa</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
        <span class="n">nlvlWgfa</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">])</span>
        <span class="n">nlvlList</span> <span class="o">=</span> <span class="p">[</span><span class="n">nlvlWgfa</span><span class="p">]</span>
        <span class="n">scupsfile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s1">&#39;.scups&#39;</span>
        <span class="n">cilvlfile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s1">&#39;.cilvl&#39;</span>
        <span class="n">reclvlfile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s1">&#39;.reclvl&#39;</span>
        <span class="n">autofile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s1">&#39;.auto&#39;</span>
        <span class="n">drParamsFile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s1">&#39;.drparams&#39;</span>
        <span class="n">rrParamsFile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s1">&#39;.rrparams&#39;</span>
        <span class="c1"># read the scups/splups file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">scupsfile</span><span class="p">):</span>
            <span class="c1"># happens the case of fe_3 and prob. a few others</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">scupsRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nscups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
            <span class="n">nlvlScups</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">])</span>
            <span class="n">nlvlList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nlvlScups</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nscups</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nlvlScups</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># read cilvl file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cilvlfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">cireclvlRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;cilvl&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ncilvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
            <span class="n">nlvlCilvl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">])</span>
            <span class="n">nlvlList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nlvlCilvl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ncilvl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#  .reclvl file may not exist</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">reclvlfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">cireclvlRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;reclvl&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
            <span class="n">nlvlReclvl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">])</span>
            <span class="n">nlvlList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nlvlReclvl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#  psplups file may not exist</span>
        <span class="n">psplupsfile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span><span class="s1">&#39;.psplups&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">psplupsfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">splupsRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;psplups&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Npsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Npsplups</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># drparams file may not exist</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">drParamsFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">drRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rrParamsFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">rrRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>

        <span class="c1">#  .auto file may not exist</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">autofile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">autoRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nauto</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nauto</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># need to determine the number of levels that can be populated</span>
        <span class="n">nlvlElvlc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">])</span>
        <span class="c1">#  elvlc file can have more levels than the rate level files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nlvls</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">nlvlElvlc</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">nlvlList</span><span class="p">)])</span></div>

<div class="viewcode-block" id="ion.setupIonrec"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.setupIonrec">[docs]</a>    <span class="k">def</span> <span class="nf">setupIonrec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alternate_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup method for ion recombination and ionization rates.</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>
<span class="sd">        Allows a bare-bones ion object to be setup up with just the ionization and recombination</span>
<span class="sd">        rates. For ions without a complete set of files - one that is not in the MasterList.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">alternate_dir</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alternate_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
        <span class="n">elvlcname</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">+</span><span class="s1">&#39;.elvlc&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">elvlcname</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">elvlcRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">elvlcname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zstuff</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zstuff</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">zstuff</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># don&#39;t expect one for the bare ion</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Elvlc file missing for &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">cilvlFile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span><span class="s1">&#39;.cilvl&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cilvlFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">cireclvlRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="n">fileName</span><span class="p">,</span>
                                            <span class="n">filetype</span> <span class="o">=</span> <span class="s1">&#39;cilvl&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ncilvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ncilvl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#  .reclvl file may not exist</span>
        <span class="n">reclvlfile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span><span class="s1">&#39;.reclvl&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">reclvlfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">cireclvlRead</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;reclvl&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">drparamsFile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span><span class="s1">&#39;.drparams&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">drparamsFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">drRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>

        <span class="n">rrparamsFile</span> <span class="o">=</span> <span class="n">fileName</span> <span class="o">+</span><span class="s1">&#39;.rrparams&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rrparamsFile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">rrRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span></div>

<div class="viewcode-block" id="ion.diCross"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.diCross">[docs]</a>    <span class="k">def</span> <span class="nf">diCross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the direct ionization cross section as a function of the</span>
<span class="sd">        incident electron energy in eV, puts values into DiCross</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1">#        if energy == None:</span>
<span class="c1">#            btenergy = 0.1*np.arange(10)</span>
<span class="c1">#            btenergy[0] = 0.01</span>
<span class="c1">#            dum = np.ones(len(btenergy))</span>
<span class="c1">#            [energy, dum] = util.descale_bti(btenergy, dum, 2., self.Ip)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="mf">0.025</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">101</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">iso</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1">#  hydrogenic sequence</span>
            <span class="n">ryd</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">energy</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Ip</span>
            <span class="n">ev1ryd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">/</span><span class="n">ryd</span>
            <span class="n">a0</span> <span class="o">=</span> <span class="mf">0.5291772108e-8</span>
            <span class="n">a_bohr</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a0</span><span class="o">**</span><span class="mi">2</span>   <span class="c1"># area of bohr orbit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="p">(</span><span class="mf">140.</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span><span class="o">**</span><span class="mf">3.2</span><span class="p">)</span><span class="o">/</span><span class="mf">141.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">qr</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">qrp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ff</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># hydrogenic</span>
            <span class="n">qh</span> <span class="o">=</span> <span class="n">bb</span><span class="o">*</span><span class="n">a_bohr</span><span class="o">*</span><span class="n">qr</span><span class="o">/</span><span class="n">ev1ryd</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;neaev&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">qh</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">iso</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c1">#  use</span>
            <span class="n">ryd</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">energy</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Ip</span>
            <span class="n">ev1ryd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">/</span><span class="n">ryd</span>
            <span class="n">a0</span> <span class="o">=</span> <span class="mf">0.5291772108e-8</span>
            <span class="n">a_bohr</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">a0</span><span class="o">**</span><span class="mi">2</span>   <span class="c1"># area of bohr orbit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="p">(</span><span class="mf">140.</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span><span class="o">**</span><span class="mf">3.2</span><span class="p">)</span><span class="o">/</span><span class="mf">141.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">qr</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">qrp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="n">ff</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="mf">2.</span>  <span class="c1"># helium-like</span>
            <span class="n">qh</span> <span class="o">=</span> <span class="n">bb</span><span class="o">*</span><span class="n">a_bohr</span><span class="o">*</span><span class="n">qr</span><span class="o">/</span><span class="n">ev1ryd</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;neaev&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">qh</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;DiParams&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">diRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span> <span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ifac</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="s1">&#39;nfac&#39;</span><span class="p">]):</span>
                <span class="c1"># prob. better to do this with masked arrays</span>
                <span class="n">goode</span> <span class="o">=</span> <span class="n">energy</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;ev1&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">goode</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy</span><span class="p">))</span>
                    <span class="n">btenergy</span><span class="p">,</span> <span class="n">btdum</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">scale_bti</span><span class="p">(</span><span class="n">energy</span><span class="p">[</span><span class="n">goode</span><span class="p">],</span><span class="n">dum</span><span class="p">[</span><span class="n">goode</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;btf&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;ev1&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">])</span>
                    <span class="c1"># these interpolations were made with the scipy routine</span>
                    <span class="c1"># used here</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;xsplom&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;ysplom&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">btcross</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">btenergy</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">energy1</span><span class="p">,</span> <span class="n">cross1</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">descale_bti</span><span class="p">(</span><span class="n">btenergy</span><span class="p">,</span>
                                        <span class="n">btcross</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;btf&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;ev1&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">]</span> <span class="p">)</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span><span class="o">-</span><span class="n">goode</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;xsplom&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;ysplom&#39;</span><span class="p">][</span><span class="n">ifac</span><span class="p">])</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">btenergy</span><span class="p">,</span> <span class="n">btcross</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;Float64&#39;</span><span class="p">),</span> <span class="n">cross1</span><span class="p">]</span>
                        <span class="n">cross1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                    <span class="n">cross</span> <span class="o">+=</span> <span class="n">cross1</span><span class="o">*</span><span class="mf">1.e-14</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">cross</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.diRate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.diRate">[docs]</a>    <span class="k">def</span> <span class="nf">diRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the direct ionization rate coefficient as a function of temperature (K)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#   gauss laguerre n = 12</span>
        <span class="c1"># FIXME: no need to do this by hand, scipy has GL routines</span>
<span class="c1">#        ngl = 12</span>
        <span class="n">xgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.115722117358021</span><span class="p">,</span><span class="mf">0.611757484515131</span><span class="p">,</span><span class="mf">1.512610269776419</span><span class="p">,</span><span class="mf">2.833751337743509</span>
            <span class="p">,</span><span class="mf">4.599227639418353</span><span class="p">,</span><span class="mf">6.844525453115181</span><span class="p">,</span><span class="mf">9.621316842456871</span><span class="p">,</span><span class="mf">13.006054993306350</span>
            <span class="p">,</span><span class="mf">17.116855187462260</span><span class="p">,</span><span class="mf">22.151090379396983</span><span class="p">,</span><span class="mf">28.487967250983992</span><span class="p">,</span><span class="mf">37.099121044466926</span><span class="p">],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>


        <span class="n">wgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">2.647313710554435e-01</span><span class="p">,</span><span class="mf">3.777592758731382e-01</span><span class="p">,</span><span class="mf">2.440820113198774e-01</span><span class="p">,</span><span class="mf">9.044922221168074e-02</span>
            <span class="p">,</span><span class="mf">2.010238115463406e-02</span><span class="p">,</span><span class="mf">2.663973541865321e-03</span><span class="p">,</span><span class="mf">2.032315926629993e-04</span><span class="p">,</span><span class="mf">8.365055856819753e-06</span>
            <span class="p">,</span><span class="mf">1.668493876540914e-07</span><span class="p">,</span><span class="mf">1.342391030515027e-09</span><span class="p">,</span><span class="mf">3.061601635035012e-12</span><span class="p">,</span><span class="mf">8.148077467426124e-16</span><span class="p">],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">5.287e+13</span>
        <span class="n">tev</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmannEv</span><span class="o">*</span><span class="n">temperature</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">/</span><span class="n">tev</span>  <span class="c1"># Ip in eV</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temperature</span><span class="p">)</span>
            <span class="n">egl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">+</span><span class="n">xgl</span><span class="o">*</span><span class="n">tev</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diCross</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="n">egl</span><span class="p">)</span>
            <span class="n">crossgl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiCross</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span>
            <span class="n">term1</span> <span class="o">=</span> <span class="n">wgl</span><span class="o">*</span><span class="n">xgl</span><span class="o">*</span><span class="n">crossgl</span>
            <span class="n">term2</span> <span class="o">=</span> <span class="n">wgl</span><span class="o">*</span><span class="n">crossgl</span>
            <span class="n">newcross</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">term1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">x0</span><span class="o">*</span><span class="n">term2</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">newcross</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntemp</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">itemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntemp</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">/</span><span class="n">tev</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span>  <span class="c1"># Ip in eV</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temperature</span><span class="p">[</span><span class="n">itemp</span><span class="p">])</span>
                <span class="n">egl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">+</span><span class="n">xgl</span><span class="o">*</span><span class="n">tev</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">diCross</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="n">egl</span><span class="p">)</span>
                <span class="n">crossgl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiCross</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span>
                <span class="n">term1</span> <span class="o">=</span> <span class="n">wgl</span><span class="o">*</span><span class="n">xgl</span><span class="o">*</span><span class="n">crossgl</span>
                <span class="n">term2</span> <span class="o">=</span> <span class="n">wgl</span><span class="o">*</span><span class="n">crossgl</span>
                <span class="n">newcross</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">term1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">x0</span><span class="o">*</span><span class="n">term2</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                <span class="n">rate</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcross</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DiRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.eaDescale"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.eaDescale">[docs]</a>    <span class="k">def</span> <span class="nf">eaDescale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the effective collision strengths (upsilon)</span>
<span class="sd">        for excitation-autoionization as a function of temperature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#  xt=kt/de</span>
        <span class="c1">#  need to make sure elvl is &gt;0, except for ground level</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;EaParams&#39;</span><span class="p">):</span>
            <span class="n">eaparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">eaRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="n">eaparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="n">nsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">eaparams</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsplups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsplups</span><span class="p">,</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">isplups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsplups</span><span class="p">):</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">ttype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
            <span class="n">cups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s2">&quot;cups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
            <span class="n">nspl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s2">&quot;nspl&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
            <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s2">&quot;de&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">splups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s2">&quot;splups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">nspl</span><span class="p">]</span>
            <span class="n">kte</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmannEv</span><span class="o">*</span><span class="n">temperature</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span><span class="o">*</span><span class="n">de</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cups</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">#allow smoothing,s=0)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cups</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1">#allow smoothing,s=0)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="mf">0.</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ttype</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; t_type ne 1,2,3,4,5 = </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ttype</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">))</span>

        <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ups</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span><span class="n">ups</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s1">&#39;ups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ups</span>
        <span class="k">return</span> <span class="n">ups</span></div>

<div class="viewcode-block" id="ion.eaCross"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.eaCross">[docs]</a>    <span class="k">def</span> <span class="nf">eaCross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide the excitation-autoionization cross section.</span>

<span class="sd">        Energy is given in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;DiParams&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">diRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;errorMessage&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#  this is a H-like or He-like ion</span>
            <span class="c1"># the excitation-autionization for this ion does not exist</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; there is no EA cross section for this ion&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39;there is no EA cross-section&#39;</span><span class="p">}</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="s1">&#39;neaev&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># the excitation-autionization for this ion does not exist</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; there is no EA cross section for this ion&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39;there is no EA cross-section&#39;</span><span class="p">}</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;got here&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Easplom&#39;</span><span class="p">):</span>
                <span class="n">easplom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Easplom</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Easplom</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">splomRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="n">ea</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">easplom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Easplom</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Easplom</span><span class="p">[</span><span class="s1">&#39;deryd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span><span class="o">*</span><span class="mf">1.01</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="mf">0.025</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">101</span><span class="p">))</span>
            <span class="c1"># multiplicity of ground level already included</span>
            <span class="c1">#  splomDescale takes care of when energy &lt; threshold</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">splomDescale</span><span class="p">(</span><span class="n">easplom</span><span class="p">,</span> <span class="n">energy</span><span class="p">)</span>
            <span class="c1">#  need to replicate neaev</span>
            <span class="n">ntrans</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">easplom</span><span class="p">[</span><span class="s1">&#39;deryd&#39;</span><span class="p">])</span>
            <span class="n">eaev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;eaev&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eaev</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntrans</span><span class="p">):</span>
                    <span class="n">eaev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eaev</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">totalCross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="n">ntrans</span> <span class="o">=</span> <span class="n">omega</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">partialCross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntrans</span><span class="p">,</span> <span class="n">energy</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntrans</span><span class="p">):</span>
                <span class="c1">#  the collision strengths have already by divided by the</span>
                <span class="c1">#  statistical weight of the ground level 2j+1</span>
                <span class="n">cross</span> <span class="o">=</span> <span class="n">eaev</span><span class="p">[</span><span class="n">itrans</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">bohrCross</span><span class="o">*</span><span class="n">omega</span><span class="p">[</span><span class="n">itrans</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">energy</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span><span class="p">)</span>
                <span class="n">totalCross</span> <span class="o">+=</span> <span class="n">cross</span>
                <span class="n">partialCross</span><span class="p">[</span><span class="n">itrans</span><span class="p">]</span> <span class="o">=</span> <span class="n">cross</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">totalCross</span><span class="p">,</span>
                            <span class="s1">&#39;partial&#39;</span><span class="p">:</span><span class="n">partialCross</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.eaRate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.eaRate">[docs]</a>    <span class="k">def</span> <span class="nf">eaRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the excitation-autoionization rate coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get neaev from diparams file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;DiParams&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">diRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="s1">&#39;neaev&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#FIXME: raise an error here?</span>
            <span class="c1"># basically, this means that this method should not be invoked</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
                <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">btT</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">btT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>
                <span class="n">dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
                <span class="p">[</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dum</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">descale_bt</span><span class="p">(</span><span class="n">btT</span><span class="p">,</span> <span class="n">dum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span><span class="p">[</span><span class="s1">&#39;cups&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;EaParams&#39;</span><span class="p">):</span>
                <span class="n">eaparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eaParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">eaRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eaDescale</span><span class="p">()</span>
                <span class="n">eaparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaParams</span>
            <span class="c1">#  need to replicate neaev</span>
            <span class="n">nups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">eaparams</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">])</span>
            <span class="n">tev</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmannEv</span><span class="o">*</span><span class="n">temperature</span>
            <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
            <span class="n">partial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nups</span><span class="p">,</span> <span class="n">ntemp</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">earate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
            <span class="n">eaev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;eaev&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eaev</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nups</span><span class="p">):</span>
                    <span class="n">eaev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eaev</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">iups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nups</span><span class="p">):</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span><span class="o">*</span><span class="n">eaparams</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">][</span><span class="n">iups</span><span class="p">]</span><span class="o">/</span><span class="n">tev</span>
                <span class="c1">#  upsilon has already been divided by the statistical weight</span>
                <span class="c1"># of the ground level 2j+1</span>
                <span class="n">earate1</span> <span class="o">=</span> <span class="n">eaev</span><span class="p">[</span><span class="n">iups</span><span class="p">]</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">eaparams</span><span class="p">[</span><span class="s1">&#39;ups&#39;</span><span class="p">][</span><span class="n">iups</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span>
                <span class="n">partial</span><span class="p">[</span><span class="n">iups</span><span class="p">]</span> <span class="o">=</span> <span class="n">earate1</span>
                <span class="n">earate</span> <span class="o">+=</span> <span class="n">earate1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EaRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">earate</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;partial&#39;</span><span class="p">:</span><span class="n">partial</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.ionizCross"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.ionizCross">[docs]</a>    <span class="k">def</span> <span class="nf">ionizCross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the total ionization cross section.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        uses `diCross`  and `eaCross`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">*</span><span class="mf">1.01</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="mf">0.025</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">101</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IonizCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">}</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diCross</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="s1">&#39;neaev&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ionizCross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiCross</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39;there is no EA cross-section&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">energy</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eaCross</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="n">ionizCross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiCross</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">EaCross</span><span class="p">[</span><span class="s1">&#39;cross&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IonizCross</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cross&#39;</span><span class="p">:</span><span class="n">ionizCross</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span><span class="n">energy</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.ionizRate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.ionizRate">[docs]</a>    <span class="k">def</span> <span class="nf">ionizRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the total ionization rate.</span>

<span class="sd">        Calls diRate and eaRate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IonizRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">),</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">}</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diRate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eaRate</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiParams</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="s1">&#39;neaev&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ionizrate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ionizrate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DiRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">EaRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IonizRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">ionizrate</span><span class="p">,</span>
                        <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">DiRate</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]}</span></div>

<div class="viewcode-block" id="ion.rrRate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.rrRate">[docs]</a>    <span class="k">def</span> <span class="nf">rrRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide the radiative recombination rate coefficient as a function of temperature (K).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">rrparamsfile</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.rrparams&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;RrParams&#39;</span><span class="p">):</span>
            <span class="n">rrparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrParams</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rrparamsfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">rrRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="n">rrparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrParams</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temperature</span><span class="p">)}</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;rrtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="n">t0</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="n">t1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">b</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;rrtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t2</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="n">t0</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="n">t1</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">b</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrRate</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;rrtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">rrparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">temperature</span><span class="o">/</span><span class="mf">1.e+4</span><span class="p">)</span><span class="o">**</span><span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temperature</span><span class="p">)}</span></div>

<div class="viewcode-block" id="ion.drRate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.drRate">[docs]</a>    <span class="k">def</span> <span class="nf">drRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide the dielectronic recombination rate coefficient as a function of temperature (K).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">}</span>
        <span class="n">drparamsfile</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.drparams&#39;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;DrParams&#39;</span><span class="p">):</span>
            <span class="n">drparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DrParams</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">drparamsfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrParams</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">drRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="n">drparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DrParams</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">}</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">drparams</span><span class="p">[</span><span class="s1">&#39;drtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># badnell type</span>
            <span class="n">drenergy</span> <span class="o">=</span> <span class="n">drparams</span><span class="p">[</span><span class="s1">&#39;eparams&#39;</span><span class="p">]</span>
            <span class="n">drcoef</span> <span class="o">=</span> <span class="n">drparams</span><span class="p">[</span><span class="s1">&#39;cparams&#39;</span><span class="p">]</span>
            <span class="n">gcoef</span> <span class="o">=</span> <span class="n">drenergy</span> <span class="o">&gt;</span> <span class="mf">0.</span>
            <span class="n">ncoef</span> <span class="o">=</span> <span class="n">gcoef</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">icoef</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncoef</span><span class="p">):</span>
                <span class="n">rate</span> <span class="o">+=</span> <span class="n">drcoef</span><span class="p">[</span><span class="n">icoef</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">drenergy</span><span class="p">[</span><span class="n">icoef</span><span class="p">]</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="o">/</span><span class="n">temperature</span><span class="o">**</span><span class="mf">1.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">drparams</span><span class="p">[</span><span class="s1">&#39;drtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># shull type</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">drparams</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span>
            <span class="n">adi</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">bdi</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">adi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t0</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">bdi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t1</span><span class="o">/</span><span class="n">temperature</span><span class="p">))</span><span class="o">/</span><span class="n">temperature</span><span class="o">**</span><span class="mf">1.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DrRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.cireclvlDescale"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.cireclvlDescale">[docs]</a>    <span class="k">def</span> <span class="nf">cireclvlDescale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lvlType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate and extrapolate cilvl and reclvl rates.</span>
<span class="sd">        lvltype must be either &#39;reclvl&#39;, &#39;cilvl&#39; or &#39;rrlvl&#39;</span>
<span class="sd">        Used in level population calculations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">}</span>
        <span class="n">lvlfile</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ion2filename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">lvlType</span>
        <span class="k">if</span> <span class="n">lvlType</span> <span class="o">==</span> <span class="s1">&#39;reclvl&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Reclvl&#39;</span><span class="p">):</span>
                <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">lvlfile</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">cireclvlRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">lvlType</span><span class="p">)</span>
                <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ReclvlRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temperature</span><span class="p">)}</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">lvlType</span> <span class="o">==</span> <span class="s1">&#39;cilvl&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Cilvl&#39;</span><span class="p">):</span>
                <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">lvlfile</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">cireclvlRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">lvlType</span><span class="p">)</span>
                <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">lvlType</span> <span class="o">==</span> <span class="s1">&#39;rrlvl&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Rrlvl&#39;</span><span class="p">):</span>
                <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rrlvl</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">lvlfile</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Rrlvl</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">cireclvlRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">lvlType</span><span class="p">)</span>
                <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rrlvl</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RrlvlRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temperature</span><span class="p">)}</span>
                <span class="k">return</span>

        <span class="c1">#  the rates and temperatures in reclvl are not all the same</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="n">nlvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span> <span class="n">nlvl</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="c1"># previous takes care of temperatures below reclvl[&#39;temperature&#39;].min()</span>
            <span class="k">if</span> <span class="n">temperature</span> <span class="o">&gt;</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
                <span class="c1"># extrapolate as 1/temperature</span>
                <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvl</span><span class="p">):</span>
                    <span class="n">rate</span><span class="p">[</span><span class="n">itrans</span><span class="p">]</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">temperature</span> <span class="o">&lt;</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
                <span class="c1"># rate is already set to zero</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvl</span><span class="p">):</span>
                    <span class="n">lvl2</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                    <span class="n">nrecTemp</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;ntemp&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">][:</span><span class="n">nrecTemp</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">][:</span><span class="n">nrecTemp</span><span class="p">]))</span>
                    <span class="n">cirec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span><span class="n">y2</span><span class="p">))</span>
                    <span class="n">rate</span><span class="p">[</span><span class="n">itrans</span><span class="p">]</span> <span class="o">=</span> <span class="n">cirec</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span> <span class="n">nlvl</span><span class="p">,</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvl</span><span class="p">):</span>
                <span class="n">lvl2</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="n">nTemp</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;ntemp&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span> <span class="p">:</span><span class="n">nTemp</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span> <span class="p">:</span><span class="n">nTemp</span><span class="p">]))</span>
                <span class="n">goodLow</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">&lt;</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">goodLow</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">lowT</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="n">goodLow</span><span class="p">]</span>
                <span class="n">good1</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">&gt;=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">good2</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">&lt;=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">realgood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">good1</span><span class="p">,</span><span class="n">good2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">realgood</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">midT</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="n">realgood</span><span class="p">]</span>
                <span class="n">goodHigh</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">&gt;</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">goodHigh</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">highT</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="n">goodHigh</span><span class="p">]</span>
                <span class="n">lvl2</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="n">nTemp</span> <span class="o">=</span> <span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;ntemp&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="n">newRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntemp</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">goodLow</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">newRate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">goodLow</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">goodLow</span><span class="o">.</span><span class="n">sum</span><span class="p">()):</span>
                        <span class="n">newRate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">realgood</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">midRec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">midT</span><span class="p">),</span><span class="n">y2</span><span class="p">))</span>
                    <span class="n">newRate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">midRec</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">realgood</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">midRec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">midT</span><span class="p">),</span><span class="n">y2</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">realgood</span><span class="o">.</span><span class="n">sum</span><span class="p">()):</span>
                        <span class="n">newRate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">midRec</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">goodHigh</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">newRate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">goodHigh</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">goodHigh</span><span class="o">.</span><span class="n">sum</span><span class="p">()):</span>
                        <span class="n">newRate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rate</span><span class="p">[</span><span class="n">itrans</span><span class="p">]</span> <span class="o">=</span> <span class="n">newRate</span>
        <span class="k">if</span> <span class="n">lvlType</span> <span class="o">==</span> <span class="s1">&#39;reclvl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReclvlRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">],</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">],</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">lvlType</span> <span class="o">==</span> <span class="s1">&#39;cilvl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">],</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">],</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">lvlType</span> <span class="o">==</span> <span class="s1">&#39;rrlvl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RrlvlRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">],</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">lvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">],</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.drRateLvl"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.drRateLvl">[docs]</a>    <span class="k">def</span> <span class="nf">drRateLvl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        to calculate the level resolved dielectronic rate from the higher ionization stage to</span>
<span class="sd">        the ion of interest</span>
<span class="sd">        rates are determined from autoionizing A-values</span>
<span class="sd">        the dictionary self.DrRateLvl contains</span>
<span class="sd">        rate = the dielectronic rate into an autoionizing level</span>
<span class="sd">        effRate = the dielectronic rate into an autoionizing level mutilplied by the branching</span>
<span class="sd">        ratio for a stabilizing transition</span>
<span class="sd">        totalRate = the sum of all the effRates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Higher&#39;</span><span class="p">):</span>
            <span class="n">nameStuff</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convertName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">nameStuff</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="n">nameStuff</span><span class="p">[</span><span class="s1">&#39;Ion&#39;</span><span class="p">]</span>
            <span class="n">higherStr</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">zion2name</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">stage</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Higher</span> <span class="o">=</span> <span class="n">ion</span><span class="p">(</span><span class="n">higherStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">)</span>

        <span class="n">coef2</span> <span class="o">=</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">emass</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span>
        <span class="n">coef3</span> <span class="o">=</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">bohrCross</span><span class="o">*</span><span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">))</span><span class="o">**</span><span class="mf">1.5</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="n">coef3</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="n">allRate</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">effRate</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">de</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">erg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ipErg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ev2Erg</span>
        <span class="n">lvl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dekt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">totalRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]):</span>
            <span class="n">elvl1idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">elvl1idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">elvl2idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">gUpper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">])</span>
                <span class="n">gLower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Higher</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">elvl1idx</span><span class="p">])</span>
                <span class="n">ecm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ecm2</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">ecm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecmth&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">]</span>
                <span class="n">de1</span> <span class="o">=</span> <span class="n">ecm2</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2Erg</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ev2Erg</span>
                <span class="n">erg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ecm2</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2Erg</span><span class="p">)</span>
                <span class="n">de</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">de1</span><span class="p">)</span>
                <span class="n">dekt1</span> <span class="o">=</span> <span class="n">de1</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)</span>
                <span class="n">dekt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dekt1</span><span class="p">)</span>
                <span class="n">expkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dekt1</span><span class="p">)</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">coef</span><span class="o">*</span><span class="n">gUpper</span><span class="o">*</span><span class="n">expkt</span><span class="o">*</span><span class="n">avalue</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">gLower</span><span class="p">)</span>
                <span class="n">branch1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">avalue</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">])</span>
                <span class="n">branch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch1</span><span class="p">)</span>
                <span class="n">lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">allRate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
                <span class="n">effRate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="o">*</span><span class="n">branch1</span><span class="p">)</span>
                <span class="n">totalRate</span> <span class="o">+=</span> <span class="n">rate</span><span class="o">*</span><span class="n">branch1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrRateLvl</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">allRate</span><span class="p">,</span> <span class="s1">&#39;effRate&#39;</span><span class="p">:</span><span class="n">effRate</span><span class="p">,</span> <span class="s1">&#39;totalRate&#39;</span><span class="p">:</span><span class="n">totalRate</span><span class="p">,</span>  <span class="s1">&#39;de&#39;</span><span class="p">:</span><span class="n">de</span><span class="p">,</span> <span class="s1">&#39;avalue&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">],</span> <span class="s1">&#39;lvl&#39;</span><span class="p">:</span><span class="n">lvl</span><span class="p">,</span> <span class="s1">&#39;branch&#39;</span><span class="p">:</span><span class="n">branch</span><span class="p">,</span> <span class="s1">&#39;dekt&#39;</span><span class="p">:</span><span class="n">dekt</span><span class="p">,</span> <span class="s1">&#39;erg&#39;</span><span class="p">:</span><span class="n">erg</span><span class="p">,</span> <span class="s1">&#39;ipErg&#39;</span><span class="p">:</span><span class="n">ipErg</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.recombRate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.recombRate">[docs]</a>    <span class="k">def</span> <span class="nf">recombRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the total recombination rate coefficient.</span>

<span class="sd">        Calls `drRate` and `rrRate`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RecombRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39; temperature is not defined&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RecombRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">}</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rrRate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drRate</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;DrRate&#39;</span><span class="p">):</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RrRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">DrRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RecombRate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.p2eRatio"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.p2eRatio">[docs]</a>    <span class="k">def</span> <span class="nf">p2eRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the proton density to electron density ratio using Eq. 7 of [1]_.</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>
<span class="sd">        Uses the abundance and ionization equilibrium.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [1] Young, P. R. et al., 2003, ApJS, `144, 135 &lt;http://adsabs.harvard.edu/abs/2003ApJS..144..135Y&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqAll</span><span class="p">[</span><span class="s1">&#39;ioneqTemperature&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;AbundanceName&#39;</span><span class="p">):</span>
            <span class="n">AbundanceName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;abundfile&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">AbundanceName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AbundanceName</span>

        <span class="n">tmp_abundance</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">abundanceRead</span><span class="p">(</span><span class="n">abundancename</span><span class="o">=</span><span class="n">AbundanceName</span><span class="p">)</span>
        <span class="n">abundance</span> <span class="o">=</span> <span class="n">tmp_abundance</span><span class="p">[</span><span class="s1">&#39;abundance&#39;</span><span class="p">][</span><span class="n">tmp_abundance</span><span class="p">[</span><span class="s1">&#39;abundance&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IoneqAll</span><span class="p">[</span><span class="s1">&#39;ioneqTemperature&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">abundance</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">denominator</span> <span class="o">+=</span> <span class="n">z</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">IoneqAll</span><span class="p">[</span><span class="s1">&#39;ioneqAll&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">z</span><span class="p">,:]</span><span class="o">*</span><span class="n">abundance</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">p2eratio</span> <span class="o">=</span> <span class="n">abundance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">IoneqAll</span><span class="p">[</span><span class="s1">&#39;ioneqAll&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span><span class="o">/</span><span class="n">denominator</span>
        <span class="n">nots</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IoneqAll</span><span class="p">[</span><span class="s1">&#39;ioneqTemperature&#39;</span><span class="p">]),</span><span class="n">p2eratio</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ProtonDensityRatio</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span><span class="n">nots</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ion.upsilonDescale"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.upsilonDescale">[docs]</a>    <span class="k">def</span> <span class="nf">upsilonDescale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prot</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the temperatures and effective collision strengths (upsilons)</span>
<span class="sd">        set prot for proton rates</span>
<span class="sd">        otherwise, ce will be set for electron collision rates</span>
<span class="sd">        uses the new format &quot;scups&quot; files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">prot</span><span class="p">:</span>
            <span class="n">ce</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Psplups&#39;</span><span class="p">):</span>
                <span class="n">nscups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">splupsRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;psplups&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PUpsilon</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nscups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ce</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Scups&#39;</span><span class="p">):</span>
                <span class="n">nscups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">scupsRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Upsilon</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nscups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Temperature undefined&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39; Temperature undefined&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Elvlc&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elvlcRead</span><span class="p">()</span>

        <span class="n">eryd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;eryd&quot;</span><span class="p">])</span>
        <span class="n">erydth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;erydth&quot;</span><span class="p">])</span>
        <span class="n">elvlc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">eryd</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">,</span><span class="n">eryd</span><span class="p">,</span><span class="n">erydth</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nscups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">exRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nscups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">dexRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nscups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nscups</span><span class="p">,</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">exRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nscups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">dexRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nscups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
        <span class="n">deAll</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iscups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nscups</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prot</span><span class="p">:</span>
                <span class="c1"># for proton rates</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l1idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">iscups</span><span class="p">])</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">iscups</span><span class="p">])</span>
                <span class="n">ttype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">cups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;cups&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">nspl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;nspl&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">splups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;splups&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">de</span> <span class="o">=</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l2idx</span><span class="p">]</span><span class="o">-</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l1idx</span><span class="p">]</span>
                <span class="n">kte</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="o">/</span><span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># electron collisional excitation or dielectronic excitation</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l1idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">iscups</span><span class="p">])</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">iscups</span><span class="p">])</span>
                <span class="n">ttype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">cups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;cups&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">nspl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;ntemp&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s1">&#39;btemp&#39;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">scups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;bscups&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">kte</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="o">/</span><span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span>
            <span class="n">der</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cups</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">scups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">scups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span> <span class="o">=</span> <span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">scups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cups</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">scups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="c1"># dielectronic rates</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">scups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="mf">0.</span><span class="p">)</span>
            <span class="c1">#  descale proton values</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">scups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="n">sups</span>
            <span class="k">elif</span> <span class="n">ttype</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; t_type ne 1,2,3,4,5 = </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ttype</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">ce</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">:</span>
                    <span class="c1"># the dielectronic ions will eventually be discontinued</span>
                    <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l2idx</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpperIp</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span><span class="p">)</span> <span class="o">-</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l1idx</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l2idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l1idx</span><span class="p">])</span>
                <span class="n">deAll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">de</span><span class="p">)</span>
                <span class="n">ekt</span> <span class="o">=</span> <span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
                <span class="n">fmult1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l1idx</span><span class="p">])</span>
                <span class="n">fmult2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l2idx</span><span class="p">])</span>
                <span class="n">dexRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">fmult2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
                <span class="n">exRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ekt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fmult1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">prot</span><span class="p">:</span>
                <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l2idx</span><span class="p">]</span><span class="o">-</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l1idx</span><span class="p">])</span>
                <span class="n">ekt</span> <span class="o">=</span> <span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="mf">1.57888e+5</span><span class="p">)</span><span class="o">/</span><span class="n">temp</span>
                <span class="n">fmult1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l1idx</span><span class="p">])</span>
                <span class="n">fmult2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l2idx</span><span class="p">])</span>
                <span class="n">dexRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">fmult2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
                <span class="n">exRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ekt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fmult1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>

        <span class="n">ups</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ups</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span><span class="n">ups</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prot</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PUpsilon</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upsilon&#39;</span><span class="p">:</span><span class="n">ups</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span>
                                <span class="s1">&#39;exRate&#39;</span><span class="p">:</span><span class="n">exRate</span><span class="p">,</span> <span class="s1">&#39;dexRate&#39;</span><span class="p">:</span><span class="n">dexRate</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Upsilon</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upsilon&#39;</span><span class="p">:</span><span class="n">ups</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span>
                            <span class="s1">&#39;exRate&#39;</span><span class="p">:</span><span class="n">exRate</span><span class="p">,</span> <span class="s1">&#39;dexRate&#39;</span><span class="p">:</span><span class="n">dexRate</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">:</span><span class="n">deAll</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.upsilonDescaleSplups"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.upsilonDescaleSplups">[docs]</a>    <span class="k">def</span> <span class="nf">upsilonDescaleSplups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">diel</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the temperatures and effective collision strengths (upsilons)</span>
<span class="sd">        set prot for proton rates</span>
<span class="sd">        otherwise, ce will be set for electron collision rates</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">prot</span><span class="p">:</span>
            <span class="n">ce</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Psplups&#39;</span><span class="p">):</span>
                <span class="n">nsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">splupsRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;psplups&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PUpsilon</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">diel</span><span class="p">:</span>
            <span class="n">ce</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;DielSplups&#39;</span><span class="p">):</span>
                <span class="n">nsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">splupsRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;splups&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">DielUpsilon</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ce</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Splups&#39;</span><span class="p">):</span>
                <span class="n">nsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">splupsRead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Upsilon</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nsplups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Temperature undefined&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="s1">&#39; Temperature undefined&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Elvlc&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elvlcRead</span><span class="p">()</span>

        <span class="c1">#  need to make sure elvl is &gt;0, except for ground level</span>
        <span class="n">eryd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;eryd&quot;</span><span class="p">])</span>
        <span class="n">erydth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;erydth&quot;</span><span class="p">])</span>
        <span class="n">elvlc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">eryd</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span><span class="n">eryd</span><span class="p">,</span><span class="n">erydth</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsplups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">exRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsplups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">dexRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsplups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsplups</span><span class="p">,</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">exRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsplups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
            <span class="n">dexRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsplups</span><span class="p">,</span><span class="n">ntemp</span><span class="p">),</span><span class="s2">&quot;Float64&quot;</span><span class="p">)</span>
        <span class="n">deAll</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">isplups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsplups</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prot</span><span class="p">:</span>
                <span class="c1"># for proton rates</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">fmult1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">]</span>
                <span class="n">fmult2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span>
                <span class="n">ttype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">cups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;cups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">nspl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;nspl&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">splups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;splups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">de</span> <span class="o">=</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">-</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l1</span><span class="p">]</span>
                <span class="n">kte</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="o">/</span><span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">diel</span><span class="p">:</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">ttype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">cups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;cups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">nspl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;nspl&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">ttype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">splups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s2">&quot;splups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DielSplups</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">kte</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="o">/</span><span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># electron collisional excitation</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">ttype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">cups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;cups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">nspl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;nspl&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">splups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s2">&quot;splups&quot;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Splups</span><span class="p">[</span><span class="s1">&#39;de&#39;</span><span class="p">][</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">kte</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="o">/</span><span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span>
            <span class="n">der</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cups</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cups</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="c1"># dielectronic rates</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">sups</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="mf">0.</span><span class="p">)</span>
            <span class="c1">#  descale proton values</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">kte</span><span class="o">/</span><span class="p">(</span><span class="n">kte</span><span class="o">+</span><span class="n">cups</span><span class="p">)</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nspl</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">splups</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">sups</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
                <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="n">sups</span>
            <span class="k">elif</span> <span class="n">ttype</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>  <span class="nb">print</span><span class="p">(</span>
                            <span class="s1">&#39; t_type ne 1,2,3,4,5 = </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ttype</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ce</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">:</span>
                    <span class="c1"># the dielectronic ions will eventually be discontinued</span>
                    <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpperIp</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span><span class="p">)</span> <span class="o">-</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">deAll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">de</span><span class="p">)</span>
                <span class="n">ekt</span> <span class="o">=</span> <span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
                <span class="n">fmult1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">fmult2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l2</span><span class="p">])</span>
                <span class="n">dexRate</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">fmult2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
                <span class="n">exRate</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ekt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fmult1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">diel</span><span class="p">:</span>
                <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2Ev</span><span class="p">)</span> <span class="o">-</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">ekt</span> <span class="o">=</span> <span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ryd2erg</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
                <span class="n">fmult1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">fmult2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l2</span><span class="p">])</span>
                <span class="n">exRate</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">collision</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ekt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fmult1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">prot</span><span class="p">:</span>
                <span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">elvlc</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">-</span> <span class="n">elvlc</span><span class="p">[</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">ekt</span> <span class="o">=</span> <span class="p">(</span><span class="n">de</span><span class="o">*</span><span class="mf">1.57888e+5</span><span class="p">)</span><span class="o">/</span><span class="n">temp</span>
                <span class="n">fmult1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">fmult2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">][</span><span class="n">l2</span><span class="p">])</span>
                <span class="n">dexRate</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span>
                <span class="n">exRate</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fmult1</span><span class="o">/</span><span class="n">fmult2</span><span class="p">)</span><span class="o">*</span><span class="n">ups</span><span class="p">[</span><span class="n">isplups</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ekt</span><span class="p">)</span>

        <span class="n">ups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ups</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span><span class="n">ups</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PUpsilon</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;exRate&#39;</span><span class="p">:</span><span class="n">exRate</span><span class="p">,</span> <span class="s1">&#39;dexRate&#39;</span><span class="p">:</span><span class="n">dexRate</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">diel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DielUpsilon</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upsilon&#39;</span><span class="p">:</span><span class="n">ups</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;exRate&#39;</span><span class="p">:</span><span class="n">exRate</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Upsilon</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upsilon&#39;</span><span class="p">:</span><span class="n">ups</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;exRate&#39;</span><span class="p">:</span><span class="n">exRate</span><span class="p">,</span> <span class="s1">&#39;dexRate&#39;</span><span class="p">:</span><span class="n">dexRate</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">:</span><span class="n">deAll</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.spectrum"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="p">(</span><span class="n">chfilters</span><span class="o">.</span><span class="n">gaussianR</span><span class="p">,</span><span class="mf">1000.</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">allLines</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the line emission spectrum for the specified ion.</span>

<span class="sd">        Convolves the results of intensity to make them look like an observed spectrum</span>
<span class="sd">        the default filter is the gaussianR filter with a resolving power of 1000.  Other choices</span>
<span class="sd">        include chianti.filters.box and chianti.filters.gaussian.  When using the box filter,</span>
<span class="sd">        the width should equal the wavelength interval to keep the units of the continuum and line</span>
<span class="sd">        spectrum the same.</span>

<span class="sd">        includes ionization equilibrium and elemental abundances</span>

<span class="sd">        can be called multiple times to use different filters and widths</span>
<span class="sd">        uses label to keep the separate applications of spectrum sorted by the label</span>
<span class="sd">        for example, do .spectrum( .... labe=&#39;test1&#39;)</span>
<span class="sd">        and do          .spectrum( ....  label = &#39;test2&#39;)</span>
<span class="sd">        then will get self.Spectrum.keys() = test1, test2 and</span>
<span class="sd">        self.Spectrum[&#39;test1&#39;] = {&#39;intensity&#39;:aspectrum,  &#39;wvl&#39;:wavelength, &#39;filter&#39;:useFilter.__name__, &#39;filterWidth&#39;:useFactor}</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>
<span class="sd">        scipy.ndimage.filters also includes a range of filters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;erg cm$^{-2}$ s$^{-1}$ sr$^{-1} \AA^{-1}$ ($\int\,$ N$_e\,$N$_H\,$d${\it l}$)$^{-1}$&#39;</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Wavelength (&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span>
        <span class="n">nTemp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="n">nDens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span>
        <span class="n">useFilter</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">useFactor</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">wvlRange</span> <span class="o">=</span> <span class="p">[</span><span class="n">wavelength</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">wavelength</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Intensity&#39;</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span><span class="p">(</span><span class="n">allLines</span><span class="o">=</span><span class="n">allLines</span><span class="p">)</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span>
        <span class="c1">#  if intensity had been called with em, then the intensities are</span>
        <span class="c1"># already multiply by em</span>
        <span class="k">if</span> <span class="s1">&#39;errorMessage&#39;</span> <span class="ow">in</span> <span class="n">intensity</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">errorMessage</span> <span class="o">=</span> <span class="n">intensity</span><span class="p">[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errorMessage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Em&#39;</span><span class="p">):</span>
            <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Em</span>
            <span class="n">useEm</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#        elif em == None:</span>
<span class="c1">#            em = np.ones(self.NTempDen, &#39;float64&#39;)</span>
<span class="c1">#            self.Em = em</span>
<span class="c1">#            useEm = 1</span>
<span class="c1">#        elif type(em) == float and em &gt; 0.:</span>
<span class="c1">#            em = np.ones(self.NTempDen, &#39;float64&#39;)*em</span>
<span class="c1">#            self.Em = em</span>
<span class="c1">#            useEm = 1</span>
<span class="c1">#        elif type(em) == list or type(em) == tuple or type(em) == np.ndarray:</span>
<span class="c1">#            em = np.asarray(em, &#39;float64&#39;)</span>
<span class="c1">#            self.Em = em</span>
<span class="c1">#            useEm = 1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;erg cm$^{-2}$ s$^{-1}$ sr$^{-1} \AA^{-1}$ &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;erg cm$^{-2}$ s$^{-1}$ sr$^{-1} \AA^{-1}$ ($\int\,$ N$_e\,$N$_H\,$d${\it l}$)$^{-1}$&#39;</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Wavelength (&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NTempDen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">aspectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;errorMessage&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">],</span> <span class="n">wvlRange</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="c1">#                    print(&#39; no lines in wavelength range %12.2f - %12.2f&#39;%(wavelength.min(), wavelength.max()))</span>
<span class="c1">#                    self.Spectrum = {&#39;errorMessage&#39;:&#39; no lines in wavelength range %12.2f - %12.2f&#39;%(wavelength.min(), wavelength.max())}</span>
                    <span class="n">errorMessage</span> <span class="o">=</span>  <span class="s1">&#39;no lines in wavelength range </span><span class="si">%12.2f</span><span class="s1"> - </span><span class="si">%12.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wavelength</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">wavelength</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">iwvl</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
                        <span class="n">wvlCalc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">][</span><span class="n">iwvl</span><span class="p">]</span>
                        <span class="n">aspectrum</span> <span class="o">+=</span> <span class="n">useFilter</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">wvlCalc</span><span class="p">,</span>
                                    <span class="n">factor</span><span class="o">=</span><span class="n">useFactor</span><span class="p">)</span><span class="o">*</span><span class="n">intensity</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">iwvl</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">useEm</span><span class="p">:</span>
                        <span class="n">aspectrum</span> <span class="o">*=</span> <span class="n">em</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NTempDen</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">aspectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">NTempDen</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;errorMessage&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">],</span> <span class="n">wvlRange</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="c1">#                    print(&#39; no lines in wavelength range %12.2f - %12.2f&#39;%(wavelength.min(), wavelength.max()))</span>
<span class="c1">#                    self.Spectrum = {&#39;errorMessage&#39;:&#39; no lines in wavelength range %12.2f - %12.2f&#39;%(wavelength.min(), wavelength.max())}</span>
                    <span class="n">errorMessage</span> <span class="o">=</span>  <span class="s1">&#39;no lines in wavelength range </span><span class="si">%12.2f</span><span class="s1"> - </span><span class="si">%12.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wavelength</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">wavelength</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">itemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NTempDen</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">iwvl</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
                            <span class="n">wvlCalc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">][</span><span class="n">iwvl</span><span class="p">]</span>
                            <span class="n">aspectrum</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span> <span class="o">+=</span> <span class="n">useFilter</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">wvlCalc</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">useFactor</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span><span class="p">[</span><span class="s1">&#39;intensity&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">,</span> <span class="n">iwvl</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">useEm</span><span class="p">:</span>
                            <span class="n">aspectrum</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span> <span class="o">*=</span> <span class="n">em</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;intensity&#39;</span><span class="p">:</span><span class="n">aspectrum</span><span class="p">,</span>  <span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wavelength</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span><span class="n">useFilter</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;filterWidth&#39;</span><span class="p">:</span><span class="n">useFactor</span><span class="p">,</span> <span class="s1">&#39;allLines&#39;</span><span class="p">:</span><span class="n">allLines</span><span class="p">,</span> <span class="s1">&#39;em&#39;</span><span class="p">:</span><span class="n">em</span><span class="p">,</span> <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="n">xlabel</span><span class="p">,</span> <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="n">ylabel</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">errorMessage</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errorMessage</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Spectrum</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:{</span><span class="s1">&#39;intensity&#39;</span><span class="p">:</span><span class="n">aspectrum</span><span class="p">,</span>  <span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wavelength</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span><span class="n">useFilter</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;filterWidth&#39;</span><span class="p">:</span><span class="n">useFactor</span><span class="p">,</span> <span class="s1">&#39;allLines&#39;</span><span class="p">:</span><span class="n">allLines</span><span class="p">,</span> <span class="s1">&#39;em&#39;</span><span class="p">:</span><span class="n">em</span><span class="p">,</span> <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="n">xlabel</span><span class="p">,</span> <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="n">ylabel</span><span class="p">}}</span>
                <span class="k">if</span> <span class="n">errorMessage</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errorMessage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Spectrum</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;intensity&#39;</span><span class="p">:</span><span class="n">aspectrum</span><span class="p">,</span>  <span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wavelength</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">:</span><span class="n">useFilter</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s1">&#39;filterWidth&#39;</span><span class="p">:</span><span class="n">useFactor</span><span class="p">,</span> <span class="s1">&#39;allLines&#39;</span><span class="p">:</span><span class="n">allLines</span><span class="p">,</span> <span class="s1">&#39;em&#39;</span><span class="p">:</span><span class="n">em</span><span class="p">,</span> <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="n">xlabel</span><span class="p">,</span> <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="n">ylabel</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">errorMessage</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errorMessage</span></div>


<div class="viewcode-block" id="ion.populate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.populate">[docs]</a>    <span class="k">def</span> <span class="nf">populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">popCorrect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate level populations for specified ion.</span>
<span class="sd">        possible keyword arguments include temperature, eDensity, pDensity, radTemperature and rStar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">one</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chdata</span><span class="o">.</span><span class="n">keywordArgs</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; following keyword is not understood - </span><span class="si">%20s</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">one</span><span class="p">))</span>
        <span class="n">nlvls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlvls</span>
        <span class="n">nwgfa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nwgfa</span>
        <span class="n">nscups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nscups</span>
        <span class="n">npsplups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Npsplups</span>
        <span class="n">nauto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nauto</span>

        <span class="k">if</span> <span class="s1">&#39;temperature&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">])</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; no temperature values have been set&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;eDensity&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;eDensity&#39;</span><span class="p">])</span>
            <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;EDensity&#39;</span><span class="p">):</span>
            <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; no eDensity values have been set&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;pDensity&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pDensity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p2eRatio</span><span class="p">()</span>
                <span class="n">protonDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProtonDensityRatio</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pDensity&#39;</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; could not interpret value for keyword pDensity&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; should be either &quot;default&quot; or a number or array&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;PDensity&#39;</span><span class="p">):</span>
                <span class="n">protonDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p2eRatio</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProtonDensityRatio</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
                <span class="n">protonDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; proton density not specified, set to </span><span class="se">\&quot;</span><span class="s1">default</span><span class="se">\&quot;</span><span class="s1"> &#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="s1">&#39;radTemperature&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;rStar&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RadTemperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;radTemperature&#39;</span><span class="p">])</span>
            <span class="n">radTemperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RadTemperature</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RStar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rStar&#39;</span><span class="p">])</span>
            <span class="n">rStar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RStar</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;RadTemperature&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;RStar&#39;</span><span class="p">):</span>
            <span class="n">radTemperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadTemperature</span>
            <span class="n">rStar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RStar</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ci</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># the Dielectronic test should eventually go away</span>
        <span class="k">if</span> <span class="n">popCorrect</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ncilvl</span><span class="p">:</span>
                <span class="n">ci</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">cilvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cilvl</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;CilvlRate&#39;</span><span class="p">):</span>
                    <span class="n">cilvlRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cireclvlDescale</span><span class="p">(</span><span class="s1">&#39;cilvl&#39;</span><span class="p">)</span>
                    <span class="n">cilvlRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recombRate</span><span class="p">()</span>
                <span class="c1">#</span>
                <span class="n">lowers</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">zion2name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># get the lower ionization stage</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">ion</span><span class="p">(</span><span class="n">lowers</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">)</span>
                <span class="n">lower</span><span class="o">.</span><span class="n">ionizRate</span><span class="p">()</span>
                <span class="c1"># need to get multiplicity of lower ionization stage</span>
                <span class="n">lowMult</span> <span class="o">=</span> <span class="n">lower</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ci</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nauto</span><span class="p">:</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span><span class="p">:</span>
                <span class="n">reclvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reclvl</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ReclvlRate&#39;</span><span class="p">):</span>
                    <span class="n">reclvlRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReclvlRate</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cireclvlDescale</span><span class="p">(</span><span class="s1">&#39;reclvl&#39;</span><span class="p">)</span>
                    <span class="n">reclvlRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReclvlRate</span>

        <span class="k">if</span> <span class="n">rec</span><span class="p">:</span>
            <span class="c1"># get ionization rate of this current ion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ionizRate</span><span class="p">()</span>
            <span class="c1">#  get the higher ionization stage and its recombination rates</span>
            <span class="n">highers</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">zion2name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">higher</span> <span class="o">=</span> <span class="n">ion</span><span class="p">(</span><span class="n">highers</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">eDensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">higher</span><span class="o">.</span><span class="n">setupIonrec</span><span class="p">()</span>
            <span class="n">higher</span><span class="o">.</span><span class="n">recombRate</span><span class="p">()</span>

        <span class="c1">#  the populating matrix for radiative transitions</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="p">,</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="p">),</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">iwgfa</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwgfa</span><span class="p">):</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">rad</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span>
            <span class="n">rad</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span>
            <span class="c1"># photo-excitation and stimulated emission</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadTemperature</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">RStar</span><span class="p">:</span>
                    <span class="n">dilute</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dilute</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">dilute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RStar</span><span class="p">)</span>
                <span class="c1"># next - don&#39;t include autoionization lines</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">de</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">invCm2Erg</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                    <span class="n">dekt</span> <span class="o">=</span> <span class="n">de</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">RadTemperature</span><span class="p">)</span>
                    <span class="c1"># photoexcitation</span>
                    <span class="n">phexFactor</span> <span class="o">=</span> <span class="n">dilute</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dekt</span><span class="p">)</span> <span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">rad</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span><span class="o">*</span><span class="n">phexFactor</span>
                    <span class="n">rad</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span><span class="o">*</span><span class="n">phexFactor</span>
                    <span class="c1"># stimulated emission</span>
                    <span class="n">stemFactor</span> <span class="o">=</span> <span class="n">dilute</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dekt</span><span class="p">)</span> <span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">rad</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span><span class="o">*</span><span class="n">stemFactor</span>
                    <span class="n">rad</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iwgfa</span><span class="p">]</span><span class="o">*</span><span class="n">stemFactor</span>

        <span class="c1"># autoionization rates</span>
        <span class="k">for</span> <span class="n">iauto</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nauto</span><span class="p">):</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">iauto</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">iauto</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># all autoionization eventually goes to the ground level of the higher ion</span>
            <span class="n">rad</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iauto</span><span class="p">]</span>
            <span class="n">rad</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">][</span><span class="n">iauto</span><span class="p">]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nscups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upsilonDescale</span><span class="p">()</span>
            <span class="c1">#ups = self.Upsilon[&#39;upsilon&#39;]</span>
            <span class="n">exRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Upsilon</span><span class="p">[</span><span class="s1">&#39;exRate&#39;</span><span class="p">]</span>
            <span class="n">dexRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Upsilon</span><span class="p">[</span><span class="s1">&#39;dexRate&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">npsplups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upsilonDescaleSplups</span><span class="p">(</span><span class="n">prot</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pexRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PUpsilon</span><span class="p">[</span><span class="s1">&#39;exRate&#39;</span><span class="p">]</span>
            <span class="n">pdexRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PUpsilon</span><span class="p">[</span><span class="s1">&#39;dexRate&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nauto</span><span class="p">:</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">])</span>
            <span class="c1"># first get branching ratio</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">][</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">branch</span><span class="p">[</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">][</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">][</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;avalueLvl&#39;</span><span class="p">][</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="n">branch</span><span class="p">[</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">size</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="n">ndens</span> <span class="o">=</span> <span class="n">dens</span><span class="o">.</span><span class="n">size</span>
<span class="c1">#        cc = const.collision*self.EDensity</span>
        <span class="c1">#</span>
        <span class="c1"># (4 pi a0^2)^(3/2) = 6.6011e-24 (Badnell et al, 2003, A&amp;A 406, 1151</span>
        <span class="n">coef1</span> <span class="o">=</span> <span class="mf">6.6011e-24</span><span class="o">*</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">hartree</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">))</span><span class="o">**</span><span class="mf">1.5</span>
        <span class="n">coef2</span> <span class="o">=</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">emass</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span>

        <span class="c1">#</span>
<span class="c1">#        if npsplups:</span>
<span class="c1">#            cp = const.collision*protonDensity</span>
        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ndens</span> <span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">!=</span> <span class="n">ndens</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; unless temperature or eDensity are single values&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; the number of temperatures values must match the &#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; the number of eDensity values&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="c1"># get corrections for recombination and excitation</span>
        <span class="n">nscups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nscups</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># the way temperature and density are now (9/2015) handled as arrays of the same size</span>
        <span class="c1"># one the ndens == ntemp =1 case and the ndens &gt;1 and ntemp&gt;1 case are really needed</span>
        <span class="c1">#</span>
        <span class="n">errorMessage</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#  first, for ntemp=ndens=1</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coef1 </span><span class="si">%12.2e</span><span class="s1">  coef2: </span><span class="si">%12.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">coef1</span><span class="p">,</span> <span class="n">coef2</span><span class="p">))</span>
            <span class="n">popmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; doing ntemp: </span><span class="si">%5i</span><span class="s1">  ndens:  </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ntemp</span><span class="p">,</span> <span class="n">ndens</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">iscups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nscups</span><span class="p">):</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="c1">#</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">dexRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">exRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">exRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">dexRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">]</span>
                <span class="c1">#</span>
            <span class="k">for</span> <span class="n">ipsplups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">npsplups</span><span class="p">):</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">ipsplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">ipsplups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                 <span class="c1">#</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="o">*</span><span class="n">pdexRate</span><span class="p">[</span><span class="n">ipsplups</span><span class="p">]</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="o">*</span><span class="n">pexRate</span><span class="p">[</span><span class="n">ipsplups</span><span class="p">]</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="o">*</span><span class="n">pexRate</span><span class="p">[</span><span class="n">ipsplups</span><span class="p">]</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="o">*</span><span class="n">pdexRate</span><span class="p">[</span><span class="n">ipsplups</span><span class="p">]</span>
           <span class="c1"># now include ionization rate from lower ionization stage</span>
            <span class="k">if</span> <span class="n">ci</span><span class="p">:</span>
                <span class="c1"># the ciRate can be computed for all temperatures</span>
                <span class="n">ciTot</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cilvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])):</span>
                    <span class="n">lvl1</span> <span class="o">=</span> <span class="n">cilvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">lvl2</span> <span class="o">=</span> <span class="n">cilvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="c1"># this is kind of double booking the ionization rate</span>
                    <span class="c1"># components</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">lvl2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span> <span class="n">lvl1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">lvl1</span><span class="p">,</span> <span class="n">lvl1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                    <span class="n">ciTot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                <span class="c1">#</span>
                <span class="n">popmat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">lower</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ciTot</span><span class="p">)</span>
                <span class="n">popmat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">lower</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ciTot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">:</span>

                <span class="n">popmat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">ci</span><span class="p">,</span> <span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span><span class="p">:</span>
                    <span class="n">recTot</span> <span class="o">=</span> <span class="n">reclvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">recTot</span> <span class="o">=</span> <span class="mf">0.</span>

                <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span><span class="p">):</span>
                    <span class="n">lvl1</span> <span class="o">=</span> <span class="n">reclvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">lvl2</span> <span class="o">=</span> <span class="n">reclvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">lvl2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">reclvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">reclvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; recTot:  </span><span class="si">%12.2e</span><span class="s1">  RrRate:  </span><span class="si">%12.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">recTot</span><span class="p">,</span> <span class="n">higher</span><span class="o">.</span><span class="n">RecombRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]))</span>
                <span class="c1"># next 2 lines take care of overbooking</span>
                <span class="c1">#</span>
                <span class="n">drTot</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nauto</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]):</span>
                        <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">elvl1idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">elvl2idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">upperIdx</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">gUpper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">upperIdx</span><span class="p">])</span>
                        <span class="n">gLower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">])</span>

                        <span class="c1">#ecm1 = self.Higher.Elvlc[&#39;ecmth&#39;][l1]</span>
                        <span class="n">ecm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">ecm2</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
                            <span class="n">ecm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecmth&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">]</span>
                        <span class="n">de1</span> <span class="o">=</span> <span class="n">ecm2</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2Erg</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ev2Erg</span>
                        <span class="n">dekt1</span> <span class="o">=</span> <span class="n">de1</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)</span>
                        <span class="n">expkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dekt1</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">higher</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">][</span><span class="n">upperIdx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">dielRate</span> <span class="o">=</span> <span class="n">coef2</span><span class="o">*</span><span class="n">gLower</span><span class="o">*</span><span class="n">expkt</span><span class="o">*</span><span class="n">avalue</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">gUpper</span><span class="p">)</span>
                            <span class="n">popmat</span><span class="p">[</span><span class="n">ci</span> <span class="o">+</span> <span class="n">l2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">dielRate</span>
                            <span class="n">drTot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="n">dielRate</span><span class="o">*</span><span class="n">branch</span><span class="p">[</span><span class="n">elvl2idx</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">higher</span><span class="o">.</span><span class="n">RecombRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">recTot</span> <span class="o">+</span> <span class="n">drTot</span><span class="p">):</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">ci</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">RecombRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">recTot</span> <span class="o">-</span> <span class="n">drTot</span><span class="p">)</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">*</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">RecombRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">recTot</span> <span class="o">-</span> <span class="n">drTot</span><span class="p">)</span>

            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="p">,</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ci</span><span class="p">:</span>
                <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">:</span>
                <span class="n">norm</span><span class="p">[</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">:</span>
                <span class="n">norm</span><span class="p">[</span><span class="n">nlvls</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">popmat</span><span class="p">[</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="p">,</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">thispop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">popmat</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="n">thispop</span><span class="p">[</span><span class="n">ci</span><span class="p">:</span><span class="n">ci</span><span class="o">+</span><span class="n">nlvls</span><span class="p">]</span>
            <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlvls</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="n">errorMessage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;linealgError for singe T&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">ntemp</span><span class="o">&gt;</span><span class="mi">1</span>  <span class="ow">and</span> <span class="n">ntemp</span><span class="o">==</span><span class="n">ndens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; doing both ntemp: </span><span class="si">%5i</span><span class="s1">  ndens:  </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ntemp</span><span class="p">,</span> <span class="n">ndens</span><span class="p">))</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntemp</span><span class="p">,</span><span class="n">nlvls</span><span class="p">),</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">itemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntemp</span><span class="p">):</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span>
                <span class="n">popmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">iscups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nscups</span><span class="p">):</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">iscups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">dexRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">exRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">exRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">dexRate</span><span class="p">[</span><span class="n">iscups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                <span class="c1"># proton rates</span>
                <span class="k">for</span> <span class="n">ipslups</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npsplups</span><span class="p">):</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl1&quot;</span><span class="p">][</span><span class="n">ipslups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Psplups</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">][</span><span class="n">ipslups</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">pdexRate</span><span class="p">[</span><span class="n">ipslups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">pexRate</span><span class="p">[</span><span class="n">ipslups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l1</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">pexRate</span><span class="p">[</span><span class="n">ipslups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span><span class="n">l2</span><span class="o">+</span><span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">pdexRate</span><span class="p">[</span><span class="n">ipslups</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                <span class="c1"># now include ionization rate from the lower ionization stage</span>
                <span class="k">if</span> <span class="n">ci</span><span class="p">:</span>
                    <span class="n">ciTot</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cilvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">])):</span>
                        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">cilvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">lvl2</span> <span class="o">=</span> <span class="n">cilvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">popmat</span><span class="p">[</span><span class="n">lvl2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span> <span class="n">lvl1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                        <span class="n">popmat</span><span class="p">[</span><span class="n">lvl1</span><span class="p">,</span> <span class="n">lvl1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                        <span class="n">ciTot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CilvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>

                    <span class="n">popmat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">lower</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">]</span> <span class="o">-</span> <span class="n">ciTot</span><span class="p">)</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">lower</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">]</span> <span class="o">-</span> <span class="n">ciTot</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rec</span><span class="p">:</span>

                    <span class="n">popmat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">ci</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">]</span>
                    <span class="n">popmat</span><span class="p">[</span><span class="n">ci</span><span class="p">,</span> <span class="n">ci</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">IonizRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span><span class="p">:</span>
                        <span class="n">recTot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReclvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][:,</span> <span class="n">itemp</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">recTot</span> <span class="o">=</span> <span class="mf">0.</span>

                    <span class="k">for</span> <span class="n">itrans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nreclvl</span><span class="p">):</span>
                        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">reclvl</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="n">lvl2</span> <span class="o">=</span> <span class="n">reclvl</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
                        <span class="n">popmat</span><span class="p">[</span><span class="n">lvl2</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ReclvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span> <span class="n">itemp</span><span class="p">]</span>
                        <span class="n">popmat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ReclvlRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itrans</span><span class="p">,</span><span class="n">itemp</span><span class="p">]</span>

                <span class="c1">#</span>
                <span class="n">drTot</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nauto</span><span class="p">:</span>
                    <span class="n">autoLvl2</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]):</span>
                        <span class="n">elvl1idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">elvl2idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">autoLvl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
                        <span class="n">upperIdx</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Auto</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">gUpper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">upperIdx</span><span class="p">])</span>
                        <span class="n">gLower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;mult&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">])</span>

                        <span class="n">ecm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">ecm2</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
                            <span class="n">ecm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecmth&#39;</span><span class="p">][</span><span class="n">elvl2idx</span><span class="p">]</span>
                        <span class="n">de1</span> <span class="o">=</span> <span class="n">ecm2</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">invCm2Erg</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ip</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">ev2Erg</span>
                        <span class="n">dekt1</span> <span class="o">=</span> <span class="n">de1</span><span class="o">/</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">[</span><span class="n">itemp</span><span class="p">])</span>
                        <span class="n">expkt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dekt1</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">higher</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;lvl&#39;</span><span class="p">][</span><span class="n">upperIdx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">dielRate</span> <span class="o">=</span> <span class="n">coef2</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">gLower</span><span class="o">*</span><span class="n">expkt</span><span class="o">*</span><span class="n">avalue</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">gUpper</span><span class="p">)</span>
                            <span class="n">popmat</span><span class="p">[</span><span class="n">ci</span> <span class="o">+</span> <span class="n">l2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">dielRate</span>
                            <span class="n">drTot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="n">dielRate</span><span class="o">*</span><span class="n">branch</span><span class="p">[</span><span class="n">elvl2idx</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">higher</span><span class="o">.</span><span class="n">RecombRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">recTot</span> <span class="o">+</span> <span class="n">drTot</span><span class="p">):</span>
                        <span class="n">popmat</span><span class="p">[</span><span class="n">ci</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">RecombRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">]</span> <span class="o">-</span> <span class="n">recTot</span> <span class="o">-</span> <span class="n">drTot</span><span class="p">)</span>
                        <span class="n">popmat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">RecombRate</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">][</span><span class="n">itemp</span><span class="p">]</span> <span class="o">-</span> <span class="n">recTot</span> <span class="o">-</span> <span class="n">drTot</span><span class="p">)</span>

                <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="p">,</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Popmat</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">popmat</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ci</span><span class="p">:</span>
                    <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">if</span> <span class="n">rec</span><span class="p">:</span>
                    <span class="n">norm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="n">popmat</span><span class="p">[</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="p">,</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="n">b</span><span class="p">[</span><span class="n">nlvls</span><span class="o">+</span><span class="n">ci</span><span class="o">+</span><span class="n">rec</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">thispop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">popmat</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">pop</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span> <span class="o">=</span> <span class="n">thispop</span><span class="p">[</span><span class="n">ci</span><span class="p">:</span><span class="n">ci</span><span class="o">+</span><span class="n">nlvls</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                    <span class="n">pop</span><span class="p">[</span><span class="n">itemp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlvls</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                    <span class="n">errorMessage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;linealgError for T index </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">itemp</span><span class="p">))</span>
            <span class="c1">#</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pop</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pop</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Population</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span><span class="n">temperature</span><span class="p">,</span><span class="s2">&quot;eDensity&quot;</span><span class="p">:</span><span class="n">eDensity</span><span class="p">,</span><span class="s2">&quot;population&quot;</span><span class="p">:</span><span class="n">pop</span><span class="p">,</span> <span class="s2">&quot;protonDensity&quot;</span><span class="p">:</span><span class="n">protonDensity</span><span class="p">,</span> <span class="s2">&quot;ci&quot;</span><span class="p">:</span><span class="n">ci</span><span class="p">,</span> <span class="s2">&quot;rec&quot;</span><span class="p">:</span><span class="n">rec</span><span class="p">,</span> <span class="s1">&#39;popmat&#39;</span><span class="p">:</span><span class="n">popmat</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errorMessage</span></div>

<div class="viewcode-block" id="ion.popPlot"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.popPlot">[docs]</a>    <span class="k">def</span> <span class="nf">popPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">plotFile</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">outFile</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pub</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots populations vs temperature or eDensity.</span>

<span class="sd">        top specifies the number of the most highly populated levels to plot</span>
<span class="sd">        if pub is set, the want publication plots (bw, lw=2).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pub</span><span class="p">:</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">):</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span>
            <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s2">&quot;eDensity&quot;</span><span class="p">]</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
            <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span>
            <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s2">&quot;eDensity&quot;</span><span class="p">]</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span>

        <span class="c1">#  for case of only a single density and temperature</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
            <span class="n">minPop</span> <span class="o">=</span> <span class="n">spop</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span>
            <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">pop</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">size</span>
            <span class="k">for</span> <span class="n">itop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">top</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="n">itop</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="n">itop</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="n">itop</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="n">itop</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">minPop</span><span class="p">,</span> <span class="n">spop</span><span class="p">[</span><span class="o">-</span><span class="n">itop</span><span class="p">],</span> <span class="n">spop</span><span class="p">[</span><span class="o">-</span><span class="n">itop</span><span class="p">],</span> <span class="n">minPop</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">minPop</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Level&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># find the top most populated levels</span>
        <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s2">&quot;lvl&quot;</span><span class="p">]</span>
        <span class="n">nlvls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlvls</span>
        <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">nlvls</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">nlvls</span>
        <span class="n">maxpop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlvls</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ilvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlvls</span><span class="p">):</span>
            <span class="n">maxpop</span><span class="p">[</span><span class="n">ilvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[:,</span><span class="n">ilvl</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">lvlsort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">maxpop</span><span class="p">))</span>
        <span class="n">toplvl</span> <span class="o">=</span> <span class="n">lvlsort</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">temperature</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ntemp</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ndens</span> <span class="o">=</span> <span class="n">eDensity</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eDensity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">eDensity</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ndens</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Population&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Spectroscopic</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">toppops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">top</span><span class="p">,</span> <span class="n">ntemp</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ilvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
                <span class="n">toppops</span><span class="p">[</span><span class="n">ilvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[:,</span> <span class="n">toplvl</span><span class="p">[</span><span class="n">ilvl</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nonzero</span> <span class="o">=</span> <span class="n">toppops</span> <span class="o">&gt;</span> <span class="mf">0.</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">toppops</span><span class="p">[</span><span class="n">nonzero</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">toplvl</span><span class="p">:</span>
                <span class="c1"># for some low temperature, populations can not be calculated</span>
                <span class="n">good</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[:,</span> <span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">pub</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">good</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">good</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">good</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">good</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">skip</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="k">if</span> <span class="n">good</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntemp</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span><span class="n">ntemp</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">itemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">ntemp</span><span class="p">,</span><span class="n">ntemp</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">itemp</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">itemp</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">lvl</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newtemp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">one</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">good</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">newtemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">newtemp</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ntemp</span> <span class="o">-</span> <span class="n">good</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">itemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">ntemp</span><span class="p">,</span><span class="n">ntemp</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">itemp</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">itemp</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">lvl</span><span class="p">))</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Temperature (K)&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39; -  Density = </span><span class="si">%10.2e</span><span class="s1"> (cm$^{-3}$)&#39;</span> <span class="o">%</span> <span class="n">eDensity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="n">dstr</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">temperature</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">temperature</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Electron Density (cm$^{-3}$)&#39;</span>
            <span class="n">toppops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">top</span><span class="p">,</span> <span class="n">ndens</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ilvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
                <span class="n">toppops</span><span class="p">[</span><span class="n">ilvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[:,</span> <span class="n">toplvl</span><span class="p">[</span><span class="n">ilvl</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nonzero</span> <span class="o">=</span> <span class="n">toppops</span> <span class="o">&gt;</span> <span class="mf">0.</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">toppops</span><span class="p">[</span><span class="n">nonzero</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">toplvl</span><span class="p">:</span>
                <span class="c1"># for some low temperature, populations can not be calculated</span>
                <span class="n">good</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[:,</span> <span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">pub</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">eDensity</span><span class="p">[</span><span class="n">good</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">good</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">eDensity</span><span class="p">[</span><span class="n">good</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">good</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">skip</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="k">if</span> <span class="n">good</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">ndens</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span><span class="n">ndens</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">idens</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">ndens</span><span class="p">,</span><span class="n">ndens</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">eDensity</span><span class="p">[</span><span class="n">idens</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">idens</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">lvl</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newdens</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">one</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eDensity</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">good</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">newdens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdens</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ndens</span> <span class="o">-</span> <span class="n">good</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">idens</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">ndens</span><span class="p">,</span><span class="n">ndens</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">eDensity</span><span class="p">[</span><span class="n">idens</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">idens</span><span class="p">,</span> <span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">lvl</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s1">&#39; -  T = </span><span class="si">%10.2e</span><span class="s1"> (K)&#39;</span> <span class="o">%</span> <span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="n">tstr</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">eDensity</span><span class="p">[</span><span class="n">eDensity</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">eDensity</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">yl</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">1.2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">toppops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">top</span><span class="p">,</span> <span class="n">ntemp</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ilvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
                <span class="n">toppops</span><span class="p">[</span><span class="n">ilvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[:,</span> <span class="n">toplvl</span><span class="p">[</span><span class="n">ilvl</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nonzero</span> <span class="o">=</span> <span class="n">toppops</span> <span class="o">&gt;</span> <span class="mf">0.</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">toppops</span><span class="p">[</span><span class="n">nonzero</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">toplvl</span><span class="p">:</span>
                <span class="c1"># for some low temperature, populations can not be calculated</span>
                <span class="n">good</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[:,</span> <span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">pub</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">good</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">good</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">good</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">good</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">skip</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="k">if</span> <span class="n">good</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="n">ntemp</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span><span class="n">ntemp</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">itemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">ntemp</span><span class="p">,</span><span class="n">ntemp</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">itemp</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">itemp</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">lvl</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newtemp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">one</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">good</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">newtemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">lvl</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">newtemp</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ntemp</span> <span class="o">-</span> <span class="n">good</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">itemp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">ntemp</span><span class="p">,</span><span class="n">ntemp</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">itemp</span><span class="p">],</span><span class="n">pop</span><span class="p">[</span><span class="n">itemp</span><span class="p">,</span><span class="n">lvl</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">lvl</span><span class="p">))</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Temperature (K)&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">temperature</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">temperature</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ymin</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>  <span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Electron Density (cm$^{-3}$)&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">eDensity</span><span class="p">,</span><span class="n">pop</span><span class="p">[:,</span><span class="n">toplvl</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;toplvl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">toplvl</span></div>

<div class="viewcode-block" id="ion.emiss"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.emiss">[docs]</a>    <span class="k">def</span> <span class="nf">emiss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allLines</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the emissivities for lines of the specified ion.</span>

<span class="sd">        units:  ergs s^-1 str^-1</span>

<span class="sd">        Does not include elemental abundance or ionization fraction</span>

<span class="sd">        Wavelengths are sorted</span>

<span class="sd">        set allLines = True to include unidentified lines</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">):</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span>

        <span class="n">wvl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;wvl&quot;</span><span class="p">],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wvl</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">allLines</span><span class="p">:</span>
            <span class="n">wvl</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wvl</span><span class="p">)</span>
        <span class="n">l1</span>  <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">],</span> <span class="s1">&#39;int64&#39;</span><span class="p">)</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;lvl2&quot;</span><span class="p">],</span> <span class="s1">&#39;int64&#39;</span><span class="p">)</span>
        <span class="n">avalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s2">&quot;avalue&quot;</span><span class="p">],</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;pretty1&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">pretty1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;pretty1&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;pretty2&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">pretty2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Wgfa</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">])</span>

        <span class="c1"># make sure there are lines in the wavelength range, if specified</span>

        <span class="c1"># two-photon decays have wvl=0 and nonzero avalues</span>
        <span class="n">nonzed</span> <span class="o">=</span> <span class="n">wvl</span> <span class="o">!=</span> <span class="mf">0.</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="p">[</span><span class="n">nonzed</span><span class="p">]</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">l1</span><span class="p">[</span><span class="n">nonzed</span><span class="p">]</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="n">l2</span><span class="p">[</span><span class="n">nonzed</span><span class="p">]</span>
        <span class="n">avalue</span> <span class="o">=</span> <span class="n">avalue</span><span class="p">[</span><span class="n">nonzed</span><span class="p">]</span>
        <span class="n">pretty1</span> <span class="o">=</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">nonzed</span><span class="p">]</span>
        <span class="n">pretty2</span> <span class="o">=</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">nonzed</span><span class="p">]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">nonzed</span><span class="p">]</span>
        <span class="n">nwvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wvl</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ntempden</span><span class="p">,</span><span class="n">nlvls</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nwvl</span><span class="p">,</span> <span class="n">ntempden</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ntempden</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nwvl</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
        <span class="n">plotLabels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;angstrom&#39;</span><span class="p">:</span>
            <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;xLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Angstroms&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;nm&#39;</span><span class="p">:</span>
            <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;xLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;nanometers&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;kev&#39;</span><span class="p">:</span>
            <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;xLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;kev&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1.e-8</span><span class="o">*</span><span class="n">wvl</span><span class="p">)</span>
            <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;yLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ergs cm^-3 s^-1&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;photon&#39;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nwvl</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;yLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;photons cm^-3 s^-1&quot;</span>

        <span class="k">if</span> <span class="n">ntempden</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">itempden</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntempden</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">iwvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwvl</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="n">itempden</span><span class="p">,</span><span class="n">l2</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">em</span><span class="p">[</span><span class="n">iwvl</span><span class="p">,</span> <span class="n">itempden</span><span class="p">]</span> <span class="o">=</span> <span class="n">factor</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">avalue</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;kev&#39;</span><span class="p">:</span>
                <span class="n">wvl</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ev2Ang</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wvl</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;nm&#39;</span><span class="p">:</span>
                <span class="n">wvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">/</span><span class="mf">10.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iwvl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nwvl</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="n">l2</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">em</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">factor</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">avalue</span><span class="p">[</span><span class="n">iwvl</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;kev&#39;</span><span class="p">:</span>
                <span class="n">wvl</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">ev2Ang</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wvl</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;nm&#39;</span><span class="p">:</span>
                <span class="n">wvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">/</span><span class="mf">10.</span>
        <span class="n">nlvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
        <span class="n">ionS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">]</span><span class="o">*</span><span class="n">nlvl</span><span class="p">)</span>
        <span class="n">Emiss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ionS&#39;</span><span class="p">:</span><span class="n">ionS</span><span class="p">,</span><span class="s2">&quot;wvl&quot;</span><span class="p">:</span><span class="n">wvl</span><span class="p">,</span> <span class="s2">&quot;emiss&quot;</span><span class="p">:</span><span class="n">em</span><span class="p">,</span> <span class="s2">&quot;plotLabels&quot;</span><span class="p">:</span><span class="n">plotLabels</span><span class="p">,</span> <span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">l1</span><span class="p">,</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">l2</span><span class="p">,</span> <span class="s1">&#39;avalue&#39;</span><span class="p">:</span><span class="n">avalue</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">:</span><span class="n">obs</span><span class="p">,</span> <span class="s1">&#39;pretty1&#39;</span><span class="p">:</span><span class="n">pretty1</span><span class="p">,</span> <span class="s1">&#39;pretty2&#39;</span><span class="p">:</span><span class="n">pretty2</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span> <span class="o">=</span> <span class="n">Emiss</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="ion.emissList"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.emissList">[docs]</a>    <span class="k">def</span> <span class="nf">emissList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">wvlRange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wvlRanges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>   <span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">outFile</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the emissivities.</span>

<span class="sd">        wvlRange, a 2 element tuple, list or array determines the wavelength range</span>

<span class="sd">        Top specifies to plot only the top strongest lines, default = 10</span>

<span class="sd">        normalize = 1 specifies whether to normalize to strongest line, default = 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Emiss&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emiss</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; emissivities not calculated or emiss() is unable to calculate them&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; perhaps the temperature and/or eDensity are not set&#39;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="c1">#</span>
        <span class="n">emissivity</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">)</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;emiss&#39;</span><span class="p">]</span>
        <span class="n">ionS</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;ionS&#39;</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">]</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">]</span>
        <span class="n">lvl2</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">]</span>
        <span class="n">avalue</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span>
        <span class="n">pretty1</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;pretty1&#39;</span><span class="p">]</span>
        <span class="n">pretty2</span> <span class="o">=</span> <span class="n">emissivity</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">]</span>
<span class="c1">#        plotLabels = emissivity[&#39;plotLabels&#39;]</span>
        <span class="c1">#</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="c1">#</span>
        <span class="n">ndens</span> <span class="o">=</span> <span class="n">eDensity</span><span class="o">.</span><span class="n">size</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39; -  Density = </span><span class="si">%10.2e</span><span class="s1"> (cm$^{-3}$)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">eDensity</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s1">&#39; -  T = </span><span class="si">%10.2e</span><span class="s1"> (K)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ntemp</span><span class="o">//</span><span class="mi">2</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature =  </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature  =   </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ntemp</span><span class="o">//</span><span class="mi">2</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using index =</span><span class="si">%5i</span><span class="s1"> specifying eDensity = </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying eDensity = </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ntemp</span><span class="o">//-</span><span class="mi">1232</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature = </span><span class="si">%10.2e</span><span class="s1">, eDensity =  </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature = </span><span class="si">%10.2e</span><span class="s1">, eDensity =  </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">wvlRange</span><span class="p">:</span>
            <span class="n">wvlIndex</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span><span class="n">wvlRange</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">wvlRanges</span><span class="p">:</span>
            <span class="n">wvlIndex</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">awvlRange</span> <span class="ow">in</span> <span class="n">wvlRanges</span><span class="p">:</span>
                <span class="n">wvlIndex</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span><span class="n">awvlRange</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wvlIndex</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wvl</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># get those in the right wavelength range</span>
        <span class="c1">#</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">ionS</span> <span class="o">=</span> <span class="n">ionS</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">lvl2</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">avalue</span> <span class="o">=</span> <span class="n">avalue</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">pretty1</span> <span class="o">=</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">pretty2</span> <span class="o">=</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No lines in this wavelength interval&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Error</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;No lines in this wavelength interval&#39;</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="k">elif</span> <span class="n">top</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span>
        <span class="k">elif</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span>
        <span class="c1">#</span>
        <span class="c1"># now sort by intensity/emissivity</span>
        <span class="n">isrt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">emiss</span><span class="p">)</span>
        <span class="n">ionS</span> <span class="o">=</span> <span class="n">ionS</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">lvl2</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">avalue</span> <span class="o">=</span> <span class="n">avalue</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">pretty1</span> <span class="o">=</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="n">pretty2</span> <span class="o">=</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="c1">#</span>
    <span class="c1"># must follow setting top</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="o">/</span><span class="n">emiss</span><span class="p">[:</span><span class="n">top</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">wvl</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5s</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%25s</span><span class="s1"> - </span><span class="si">%25s</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3e</span><span class="s1"> </span><span class="si">%12.2e</span><span class="s1"> </span><span class="si">%1s</span><span class="s1">&#39;</span>
        <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;  &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;------------------------------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Ion   lvl1  lvl2         lower                     upper                   Wvl(A)   Emissivity      A value Obs&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kdx</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">%</span><span class="p">(</span><span class="n">ionS</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">wvl</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">emiss</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">avalue</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">obs</span><span class="p">[</span><span class="n">kdx</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; ------------------------------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">[</span><span class="s1">&#39;wvlTop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wvl</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">[</span><span class="s1">&#39;emissTop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">outFile</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5s</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%25s</span><span class="s1"> - </span><span class="si">%25s</span><span class="s1"> </span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%12.3e</span><span class="s1"> </span><span class="si">%12.2e</span><span class="s1"> </span><span class="si">%1s</span><span class="s1">&#39;</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; ------------------------------------------ </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; Ion   lvl1  lvl2         lower                     upper                   Wvl(A)   Emissivity      A value Obs  </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">kdx</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="o">%</span><span class="p">(</span><span class="n">ionS</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">wvl</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">emiss</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">avalue</span><span class="p">[</span><span class="n">kdx</span><span class="p">],</span> <span class="n">obs</span><span class="p">[</span><span class="n">kdx</span><span class="p">]))</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; ------------------------------------------  </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   </span><span class="se">\n</span><span class="s1"> &#39;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
        <span class="c1">#</span>
        <span class="c1"># ---------------------------------------------------------------------------</span>
        <span class="c1">#</span>
<div class="viewcode-block" id="ion.emissPlot"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.emissPlot">[docs]</a>    <span class="k">def</span> <span class="nf">emissPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>  <span class="n">wvlRange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">linLog</span><span class="o">=</span><span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">plotFile</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">saveFile</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot the emissivities.</span>

<span class="sd">        wvlRange, a 2 element tuple, list or array determines the wavelength range</span>

<span class="sd">        Top specifies to plot only the top strongest lines, default = 10</span>

<span class="sd">        linLog specifies a linear or log plot, want either lin or log, default = lin</span>

<span class="sd">        normalize = 1 specifies whether to normalize to strongest line, default = 0&#39;&#39;&#39;</span>
        <span class="c1">#</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Spectroscopic</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Emiss&#39;</span><span class="p">):</span>
            <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emiss</span><span class="p">()</span>
                <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; emissivities not calculated and emiss() is unable to calculate them&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; perhaps the temperature and/or eDensity are not set&#39;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;emiss&#39;</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">]</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="c1">#</span>
        <span class="n">ndens</span> <span class="o">=</span> <span class="n">eDensity</span><span class="o">.</span><span class="n">size</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39; -  Density = </span><span class="si">%10.2e</span><span class="s1"> (cm$^{-3}$)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">eDensity</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s1">&#39; -  T = </span><span class="si">%10.2e</span><span class="s1"> (K)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ntemp</span><span class="o">/</span><span class="mi">2</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature =  </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature = </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39; -  Density = </span><span class="si">%10.2e</span><span class="s1"> (cm$^{-3}$)&#39;</span> <span class="o">%</span> <span class="n">eDensity</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s1">&#39; -  T = </span><span class="si">%10.2e</span><span class="s1"> (K)&#39;</span> <span class="o">%</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ntemp</span><span class="o">/</span><span class="mi">2</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using index =</span><span class="si">%5i</span><span class="s1"> specifying eDensity = </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;using index =</span><span class="si">%5i</span><span class="s1"> specifying eDensity = </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39; -  Density = </span><span class="si">%10.2e</span><span class="s1"> (cm$^{-3}$)&#39;</span> <span class="o">%</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s1">&#39; -  T = </span><span class="si">%10.2e</span><span class="s1"> (K)&#39;</span> <span class="o">%</span> <span class="n">temperature</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ntemp</span><span class="o">/</span><span class="mi">2</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature = </span><span class="si">%10.2e</span><span class="s1">, eDensity =  </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;using index = </span><span class="si">%5i</span><span class="s1"> specifying temperature = </span><span class="si">%10.2e</span><span class="s1">, eDensity =  </span><span class="si">%10.2e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span>
            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39; -  Density  =  </span><span class="si">%10.2e</span><span class="s1"> (cm$^{-3}$)&#39;</span> <span class="o">%</span> <span class="n">eDensity</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">tstr</span><span class="o">=</span><span class="s1">&#39; -  T = </span><span class="si">%10.2e</span><span class="s1"> (K)&#39;</span> <span class="o">%</span> <span class="n">temperature</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wvlRange</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">wvlIndex</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span> <span class="n">wvlRange</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wvlIndex</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">wvl</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="p">[</span><span class="n">wvlIndex</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No lines in this wavelength interval&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Error</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="s1">&#39;No lines in this wavelength interval&#39;</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">top</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span>
        <span class="k">elif</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">top</span><span class="p">:</span>
            <span class="n">isrt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">emiss</span><span class="p">)</span>
            <span class="n">wvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">isrt</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span>
        <span class="c1"># must follow setting top</span>
        <span class="c1">#</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Emissivity&#39;</span>
        <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">emiss</span><span class="o">/</span><span class="n">emiss</span><span class="p">[:</span><span class="n">top</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (Relative)&#39;</span>
        <span class="c1">#</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Wavelength (&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span>
        <span class="c1">#</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">emiss</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span> <span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="n">wvl</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">wvl</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">linLog</span> <span class="o">==</span> <span class="s1">&#39;lin&#39;</span><span class="p">:</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">emiss</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span><span class="o">/</span><span class="mf">10.</span><span class="p">,</span> <span class="n">emiss</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="n">tstr</span><span class="o">+</span><span class="n">dstr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wvlRange</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">wvlRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wvlRange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">emiss</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
        <span class="k">if</span> <span class="n">plotFile</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotFile</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">wvl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">[</span><span class="s1">&#39;wvlTop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wvl</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">[</span><span class="s1">&#39;emissTop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>
        <span class="c1">#</span>
        <span class="c1"># -------------------------------------------------------------------------------------</span>
        <span class="c1">#</span>
<div class="viewcode-block" id="ion.emissRatio"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.emissRatio">[docs]</a>    <span class="k">def</span> <span class="nf">emissRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wvlRange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wvlRanges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the ratio of 2 lines or sums of lines.</span>
<span class="sd">        Shown as a function of density and/or temperature.</span>
<span class="sd">        For a single wavelength range, set wvlRange = [wMin, wMax]</span>
<span class="sd">        For multiple wavelength ranges, set wvlRanges = [[wMin1,wMax1],[wMin2,wMax2], ...]</span>
<span class="sd">        A plot of relative emissivities is shown and then a dialog appears for the user to</span>
<span class="sd">        choose a set of lines.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Emiss&#39;</span><span class="p">):</span>
            <span class="n">doEmiss</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doEmiss</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">doEmiss</span><span class="p">:</span>
            <span class="c1"># new values of temperature or eDensity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emiss</span><span class="p">()</span>
            <span class="n">em</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span>
        <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;emiss&#39;</span><span class="p">]</span>
        <span class="n">ionS</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;ionS&#39;</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;wvl&quot;</span><span class="p">]</span>
        <span class="n">lineLabel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iline</span><span class="p">,</span>  <span class="n">ions</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ionS</span><span class="p">):</span>
            <span class="n">lineLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ions</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">iline</span><span class="p">]))</span>
        <span class="n">plotLabels</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;plotLabels&quot;</span><span class="p">]</span>
        <span class="n">xLabel</span> <span class="o">=</span> <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;xLabel&quot;</span><span class="p">]</span>
        <span class="n">yLabel</span> <span class="o">=</span> <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;yLabel&quot;</span><span class="p">]</span>
        <span class="c1"># find which lines are in the wavelength range if it is set</span>
        <span class="k">if</span> <span class="n">wvlRange</span><span class="p">:</span>
            <span class="n">igvl</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span><span class="n">wvlRange</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">wvlRanges</span><span class="p">:</span>
            <span class="n">igvl</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">awvlRange</span> <span class="ow">in</span> <span class="n">wvlRanges</span><span class="p">:</span>
                <span class="n">igvl</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span><span class="n">awvlRange</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">igvl</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wvl</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="n">nlines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">igvl</span><span class="p">)</span>
        <span class="n">igvl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">igvl</span><span class="p">,</span><span class="n">wvl</span><span class="p">[</span><span class="n">igvl</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">())</span>
        <span class="c1"># find the top most intense lines</span>
        <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">nlines</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">nlines</span>
            <span class="c1">#</span>
        <span class="n">maxEmiss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlines</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; maxEmiss.shape = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">maxEmiss</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">):</span>
            <span class="n">maxEmiss</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">igvl</span><span class="p">[</span><span class="n">iline</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">maxEmiss</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">==</span> <span class="n">maxEmiss</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
                <span class="n">maxAll</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">igvl</span><span class="p">[</span><span class="n">iline</span><span class="p">]]</span>
        <span class="n">igvlsort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">igvl</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">maxEmiss</span><span class="p">))</span>
        <span class="n">topLines</span> <span class="o">=</span> <span class="n">igvlsort</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]</span>
        <span class="n">maxWvl</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">wvl</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">topLines</span> <span class="o">=</span> <span class="n">topLines</span><span class="p">[</span><span class="n">wvl</span><span class="p">[</span><span class="n">topLines</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>

        <span class="c1"># need to make sure there are no negative values before plotting</span>
        <span class="n">good</span>  <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">emiss</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">emissMin</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">good</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">emiss</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">emiss</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">emissMin</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="n">ndens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Emissivity relative to &#39;</span><span class="o">+</span><span class="n">maxWvl</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Spectroscopic</span>

        <span class="k">if</span> <span class="n">ndens</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; only a single temperature and eDensity&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Temperature (K)&#39;</span>
            <span class="n">xvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="n">outTemperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="n">outDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ntemp</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
            <span class="n">outDensity</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">)</span>
            <span class="n">desc_str</span> <span class="o">=</span> <span class="s1">&#39; at  Density = </span><span class="si">%10.2e</span><span class="s1"> (cm)$^{-3}$&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="k">elif</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="n">outTemperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ndens</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
            <span class="n">outTemperature</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)</span>
            <span class="n">outDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\rm{Electron Density (cm)^{-3}}$&#39;</span>
            <span class="n">desc_str</span> <span class="o">=</span> <span class="s1">&#39; at Temp = </span><span class="si">%10.2e</span><span class="s1"> (K)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outTemperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="n">outDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Temperature (K)&#39;</span>
            <span class="n">xvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="n">desc_str</span> <span class="o">=</span> <span class="s1">&#39; for variable Density&#39;</span>

        <span class="c1"># put all actual plotting here</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="c1">#  maxAll is an array</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">emiss</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymax</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">nxvalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvalues</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
            <span class="n">tline</span> <span class="o">=</span> <span class="n">topLines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">iline</span><span class="p">,</span><span class="n">nxvalues</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ixvalue</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">nxvalues</span><span class="p">,</span><span class="n">nxvalues</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xvalues</span><span class="p">[</span><span class="n">ixvalue</span><span class="p">],</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">,</span><span class="n">ixvalue</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">[</span><span class="n">ixvalue</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">tline</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xvalues</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">xvalues</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="n">ntemp</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>  <span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
            <span class="n">xlabelDen</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Electron Density (cm$^{-3}$)&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabelDen</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">eDensity</span><span class="p">,</span><span class="n">emiss</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="n">top</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">/</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">ymax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">/</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">ymax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="n">desc_str</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="c1">#  need time to let matplotlib finish plotting</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># get line selection  ************************************************************</span>
        <span class="c1">#</span>
        <span class="n">selectTags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">itop</span> <span class="ow">in</span> <span class="n">topLines</span><span class="p">:</span>
            <span class="n">selectTags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ionS</span><span class="p">[</span><span class="n">itop</span><span class="p">]</span><span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">itop</span><span class="p">]))</span>
        <span class="c1">#</span>
        <span class="n">numden</span> <span class="o">=</span> <span class="n">chGui</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">choice2Dialog</span><span class="p">(</span><span class="n">selectTags</span><span class="p">)</span>
<span class="c1">#        numden = gui.choice2Dialog(wvl[topLines])</span>
        <span class="c1">#</span>
        <span class="c1"># num_idx and den_idx are tuples</span>
        <span class="c1">#</span>
        <span class="n">num_idx</span> <span class="o">=</span> <span class="n">numden</span><span class="o">.</span><span class="n">numIndex</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; no numerator lines were selected&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="n">den_idx</span> <span class="o">=</span> <span class="n">numden</span><span class="o">.</span><span class="n">denIndex</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">den_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; no denominator lines were selected&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="n">numEmiss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xvalues</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">num_idx</span><span class="p">:</span>
            <span class="n">numEmiss</span> <span class="o">+=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="n">aline</span><span class="p">]]</span>
        <span class="c1">#</span>
        <span class="n">denEmiss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xvalues</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">den_idx</span><span class="p">:</span>
            <span class="n">denEmiss</span> <span class="o">+=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="n">aline</span><span class="p">]]</span>
        <span class="c1">#</span>
        <span class="c1"># plot the desired ratio</span>
        <span class="c1">#  maxAll is an array</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">numEmiss</span><span class="o">/</span><span class="n">denEmiss</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xvalues</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">xvalues</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Emissivity Ratio (&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">num_idx</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">selectTags</span><span class="p">[</span><span class="n">aline</span><span class="p">]</span>
<span class="c1">#            desc += &#39; &#39; + str(wvl[topLines[aline]])</span>
        <span class="n">desc</span> <span class="o">+=</span> <span class="s1">&#39; / &#39;</span>
        <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">den_idx</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">selectTags</span><span class="p">[</span><span class="n">aline</span><span class="p">]</span>
<span class="c1">#            desc += &#39; &#39; + str(wvl[topLines[aline]])</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="n">ntemp</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">desc</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>  <span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
            <span class="n">xlabelDen</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Electron Density (cm$^{-3}$)&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabelDen</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">eDensity</span><span class="p">,</span><span class="n">numEmiss</span><span class="o">/</span><span class="n">denEmiss</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
<span class="c1">#            plt.ylim(ymin, ymax)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">intensityRatioFileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span>
        <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">num_idx</span><span class="p">:</span>
            <span class="n">intensityRatioFileName</span> <span class="o">+=</span> <span class="s1">&#39;_</span><span class="si">%3i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="n">aline</span><span class="p">]])</span>
        <span class="n">intensityRatioFileName</span> <span class="o">+=</span><span class="s1">&#39;_2&#39;</span>
        <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">den_idx</span><span class="p">:</span>
            <span class="n">intensityRatioFileName</span> <span class="o">+=</span> <span class="s1">&#39;_</span><span class="si">%3i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="n">aline</span><span class="p">]])</span>
        <span class="n">intensityRatioFileName</span> <span class="o">+=</span> <span class="s1">&#39;.rat&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatio</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ratio&#39;</span><span class="p">:</span><span class="n">numEmiss</span><span class="o">/</span><span class="n">denEmiss</span><span class="p">,</span><span class="s1">&#39;desc&#39;</span><span class="p">:</span><span class="n">desc</span><span class="p">,</span>
                <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">outTemperature</span><span class="p">,</span><span class="s1">&#39;eDensity&#39;</span><span class="p">:</span><span class="n">outDensity</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">intensityRatioFileName</span><span class="p">,</span> <span class="s1">&#39;numIdx&#39;</span><span class="p">:</span><span class="n">num_idx</span><span class="p">,</span> <span class="s1">&#39;denIdx&#39;</span><span class="p">:</span><span class="n">den_idx</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.intensity"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.intensity">[docs]</a>    <span class="k">def</span> <span class="nf">intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allLines</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate  the intensities for lines of the specified ion.</span>

<span class="sd">        units:  ergs cm^-3 s^-1 str^-1</span>

<span class="sd">        includes elemental abundance and ionization fraction.</span>

<span class="sd">        the emission measure &#39;em&#39; is included if specified</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># so we know that it has been applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Emiss&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emiss</span><span class="p">(</span><span class="n">allLines</span><span class="o">=</span><span class="n">allLines</span><span class="p">)</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">emiss</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;errorMessage&#39;</span>  <span class="ow">in</span> <span class="n">emiss</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]}</span>
            <span class="k">return</span>

        <span class="c1"># everything in emiss should be a numpy array</span>
        <span class="n">emissivity</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;emiss&#39;</span><span class="p">]</span>
        <span class="n">ionS</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;ionS&#39;</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">]</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">]</span>
        <span class="n">lvl2</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span>
        <span class="n">pretty1</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;pretty1&#39;</span><span class="p">]</span>
        <span class="n">pretty2</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">]</span>
        <span class="n">avalue</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">]</span>
        <span class="n">errorMessage</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abundance&#39;</span><span class="p">):</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">abundanceRead</span><span class="p">()</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">emissivity</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nwvl</span><span class="p">,</span> <span class="n">ntempden</span> <span class="o">=</span>  <span class="n">emissivity</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntempden</span><span class="p">,</span> <span class="n">nwvl</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
            <span class="n">good</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span> <span class="o">&gt;</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="n">good</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntempden</span><span class="p">,</span> <span class="n">nwvl</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
                <span class="n">errorMessage</span> <span class="o">=</span> <span class="s1">&#39;ioneq = zero in temperature range&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;intensity&#39;</span><span class="p">:</span><span class="n">intensity</span><span class="p">,</span> <span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span><span class="n">errorMessage</span><span class="p">}</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntempden</span><span class="p">):</span>
                    <span class="n">intensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="n">emissivity</span><span class="p">[:,</span> <span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
            <span class="n">nwvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">emissivity</span><span class="p">)</span>
            <span class="n">ntempden</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="o">*</span><span class="n">emissivity</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="k">if</span> <span class="n">ntempden</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">integrated</span> <span class="o">=</span> <span class="n">intensity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">integrated</span> <span class="o">=</span> <span class="n">intensity</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">Intensity</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;intensity&#39;</span><span class="p">:</span><span class="n">intensity</span><span class="p">,</span> <span class="s1">&#39;integrated&#39;</span><span class="p">:</span><span class="n">integrated</span><span class="p">,</span><span class="s1">&#39;ionS&#39;</span><span class="p">:</span><span class="n">ionS</span><span class="p">,</span> <span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">,</span> <span class="s1">&#39;lvl1&#39;</span><span class="p">:</span><span class="n">lvl1</span><span class="p">,</span> <span class="s1">&#39;lvl2&#39;</span><span class="p">:</span><span class="n">lvl2</span><span class="p">,</span> <span class="s1">&#39;pretty1&#39;</span><span class="p">:</span><span class="n">pretty1</span><span class="p">,</span> <span class="s1">&#39;pretty2&#39;</span><span class="p">:</span><span class="n">pretty2</span><span class="p">,</span>  <span class="s1">&#39;obs&#39;</span><span class="p">:</span><span class="n">obs</span><span class="p">,</span> <span class="s1">&#39;avalue&#39;</span><span class="p">:</span><span class="n">avalue</span><span class="p">,</span> <span class="s1">&#39;em&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">errorMessage</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Intensity</span><span class="p">[</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errorMessage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span> <span class="o">=</span> <span class="n">Intensity</span></div>

<div class="viewcode-block" id="ion.boundBoundLoss"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.boundBoundLoss">[docs]</a>    <span class="k">def</span> <span class="nf">boundBoundLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allLines</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate  the summed radiative loss rate for all spectral lines of the specified ion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        allLines : `bool`</span>
<span class="sd">            If True, include losses from both observed and unobserved lines.</span>
<span class="sd">            If False, only include losses from observed lines.</span>

<span class="sd">        includes elemental abundance and ionization fraction.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        creates the attribute:</span>

<span class="sd">        BoundBoundLoss : `dict` with the keys below.</span>

<span class="sd">            *rate* : the radiative loss rate (:math:`\mathrm{erg \, cm^{-3}} \, \mathrm{s}^{-1}`) per unit emission measure.</span>

<span class="sd">            *temperature* : (K).</span>

<span class="sd">            *eDensity* : electron density (:math:`\mathrm{cm^{-3}}`)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">emiss</span><span class="p">(</span><span class="n">allLines</span><span class="o">=</span><span class="n">allLines</span><span class="p">)</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span>
        <span class="k">if</span> <span class="s1">&#39;errorMessage&#39;</span>  <span class="ow">in</span> <span class="n">emiss</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Intensity</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;errorMessage&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Spectroscopic</span><span class="o">+</span><span class="s1">&#39; no lines in this wavelength region&#39;</span><span class="p">}</span>
            <span class="k">return</span>
        <span class="n">em</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;emiss&#39;</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="s1">&#39;wvl&#39;</span><span class="p">]</span>
        <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abundance&#39;</span><span class="p">):</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">abundanceRead</span><span class="p">()</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;IoneqOne&#39;</span><span class="p">):</span>
            <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ioneqOne</span><span class="p">()</span>
            <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
        <span class="c1"># should probably replace this with an if statement based on len of em.shape</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nwvl</span><span class="p">,</span> <span class="n">ntempden</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntempden</span><span class="p">,</span> <span class="n">nwvl</span><span class="p">),</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">thisIoneq</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">thisIoneq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ntempden</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">thisIoneq</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntempden</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                    <span class="n">intensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="mf">1.e+8</span><span class="o">/</span><span class="n">wvl</span><span class="p">)</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="n">em</span><span class="p">[:,</span> <span class="n">it</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">intensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="n">em</span><span class="p">[:,</span> <span class="n">it</span><span class="p">]</span><span class="o">/</span><span class="n">eDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">intensity</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">nwvl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
            <span class="n">ntempden</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="mf">1.e+8</span><span class="o">/</span><span class="n">wvl</span><span class="p">)</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="o">*</span><span class="n">em</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="o">*</span><span class="n">em</span><span class="o">/</span><span class="n">eDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">intensity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BoundBoundLoss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">loss</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="s1">&#39;eDensity&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.intensityRatioInterpolate"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.intensityRatioInterpolate">[docs]</a>    <span class="k">def</span> <span class="nf">intensityRatioInterpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        to take a set of date and interpolate against the IntensityRatio</span>
<span class="sd">        the scale can be one of &#39;lin&#39;/&#39;linear&#39; [default], &#39;loglog&#39;, &#39;logx&#39;, &#39;logy&#39;,</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># first, what variable to use</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatio</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatio</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatio</span><span class="p">[</span><span class="s1">&#39;ratio&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatio</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using temperature with </span><span class="si">%i</span><span class="s1">5 values&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; number of values&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatio</span><span class="p">[</span><span class="s1">&#39;ratio&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatio</span><span class="p">[</span><span class="s1">&#39;eDensity&#39;</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">sy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">y</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="s1">&#39;lin&#39;</span> <span class="ow">in</span> <span class="n">scale</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">interpolatedData</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interpolatedData</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;bD&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;loglog&#39;</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sy</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">interpolatedData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">y2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interpolatedData</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;bD&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;logx&#39;</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sy</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">interpolatedData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">y2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">interpolatedData</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;bD&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;logy&#39;</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">sy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">interpolatedData</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">y2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">interpolatedData</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;bD&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; scale not understood = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">avalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interpolatedData</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; data, value = </span><span class="si">%12.3e</span><span class="s1"> </span><span class="si">%12.3e</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">avalue</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IntensityRatioInterpolated</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">interpolatedData</span><span class="p">}</span></div>


<div class="viewcode-block" id="ion.gofnt"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.gofnt">[docs]</a>    <span class="k">def</span> <span class="nf">gofnt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wvlRange</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the &#39;so-called&#39; G(T) function.</span>

<span class="sd">        Given as a function of both temperature and eDensity.</span>

<span class="sd">        Only the top( set by &#39;top&#39;) brightest lines are plotted.</span>
<span class="sd">        the G(T) function is returned in a dictionary self.Gofnt</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Emiss&#39;</span><span class="p">):</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emiss</span><span class="p">()</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emiss</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abundance&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">abundanceRead</span><span class="p">()</span>

        <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">emiss</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;emiss&quot;</span><span class="p">]</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;wvl&quot;</span><span class="p">]</span>
        <span class="n">pretty1</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;pretty1&#39;</span><span class="p">]</span>
        <span class="n">pretty2</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;pretty2&#39;</span><span class="p">]</span>
        <span class="n">lvl1</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;lvl1&#39;</span><span class="p">]</span>
        <span class="n">lvl2</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s1">&#39;lvl2&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plotLabels</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;plotLabels&quot;</span><span class="p">]</span>
            <span class="n">xLabel</span> <span class="o">=</span> <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;xLabel&quot;</span><span class="p">]</span>
            <span class="n">yLabel</span> <span class="o">=</span> <span class="n">plotLabels</span><span class="p">[</span><span class="s2">&quot;yLabel&quot;</span><span class="p">]</span>

        <span class="c1"># find which lines are in the wavelength range if it is set</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wvlRange</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">igvl</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span><span class="n">wvlRange</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">igvl</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wvl</span><span class="p">))</span>
        <span class="n">nlines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">igvl</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nlines</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; no lines in selected interval&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># find the top most intense lines</span>
        <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">nlines</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">nlines</span>
        <span class="n">maxEmiss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nlines</span><span class="p">,</span><span class="s1">&#39;Float64&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">):</span>
            <span class="n">maxEmiss</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">igvl</span><span class="p">[</span><span class="n">iline</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">maxEmiss</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">maxEmiss</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
                <span class="n">maxAll</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">igvl</span><span class="p">[</span><span class="n">iline</span><span class="p">]]</span>

        <span class="n">igvlsort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">igvl</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">maxEmiss</span><span class="p">))</span>
        <span class="n">topLines</span> <span class="o">=</span> <span class="n">igvlsort</span><span class="p">[</span><span class="o">-</span><span class="n">top</span><span class="p">:]</span>
        <span class="n">maxWvl</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%5.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">wvl</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># need to make sure there are no negative values before plotting</span>
        <span class="n">good</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">emiss</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">emissMin</span> <span class="o">=</span> <span class="n">emiss</span><span class="p">[</span><span class="n">good</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">emiss</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">emiss</span><span class="p">[</span><span class="n">bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">emissMin</span>
        <span class="n">topLines</span> <span class="o">=</span> <span class="n">topLines</span><span class="p">[</span><span class="n">wvl</span><span class="p">[</span><span class="n">topLines</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
        <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
        <span class="n">ntemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">temperature</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ntemp</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">ndens</span> <span class="o">=</span> <span class="n">eDensity</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">ndens</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eDensity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">eDensity</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ndens</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; ndens = </span><span class="si">%5i</span><span class="s1"> ntemp = </span><span class="si">%5i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ndens</span><span class="p">,</span> <span class="n">ntemp</span><span class="p">))</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Emissivity relative to &#39;</span><span class="o">+</span><span class="n">maxWvl</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Spectroscopic</span>

        <span class="k">if</span> <span class="n">ndens</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">ntemp</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; only a single temperature and eDensity&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">ndens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Temperature (K)&#39;</span>
            <span class="n">ngofnt</span> <span class="o">=</span> <span class="n">temperature</span><span class="o">.</span><span class="n">size</span>
            <span class="n">xvalues</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="n">outTemperature</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="n">outDensity</span> <span class="o">=</span> <span class="n">eDensity</span>
            <span class="n">desc_str</span><span class="o">=</span><span class="s1">&#39; at Density = </span><span class="si">%10.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">eDensity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">ntemp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xvalues</span> <span class="o">=</span> <span class="n">eDensity</span>
            <span class="n">ngofnt</span> <span class="o">=</span> <span class="n">eDensity</span><span class="o">.</span><span class="n">size</span>
            <span class="n">outTemperature</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="n">outDensity</span> <span class="o">=</span> <span class="n">eDensity</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\rm{Electron Density (cm}^{-3}\rm{)}$&#39;</span>
            <span class="n">desc_str</span> <span class="o">=</span> <span class="s1">&#39; at Temperature = </span><span class="si">%10.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outTemperature</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="n">outDensity</span> <span class="o">=</span> <span class="n">eDensity</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Temperature (K)&#39;</span>
            <span class="n">xvalues</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="n">ngofnt</span> <span class="o">=</span> <span class="n">ntemp</span>
            <span class="n">desc_str</span> <span class="o">=</span> <span class="s1">&#39; for variable Density&#39;</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">nxvalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvalues</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="mf">1.2</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymax</span>
            <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
                <span class="n">tline</span> <span class="o">=</span> <span class="n">topLines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span>
                    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">)</span>
                <span class="n">skip</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">iline</span><span class="p">,</span><span class="n">nxvalues</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ixvalue</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">nxvalues</span><span class="p">,</span><span class="n">nxvalues</span><span class="o">//</span><span class="n">skip</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xvalues</span><span class="p">[</span><span class="n">ixvalue</span><span class="p">],</span><span class="n">emiss</span><span class="p">[</span><span class="n">tline</span><span class="p">,</span><span class="n">ixvalue</span><span class="p">]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">[</span><span class="n">ixvalue</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">tline</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xvalues</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">xvalues</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="n">ntemp</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>  <span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
                <span class="n">xlabelDen</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Electron Density (cm$^{-3}$)&#39;</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabelDen</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">eDensity</span><span class="p">,</span><span class="n">emiss</span><span class="p">[</span><span class="n">topLines</span><span class="p">[</span><span class="n">top</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">maxAll</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="n">desc_str</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">wvlChoices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
            <span class="n">tline</span> <span class="o">=</span> <span class="n">topLines</span><span class="p">[</span><span class="n">iline</span><span class="p">]</span>
            <span class="n">wvlChoices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%12.4f</span><span class="s1"> </span><span class="si">%4i</span><span class="s1"> </span><span class="si">%4i</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">tline</span><span class="p">],</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">tline</span><span class="p">],</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">tline</span><span class="p">],</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">tline</span><span class="p">],</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">tline</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">gline</span> <span class="o">=</span> <span class="n">chGui</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">selectorDialog</span><span class="p">(</span><span class="n">wvlChoices</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Select line(s)&#39;</span><span class="p">)</span>
            <span class="n">gline_idx</span> <span class="o">=</span> <span class="n">gline</span><span class="o">.</span><span class="n">selectedIndex</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gline_idx</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># insert the top line as the first line -TDW</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="n">gAbund</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;IoneqOne&#39;</span><span class="p">):</span>
            <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ioneqOne</span><span class="p">()</span>
            <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; abundance = </span><span class="si">%10.2e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">gAbund</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; index  temperature  ion fraction&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">it</span><span class="p">,</span>  <span class="n">anioneq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thisIoneq</span><span class="p">):</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39; </span><span class="si">%5i</span><span class="s1"> </span><span class="si">%10.2e</span><span class="s1"> </span><span class="si">%10.2e</span><span class="s1"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">outTemperature</span><span class="p">[</span><span class="n">it</span><span class="p">],</span> <span class="n">anioneq</span><span class="p">))</span>

        <span class="n">gIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span><span class="o">/</span><span class="n">eDensity</span>
        <span class="c1"># plot the desired ratio</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">g_line</span> <span class="o">=</span> <span class="n">topLines</span><span class="p">[</span><span class="n">gline_idx</span><span class="p">]</span><span class="c1">#  [0]</span>
        <span class="n">gofnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngofnt</span><span class="p">,</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">aline</span> <span class="ow">in</span> <span class="n">g_line</span><span class="p">:</span>
                <span class="n">gofnt</span> <span class="o">+=</span> <span class="n">gAbund</span><span class="o">*</span><span class="n">gIoneq</span><span class="o">*</span><span class="n">emiss</span><span class="p">[</span><span class="n">aline</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gofnt</span> <span class="o">+=</span> <span class="n">gAbund</span><span class="o">*</span><span class="n">gIoneq</span><span class="o">*</span><span class="n">emiss</span><span class="p">[</span><span class="n">g_line</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gofnt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="n">outTemperature</span><span class="p">,</span><span class="s1">&#39;eDensity&#39;</span><span class="p">:</span><span class="n">outDensity</span><span class="p">,</span><span class="s1">&#39;gofnt&#39;</span><span class="p">:</span><span class="n">gofnt</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="n">g_line</span><span class="p">,</span> <span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">[</span><span class="n">g_line</span><span class="p">]}</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">xvalues</span><span class="p">,</span><span class="n">gofnt</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xvalues</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">xvalues</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Gofnt&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">newTitle</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%9s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Spectroscopic</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%4i</span><span class="s1"> </span><span class="si">%4i</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">g_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">g_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">g_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">g_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">g_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">newTitle</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">igl</span> <span class="ow">in</span> <span class="n">g_line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">newTitle</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%12.3f</span><span class="s1"> </span><span class="si">%4i</span><span class="s1"> </span><span class="si">%4i</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wvl</span><span class="p">[</span><span class="n">igl</span><span class="p">],</span> <span class="n">lvl1</span><span class="p">[</span><span class="n">igl</span><span class="p">],</span> <span class="n">lvl2</span><span class="p">[</span><span class="n">igl</span><span class="p">],</span> <span class="n">pretty1</span><span class="p">[</span><span class="n">igl</span><span class="p">],</span> <span class="n">pretty2</span><span class="p">[</span><span class="n">igl</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">igl</span> <span class="o">!=</span> <span class="n">g_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">newTitle</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">newTitle</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                    <span class="n">xycoords</span> <span class="o">=</span> <span class="s1">&#39;axes points&#39;</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndens</span> <span class="o">==</span> <span class="n">ntemp</span> <span class="ow">and</span> <span class="n">ntemp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">newTitle</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>  <span class="n">transform</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabelDen</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">eDensity</span><span class="p">,</span><span class="n">gofnt</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">newTitle</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span></div>

<div class="viewcode-block" id="ion.twoPhotonEmiss"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.twoPhotonEmiss">[docs]</a>    <span class="k">def</span> <span class="nf">twoPhotonEmiss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wvl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To calculate the two-photon continuum rate coefficient - only for hydrogen- and helium-like ions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">nWvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Ion</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">:</span>
            <span class="c1"># this is not a hydrogen-like or helium-like ion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhoton</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;emiss&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nWvl</span><span class="p">,</span> <span class="s1">&#39;float4&#39;</span><span class="p">),</span> <span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">}</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">):</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
                <span class="n">nTempDens</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
                <span class="n">nTempDens</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">emiss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTempDens</span><span class="p">,</span> <span class="n">nWvl</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">eDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">,</span> <span class="n">nTempDens</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">emiss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nWvl</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="p">:</span>
                <span class="c1"># H seq</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">wvl0</span> <span class="o">=</span> <span class="mf">1.e+8</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">goodWvl</span> <span class="o">=</span> <span class="n">wvl</span> <span class="o">&gt;</span> <span class="n">wvl0</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">wvl0</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">twophotonHRead</span><span class="p">()</span>
                <span class="n">avalue</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">asum</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;asum&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">distr1</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;psi0&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">distr</span> <span class="o">=</span> <span class="n">avalue</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">splev</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">distr1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">asum</span><span class="o">*</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="mf">1.e+8</span><span class="p">)</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">emiss</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTempDens</span><span class="p">):</span>
                        <span class="n">emiss</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhotonEmiss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">,</span> <span class="s1">&#39;emiss&#39;</span><span class="p">:</span><span class="n">emiss</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># He seq</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="n">heseqLvl2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">wvl0</span> <span class="o">=</span> <span class="mf">1.e+8</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">goodWvl</span> <span class="o">=</span> <span class="n">wvl</span> <span class="o">&gt;</span> <span class="n">wvl0</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">wvl0</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">twophotonHeRead</span><span class="p">()</span>
                <span class="n">avalue</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">distr1</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;psi0&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">distr</span> <span class="o">=</span> <span class="n">avalue</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">splev</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">distr1</span><span class="p">)</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="mf">1.e+8</span><span class="p">)</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">emiss</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTempDens</span><span class="p">):</span>
                        <span class="n">emiss</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhotonEmiss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">,</span> <span class="s1">&#39;emiss&#39;</span><span class="p">:</span><span class="n">emiss</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.twoPhoton"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.twoPhoton">[docs]</a>    <span class="k">def</span> <span class="nf">twoPhoton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wvl</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        to calculate the two-photon continuum - only for hydrogen- and helium-like ions</span>
<span class="sd">        includes the elemental abundance and the ionization equilibrium</span>
<span class="sd">        includes the emission measure if specified</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">wvl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wvl</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="n">nWvl</span> <span class="o">=</span> <span class="n">wvl</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">:</span>
            <span class="c1"># this is not a hydrogen-like or helium-like ion</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; not doing 2 photon for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IonStr</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhoton</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;emiss&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nWvl</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">),</span> <span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">}</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abundance&#39;</span><span class="p">):</span>
                <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">abundanceRead</span><span class="p">()</span>
                <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;IoneqOne&#39;</span><span class="p">):</span>
                <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ioneqOne</span><span class="p">()</span>
                <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">):</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
                <span class="n">nTempDens</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
                <span class="n">nTempDens</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTempDens</span><span class="p">,</span> <span class="n">nWvl</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">eDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">,</span> <span class="n">nTempDens</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">nTempDens</span><span class="p">)</span>
                    <span class="n">thisIoneq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">thisIoneq</span><span class="p">,</span> <span class="n">nTempDens</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nWvl</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
                <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="p">:</span>
                <span class="c1"># H seq</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">wvl0</span> <span class="o">=</span> <span class="mf">1.e+8</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">goodWvl</span> <span class="o">=</span> <span class="n">wvl</span> <span class="o">&gt;</span> <span class="n">wvl0</span>
                <span class="k">if</span> <span class="n">goodWvl</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">wvl0</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">twophotonHRead</span><span class="p">()</span>
                    <span class="n">avalue</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">asum</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;asum&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">distr1</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;psi0&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">distr</span> <span class="o">=</span> <span class="n">avalue</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">splev</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">distr1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">asum</span><span class="o">*</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="mf">1.e+8</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">rate</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="o">/</span><span class="n">eDensity</span>
                    <span class="k">else</span><span class="p">:</span>
                       <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTempDens</span><span class="p">):</span>
                            <span class="n">rate</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">/</span><span class="n">eDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhoton</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># He seq</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="n">heseqLvl2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">wvl0</span> <span class="o">=</span> <span class="mf">1.e+8</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">goodWvl</span> <span class="o">=</span> <span class="n">wvl</span> <span class="o">&gt;</span> <span class="n">wvl0</span>
                <span class="k">if</span> <span class="n">goodWvl</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">wvl0</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">twophotonHeRead</span><span class="p">()</span>
                    <span class="n">avalue</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">distr1</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;psi0&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">distr</span> <span class="o">=</span> <span class="n">avalue</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">splev</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">distr1</span><span class="p">)</span><span class="o">/</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="mf">1.e+8</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">wvl</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">rate</span><span class="p">[</span><span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="o">/</span><span class="n">eDensity</span>
                    <span class="k">else</span><span class="p">:</span>
                       <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTempDens</span><span class="p">):</span>
                            <span class="n">rate</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">goodWvl</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">distr</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">/</span><span class="n">eDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhoton</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wvl&#39;</span><span class="p">:</span><span class="n">wvl</span><span class="p">,</span> <span class="s1">&#39;intensity&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;em&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Em</span><span class="p">}</span></div>

<div class="viewcode-block" id="ion.twoPhotonLoss"><a class="viewcode-back" href="../../../api/ChiantiPy.core.ion.html#ChiantiPy.core.Ion.ion.twoPhotonLoss">[docs]</a>    <span class="k">def</span> <span class="nf">twoPhotonLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        to calculate the two-photon energy loss rate - only for hydrogen- and helium-like ions</span>
<span class="sd">        includes the elemental abundance and the ionization equilibrium</span>
<span class="sd">        does not include the emission measure</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Ion</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dielectronic</span><span class="p">:</span>
            <span class="c1"># this is not a hydrogen-like or helium-like ion</span>
            <span class="n">nTempDens</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="c1">#            if nTempDens &gt; 1:</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTempDens</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhotonLoss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abundance&#39;</span><span class="p">):</span>
                <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">abundanceRead</span><span class="p">()</span>
                <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Abundance</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;IoneqOne&#39;</span><span class="p">):</span>
                <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ioneqOne</span><span class="p">()</span>
                <span class="n">thisIoneq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IoneqOne</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">):</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
                <span class="n">nTempDens</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populate</span><span class="p">()</span>
                <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Population</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
                <span class="n">nTempDens</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTempDens</span><span class="p">),</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">eDensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">,</span> <span class="n">nTempDens</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eDensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ion</span><span class="p">:</span>
                <span class="c1"># H seq</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">wvl0</span> <span class="o">=</span> <span class="mf">1.e+8</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">twophotonHRead</span><span class="p">()</span>
                <span class="n">avalue</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">avalue</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="mf">1.e+8</span><span class="p">)</span><span class="o">/</span><span class="n">wvl0</span>
                <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="o">/</span><span class="n">eDensity</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTempDens</span><span class="p">):</span>
                        <span class="n">rate</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">/</span><span class="n">eDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhotonLoss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span><span class="s1">&#39;eDensity&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># He seq</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">l2</span> <span class="o">=</span> <span class="n">heseqLvl2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">wvl0</span> <span class="o">=</span> <span class="mf">1.e+8</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Elvlc</span><span class="p">[</span><span class="s1">&#39;ecm&#39;</span><span class="p">][</span><span class="n">l1</span><span class="p">])</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">twophotonHeRead</span><span class="p">()</span>
                <span class="n">avalue</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="s1">&#39;avalue&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">avalue</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">light</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">planck</span><span class="o">*</span><span class="mf">1.e+8</span><span class="p">)</span><span class="o">/</span><span class="n">wvl0</span>
                <span class="k">if</span> <span class="n">nTempDens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rate</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="o">/</span><span class="n">eDensity</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTempDens</span><span class="p">):</span>
                        <span class="n">rate</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">pop</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">l2</span><span class="p">]</span><span class="o">*</span><span class="n">ab</span><span class="o">*</span><span class="n">thisIoneq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">/</span><span class="n">eDensity</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TwoPhotonLoss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span><span class="s1">&#39;eDensity&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">EDensity</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">}</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Ken Dere.
      Last updated on 03 Oct 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.7.1a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>